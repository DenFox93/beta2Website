<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Forge ICMP packet</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Forge ICMP packet</h1><br/><strong><h3>ICMPPacket class</h3></strong><h3> (</h3><a href="https://github.com/todb/packetfu/blob/master/lib/packetfu/protos/icmp.rb">https://github.com/todb/packetfu/blob/master/lib/packetfu/protos/icmp.rb</a><h3>)</h3><br /><br /><div class="codebox"><pre><span style="color:#7f0044;font-weight:400">require</span> <span style="color:#3ad900;font-weight:400">&quot;packetfu&quot;</span><br /><span style="color:#7f0044;font-weight:400">include</span> <span style="color:#7f0044;font-weight:400">PacketFu</span></pre></div><br /><a href=""><img src="images/1972-1.png" alt="images/1972-1.png" /></a><br /><br /><div class="codebox"><pre>i= <span style="color:#7f0044;font-weight:400">ICMPPacket</span>.new</pre></div><br />	<a href=""><img src="images/1972-2.png" alt="images/1972-2.png" /></a><br /><br />Check the documentation to know how to set these values:<br />• ETHHeader: <a href="https://www.rubydoc.info/github/todb/packetfu/PacketFu/EthHeader">https://www.rubydoc.info/github/todb/packetfu/PacketFu/EthHeader</a><br />• IPHeader: <a href="https://www.rubydoc.info/github/todb/packetfu/PacketFu/IPHeader">https://www.rubydoc.info/github/todb/packetfu/PacketFu/IPHeader</a><br />• ICMPHeader: <a href="https://www.rubydoc.info/github/todb/packetfu/PacketFu/ICMPHeader">https://www.rubydoc.info/github/todb/packetfu/PacketFu/ICMPHeader</a><br /><br /><strong>How send an ICMP packet</strong><br />To send an UDP packet you need to set the following fields:<br />   ◇ eth_saddr → source MAC address<br />      ▪ Check Utils.whoami?[:eth_saddr]<br />      	<a href=""><img src="images/1972-3.png" alt="images/1972-3.png" /></a><br />   ◇ eth_daddr → destination MAC address <br />      ▪ destination outside our local network → MAC address of the default gateway<br />         - Check Utils.whoami?[:eth_daddr]<br />            <a href=""><img src="images/1972-4.png" alt="images/1972-4.png" /></a><br />      ▪ destination inside of the local network → MAC address of the destination<br />         - Utils.arp(&quot;[IP_Address_destination]&quot;)<br />   ◇ ip_daddr → destination address<br />   ◇ ip_saddr → source address<br />   ◇ icmp_type → determines what the ICMP packet is used for<br />   ◇ icmp_code → <br />   <br /><div class="codebox"><pre>i= <span style="color:#7f0044;font-weight:400">ICMPPacket</span>.new<br />i.eth_saddr=<span style="color:#3ad900;font-weight:400">&quot;00:0c:29:90:45:a8&quot;</span>  <span style="color:#0088ff;font-weight:400">#source MAC address</span><br />i.eth_daddr=<span style="color:#3ad900;font-weight:400">&quot;00:50:56:f3:2d:fd&quot;</span>  <span style="color:#0088ff;font-weight:400">#destination MAC address</span><br />i.ip_saddr=<span style="color:#3ad900;font-weight:400">&quot;192.168.3.136&quot;</span>       <span style="color:#0088ff;font-weight:400">#ip source address</span><br />i.ip_daddr= <span style="color:#3ad900;font-weight:400">&quot;8.8.8.8&quot;</span>            <span style="color:#0088ff;font-weight:400">#ip destination address</span><br />i.icmp_type=<span style="color:#ff0044;font-weight:400">8</span>                   <br />i.icmp_code=<span style="color:#ff0044;font-weight:400">0</span>                    <br />i.payload=<span style="color:#3ad900;font-weight:400">&quot;some data here...&quot;</span>    <span style="color:#0088ff;font-weight:400">#icmp echo request have also a data field</span><br />i.recalc                         <span style="color:#0088ff;font-weight:400">#use first always recalc, in order to calculate the</span><br />                                 <span style="color:#0088ff;font-weight:400"># checksum of the modified packet</span><br />i.to_w                           <span style="color:#0088ff;font-weight:400">#To send the packet</span><br /></pre></div><br />	<a href=""><img src="images/1972-5.png" alt="images/1972-5.png" /></a><br />	<a href=""><img src="images/1972-6.png" alt="images/1972-6.png" /></a><br /><br /><br /><br /><strong>Fast Way: The parameters below can be set automatically (no spoofing)</strong><br /><span style="color:#ff0000;">WARNING if the destination is in the local network:</span> this method will set the <span style="text-decoration:underline;">destination MAC address(eth_daddr/eth_dst)</span> at the default gateway, but if the target is inside the local network, we need to set directly the MAC address of the target and not of the default gateway.<br />• eth_saddr → source MAC address<br />• eth_daddr → destination MAC address<br />• ip_saddr → ip source address<br />with this command:<br /><div class="codebox"><pre>i=<span style="color:#7f0044;font-weight:400">ICMPPacket</span>.new(<span style="color:#ff0044;font-weight:400">:config</span> =&gt; <span style="color:#7f0044;font-weight:400">Utils</span>.whoami?)</pre></div><br />	<a href=""><img src="images/1972-7.png" alt="images/1972-7.png" /></a></div>
</body>
</html>
