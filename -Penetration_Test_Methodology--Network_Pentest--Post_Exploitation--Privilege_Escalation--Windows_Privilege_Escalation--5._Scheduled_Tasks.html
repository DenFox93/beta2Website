<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>5. Scheduled Tasks</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>5. Scheduled Tasks</h1><br/><strong><h3>Scheduled Tasks</h3></strong><br />• Windows can be configured to run tasks at specific times, periodically (e.g. every 5 mins) or when triggered by some event (e.g. a user logon).<br />• Tasks usually run with the privileges of the user who created them, however administrators can configure tasks to run as other users, including SYSTEM.<br /><br /><br /><strong>List all scheduled tasks </strong><strong><span style="text-decoration:underline;">our user can see</span></strong><strong>(not all of them!)</strong>:<br />Unfortunately, there is no easy method for enumerating custom tasks that belong to other users as a low privileged user account.<br /><br />   ◇ All scheduled tasks<br />    <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#cmd</span><br />C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; schtasks <span style="color:#ff9d00;font-weight:700">/</span>query <span style="color:#ff9d00;font-weight:700">/</span>fo LIST <span style="color:#333333;font-weight:400">2</span>&gt;nul | findstr TaskName</pre></div><br />   ◇ All scheduled tasks, excluded the ones of microsoft<br />    <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#powershell</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#00117f;font-weight:400">Get-ScheduledTask</span> | <span style="color:#ff9d00;font-weight:700">where</span> {<span style="color:#0088ff;font-weight:400">$_</span>.TaskPath <span style="color:#ff9d00;font-weight:700">-notlike</span> <span style="color:#3ad900;font-weight:400">&quot;\Microsoft*&quot;</span>} | <span style="color:#ff9d00;font-weight:700">ft</span> TaskName,TaskPath,State</pre></div><br />    <br />Often anyway we have to rely on other clues, such as finding files that indicates a scheduled task is being run:<br />• scripts<br />   ◇ powershell<br />       \*\*\*,\*\*,\*  will limit the depth to 2 (source: <a href="https://stackoverflow.com/questions/13249085/limit-get-childitem-recursion-depth">stackoverflow</a>)<br />       <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">cd</span> C<span style="color:#ff9d00;font-weight:700">:\</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">Get-ChildItem</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#ff9d00;font-weight:700">\*\*\*</span>,<span style="color:#ff9d00;font-weight:700">\*\*</span>,<span style="color:#ff9d00;font-weight:700">\*</span>  <span style="color:#ff9d00;font-weight:700">-Filter</span> <span style="color:#ff9d00;font-weight:700">*</span>.bat <span style="color:#333333;font-weight:400">-ErrorAction</span> SilentlyContinue<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">Get-ChildItem</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#ff9d00;font-weight:700">\*\*\*</span>,<span style="color:#ff9d00;font-weight:700">\*\*</span>,<span style="color:#ff9d00;font-weight:700">\*</span>  <span style="color:#ff9d00;font-weight:700">-Filter</span> <span style="color:#ff9d00;font-weight:700">*</span>.ps1 <span style="color:#333333;font-weight:400">-ErrorAction</span> SilentlyContinue<br /></pre></div><br />• logs <br /><br />We have seen how to schedule a task <a href="lege_Escalation--Kerberos_Authentication_Attacks--Silver_Ticket--Forge_Silver_Ticket--HOST_service--Schedule_Reverse_Powershell(option_1).html">here in Active Directory Post Exploitation</a></div>
</body>
</html>
