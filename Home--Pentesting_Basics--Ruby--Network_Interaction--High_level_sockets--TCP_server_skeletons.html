<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TCP server skeletons</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>TCP server skeletons</h1><br/><br /><strong>TCP server skeleton</strong><br />Not suitable to handle a large number of client connections at the same time<br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/ruby</span><br /><br /><span style="color:#7f0044;font-weight:400">require</span> <span style="color:#3ad900;font-weight:400">&#39;socket&#39;</span><br /><br /><span style="color:#ff9d00;font-weight:700">def</span> main(ip,port)<br />	<span style="color:#0088ff;font-weight:400"># new TCP server bound to ip and port provided as argument</span><br />	server = <span style="color:#7f0044;font-weight:400">TCPServer</span>.new ip,port<br />	<span style="color:#0088ff;font-weight:400"># loop indefinitely to accept clients requests</span><br />	loop <span style="color:#ff9d00;font-weight:700">do</span><br />		<span style="color:#0088ff;font-weight:400"># accept new client request (client is a socket)</span><br />		client = server.accept<br />		<span style="color:#0088ff;font-weight:400"># prints the client information (IP and port)</span><br />		print <span style="color:#7f0044;font-weight:400">Time</span>.new.to_s + <span style="color:#3ad900;font-weight:400">&quot; - IP: &quot;</span>+client.peeraddr[<span style="color:#ff0044;font-weight:400">3</span>]<br />		print <span style="color:#3ad900;font-weight:400">&quot; Port: &quot;</span>+client.peeraddr[<span style="color:#ff0044;font-weight:400">1</span>].to_s+<span style="color:#3ad900;font-weight:400">&quot;\n&quot;</span><br />		<span style="color:#0088ff;font-weight:400">#.......</span><br />		<span style="color:#0088ff;font-weight:400">#CODE</span><br />		<span style="color:#0088ff;font-weight:400">#....</span><br />	<span style="color:#ff9d00;font-weight:700">end</span><br /><span style="color:#ff9d00;font-weight:700">end</span><br /><br /><span style="color:#ff9d00;font-weight:700">begin</span><br />	ip = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">0</span>]<br />	port = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">1</span>]<br />	main(ip,port)<br /><span style="color:#ff9d00;font-weight:700">rescue</span> <span style="color:#7f0044;font-weight:400">Exception</span> =&gt; e<br />	puts e<br /><span style="color:#ff9d00;font-weight:700">end</span></pre></div><br /><br /><strong>multi-threading TCP server skeleton</strong><br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/ruby</span><br /><br /><span style="color:#7f0044;font-weight:400">require</span> <span style="color:#3ad900;font-weight:400">&#39;socket&#39;</span><br /><br /><span style="color:#ff9d00;font-weight:700">def</span> main(ip,port)<br />	<span style="color:#0088ff;font-weight:400"># new TCP server bound to ip and port provided as argument</span><br />	server = <span style="color:#7f0044;font-weight:400">TCPServer</span>.new ip,port<br />	<span style="color:#0088ff;font-weight:400"># loop indefinitely to accept clients requests</span><br />	loop <span style="color:#ff9d00;font-weight:700">do</span><br />		<span style="color:#0088ff;font-weight:400"># accept new client requests (client is a socket)</span><br />		<span style="color:#0088ff;font-weight:400">#logic block is executed in a new block</span><br />		<span style="color:#7f0044;font-weight:400">Thread</span>.start(server.accept) <span style="color:#ff9d00;font-weight:700">do</span> |client|<br />		    <span style="color:#0088ff;font-weight:400"># prints the client information (IP and port)</span><br />		    print <span style="color:#7f0044;font-weight:400">Time</span>.new.to_s + <span style="color:#3ad900;font-weight:400">&quot; - IP: &quot;</span>+client.peeraddr[<span style="color:#ff0044;font-weight:400">3</span>]<br />		    print <span style="color:#3ad900;font-weight:400">&quot; Port: &quot;</span>+client.peeraddr[<span style="color:#ff0044;font-weight:400">1</span>].to_s+<span style="color:#3ad900;font-weight:400">&quot;\n&quot;</span><br />		    <span style="color:#0088ff;font-weight:400">#.......</span><br />		    <span style="color:#0088ff;font-weight:400">#CODE</span><br />		    <span style="color:#0088ff;font-weight:400">#....</span><br />		<span style="color:#ff9d00;font-weight:700">end</span><br />	<span style="color:#ff9d00;font-weight:700">end</span><br /><span style="color:#ff9d00;font-weight:700">end</span><br /><br /><span style="color:#ff9d00;font-weight:700">begin</span><br />	ip = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">0</span>]<br />	port = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">1</span>]<br />	main(ip,port)<br /><span style="color:#ff9d00;font-weight:700">rescue</span> <span style="color:#7f0044;font-weight:400">Exception</span> =&gt; e<br />	puts e<br /><span style="color:#ff9d00;font-weight:700">end</span></pre></div></div>
</body>
</html>
