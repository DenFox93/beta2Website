<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Vulnerable code</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Vulnerable code</h1><br/><br />File Inclusion vulnerabilities can occur with different Back-End languages: PHP, NodeJS, Java, .Net, ....<br /><br /><br /><strong><h3>PHP</h3></strong><br />• include() function → can load a local or a remote file as we load a page. <br />    If the path passed to the include() is taken from a user-controlled parameter, like a GET parameter, and the code does not explicitly filter and sanitize the user input, then the code becomes vulnerable to File Inclusion.<br />• include_once()<br />• require()<br />• require_once()<br />• file_get_contents()<br /><br /><strong><span style="color:#a52a2a;">include(): example code php</span></strong><br /><div class="codebox"><pre>if (isset($_GET[&#39;language&#39;])) {<br />    include($_GET[&#39;language&#39;]);<br />}<br /></pre></div><br />    GET <span style="color:#a020f0;">language</span> parameter is directly passed to the <code>include()</code> function. This mean any path we pass in the language parameter will be loaded on the page, including any local files on the back-end server. <br /><br /><br /><br /><br /><strong><h3>NodeJS</h3></strong><br />NodeJS web servers can also load content based on an HTTP parameters. <br /><strong><span style="color:#a52a2a;">parameter misconfiguration: example code javascript(.js)</span></strong><br />GET parameter <span style="color:#a020f0;">language</span> is used to control what data is written to a page:<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">if</span>(req.query.language) {<br />    fs.readFile(path.<span style="color:#ff9d00;font-weight:700">join</span>(__dirname, req.query.language), <span style="color:#ff9d00;font-weight:700">function</span> (err, data) {<br />        res.write(data);<br />    });<br />}</pre></div><br />    The parameter passed from the URL ( <code>req.query.language</code>) gets used by the readfile function, which then writes the file content in the HTTP response ( <code>res.write(data)</code>). <br /><br /><strong><span style="color:#a52a2a;">render(): example code javascript(.js):</span></strong><br /><code>render()</code> function in the Express.js framework for NodeJS.<br /><span style="color:#a020f0;">language</span> parameter(from the URL path) determine which directory it should pull the about.html page from:  <br /><div class="codebox"><pre>app.get(&quot;/about/:language&quot;, function(req, res) {<br />    res.render(`/${req.params.language}/about.html`);<br />});</pre></div><code><br /></code><br />    the <span style="color:#a020f0;">language</span> parameter is taken in this example from the URL path (e.g. /about/<span style="color:#a020f0;">en</span> or /about/<span style="color:#a020f0;">es</span>). <br />    As the parameter is directly used within the <code>render()</code> function to specify the rendered file, we can change the URL to show a different file instead.<br /><br /><br /><strong><h3>Java</h3></strong><br /><strong><span style="color:#a52a2a;">include: example code jsp</span></strong><br />Java web server may include local files based on the specified parameter, using the include function<br />    <div class="codebox"><pre>&lt;c:<span style="color:#ff9d00;font-weight:700">if</span> test=<span style="color:#3ad900;font-weight:400">&quot;${not empty param.language}&quot;</span>&gt;<br />    &lt;jsp:include file=<span style="color:#3ad900;font-weight:400">&quot;&lt;%= request.getParameter(&#39;language&#39;) %&gt;&quot;</span> /&gt;<br />&lt;/c:<span style="color:#ff9d00;font-weight:700">if</span>&gt;<br /></pre></div><br />    <code>include</code> function can take a file or a page URL as its argument (in this case with GET <span style="color:#a020f0;">language</span> parameter) and then renders the object into the front-end template<br /><br /><strong><span style="color:#a52a2a;">import: example code jsp</span></strong><br />    <div class="codebox"><pre>&lt;c:<span style="color:#333333;font-weight:400">import</span> url= <span style="color:#3ad900;font-weight:400">&quot;&lt;%= request.getParameter(&#39;language&#39;) %&gt;&quot;</span>/&gt;</pre></div><br />    The <code>import</code> function can also be used to render a local file or a URL (in this case with GET <span style="color:#a020f0;">language</span> parameter)<code><br /></code><br /><br /><br /><strong><h3>.NET</h3></strong><br /><strong><span style="color:#a52a2a;">Response.WriteFile(): example code cs</span></strong><br /><code>Response.WriteFile</code> function takes a file path for its input and writes its content to the response. <br />The path is retrieved from the GET parameter <span style="color:#a020f0;">language</span> for dynamic content loading<br />    <div class="codebox"><pre>@<span style="color:#ff9d00;font-weight:700">if</span> (!string.IsNullOrEmpty(HttpContext.Request.Query[&#39;language&#39;])) {<br />    &lt;% Response.WriteFile(<span style="color:#3ad900;font-weight:400">&quot;&lt;% HttpContext.Request.Query[&#39;language&#39;] %&gt;&quot;</span>); %&gt; <br />}</pre></div><code><br /></code><strong><span style="color:#a52a2a;">@Html.Partial(): example code cs</span></strong><br /><code>@Html.Partial()</code> function can be used to render the specified file as part of the front-end template<br />The path is retrieved from the GET parameter <span style="color:#a020f0;">language</span> for dynamic content loading<br />    <div class="codebox"><pre>@Html.Partial(HttpContext.Request.Query[&#39;language&#39;])</pre></div><code><br /></code><br /><strong><span style="color:#a52a2a;">include: example code cs</span></strong><br /><code>include</code> function can be used to render local files or remote URLs, and may also execute the specified files as well<br />The path is retrieved from the GET parameter <span style="color:#a020f0;">language</span> for dynamic content loading<br /><code><span style="color:#5cb2ff;">&lt;!--</span></code><code>#</code><code><span style="color:#ffcc5c;">include</span></code><code> file</code><code><span style="color:#5cb2ff;">=</span></code><code><span style="color:#c5f467;">&quot;&lt;% HttpContext.Request.Query[&#39;language&#39;] %&gt;&quot;</span></code><code><span style="color:#5cb2ff;">--&gt;</span></code><br /><br /></div>
</body>
</html>
