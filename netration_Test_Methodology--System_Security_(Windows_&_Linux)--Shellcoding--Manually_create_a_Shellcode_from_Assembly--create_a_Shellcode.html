<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>create a Shellcode</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>create a Shellcode</h1><br/><br /><strong>1. Assembly code(ASM)</strong><br />The below ASM code first push the parameter to the stack and then call the function that we want by using its address found before<br /><div class="codebox"><pre>xor eax,eax                               ; zero out the eax register<br />mov eax, &lt;parameter-for-the-function&gt;     ; move the parameter value into eax<br />push eax;                                 ; push the function parameter onto the stack<br />mov ebx, &lt;address-function&gt;               ; move the address of the function that we want to call into ebx<br />call ebx                                  ; call the function </pre></div><br /><br /><strong>2. </strong><a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Assemblers,_Debuggers_and_Tools--Assembler.html">Assembly the ASM code</a><br /><div class="codebox"><pre>nasm -f win32 file.asm -o file.obj</pre></div><br />    -f → <span style="text-decoration:underline;">format</span> of the output file; in this case Microsoft object file format for 32-bit OS<br />    -o → name of the <span style="text-decoration:underline;">output</span> file<br />    <br /><strong>3. </strong><a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Assemblers,_Debuggers_and_Tools--Decompiler--objdump_(Dev-C++).html">Disassemble the object file</a><br />We want know the Opcode(hexadecimal values) of our assembly code<br /><div class="codebox"><pre>objdump -d -Mintel file.obj</pre></div><br />• <strong>-d </strong>→  tells the tool to disassemble the input file<br />• <strong>-Mintel </strong>→ is a disassembler option that allows us to select disassembly for the given architecture (Intel in our case)<br /><br /><a href=""><img src="images/532-1.png" alt="images/532-1.png" /></a><br /><span style="color:#ff8700;">0x1388</span> is our parameter for the function<br /><span style="color:#ff8700;">0x777DC266</span> is the address of the function that we want call<br /><br /><strong>4. Create the Shellcode</strong><br />To create the shellcode we need to <strong>remove the spaces</strong> and add the <strong>\x</strong> prefix to the <span style="color:#00ff00;">Opcode</span> obtained<br /><div class="codebox"><pre>\x31\xc0<br />\xb8\x88\x13\x00\x00<br />\x50<br />\xbb\x66\xc2\x7d\x77<br />\xff\xd3</pre></div><br /><br /><strong>5. Test if the Shellcode works</strong><br />To test if the shellcode works we need to Compile the C++ file seen also <a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Shellcoding--Test_if_a_Shellcode_works.html">here</a> <br />Because ASLR is enabled(address randomization) the below code work only on the Windows 7 machine tested <br /><div class="codebox"><pre>char code[] = <br />&quot;\x31\xc0&quot;<br />&quot;\xb8\x88\x13\x00\x00&quot;<br />&quot;\x50&quot;<br />&quot;\xbb\x66\xc2\x7d\x77&quot;<br />&quot;\xff\xd3&quot;;<br /><br /><br />int main(int argc, char **argv) <br />{ <br />  int (*func)(); <br />  func = (int (*)()) code; <br />  <span style="color:#333333;font-weight:400">(int)</span>(*func)(); <br />}</pre></div><br /><br /></div>
</body>
</html>
