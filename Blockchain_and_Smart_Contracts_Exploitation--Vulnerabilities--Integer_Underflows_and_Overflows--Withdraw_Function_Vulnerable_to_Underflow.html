<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Withdraw Function Vulnerable to Underflow</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Withdraw Function Vulnerable to Underflow</h1><br/><br /><strong><span style="color:#a5452a;">Simple Example</span></strong><br />Let’s say we have the following Require check as an example:<br />    <div class="codebox"><pre>require (balance - withdraw_amount &gt; <span style="color:#ff0044;font-weight:400">0</span>);</pre></div><br />Now the above statement seems reasonable, if the users balance minus the withdrawal amount is less than 0 then obviously, they don’t have the money for this transaction correct?<br /><br />This transaction should fail and produce an error because not enough funds are held within the account for the transaction. But what if we have 5 dollars and we withdraw 6 dollars using the scenario above and our variable can hold 2 digits with an unsigned integer?<br />Let&#39;s do some math.<br />    5 - 6 = 99<br />    <br />Last I checked 99 is greater than 0 which poses an interesting problem. Our check says we are good to go, but our account balance isn&#39;t large enough to cover the transaction. The check will pass because the underflow creates the wrong value which is greater than 0 and more funds then the user has will be transferred out of the account.<br />Because the following math returns true:<br />    <div class="codebox"><pre>require (<span style="color:#ff0044;font-weight:400">99</span> &gt; <span style="color:#ff0044;font-weight:400">0</span>) </pre></div><br />    <br /><br /><strong><span style="color:#a5452a;">Withdraw Function Vulnerable to an underflow</span></strong><br /><div class="codebox"><pre>function withdraw(uint _amount){<br />    <span style="color:#0088ff;font-weight:400">//require checks that the balance is greater than 0 after subtracting the _amount.</span><br />    <span style="color:#0088ff;font-weight:400">//However, if the _amount is greater than the balance, it will underflow resulting in a large value greater than 0.</span><br />    <span style="color:#0088ff;font-weight:400">//So even though the require check should fail the check will return a true value</span><br />    require(balances[msg.sender] - _amount &gt; <span style="color:#ff0044;font-weight:400">0</span>);<br />    <span style="color:#0088ff;font-weight:400">//If and After the check is under flowed, it will send the value of the original _amount to the recipient </span><br />    <span style="color:#0088ff;font-weight:400">//without any further checks resulting in sending more funds then the user has.</span><br />    msg.sender.transfer(_amount);<br />    <span style="color:#0088ff;font-weight:400">//This below is also another underflow, it could increases the value of the senders account</span><br />    <span style="color:#0088ff;font-weight:400">//due to a similar underflow condition of the require function above,</span><br />    <span style="color:#0088ff;font-weight:400">//even though the balance should have been reduced based on application logic.</span><br />    balances[msg.sender] -= _amount;<br />    <span style="color:#0088ff;font-weight:400">//</span><br />}</pre></div></div>
</body>
</html>
