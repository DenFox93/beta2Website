<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>2. PHP Source Code Disclosure</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>2. PHP Source Code Disclosure</h1><br/><br /><strong><h3>Standard PHP Inclusion</h3></strong><br />When we include any php files through LFI there are some options that could happen:<br />   ◇ the included PHP file gets executed, and eventually gets rendered as a normal HTML page<br />      ▪ useful for SSRF<br />   ◇ the included PHP file gets executed, but nothing is rendered since the operations are not visible<br />      ▪ useful for SSRF<br /><span style="text-decoration:underline;">Note:</span> sometimes we don&#39;t need to append the .php extension because is appended by web application<br /><br /><span style="color:#865e3c;">example PHP file:</span><br />	<a href=""><img src="images/2341-1.png" alt="images/2341-1.png" /></a><br /><br /><strong><h2>Source Code Disclosure</h2></strong><br />For LFI instead of the PHP exectuion we are more interested to reading the source code of PHP files.<br /><span style="text-decoration:underline;">Note</span>: The same reasoning can be applied to other web application languages other than PHP, as long as the vulnerable function can execute files.<br />	<table class="table"><tr><th>Function</th><th>Read Content</th><th>Execute</th><th>Remote URL</th></tr></table><br />	<table class="table"><tr><th>PHP</th><th> </th><th> </th><th> </th></tr><tr><td>include()/include_once()</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>require()/require_once()</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>file_get_contents()</td><td>✅</td><td>❌</td><td>✅</td></tr><tr><td>fopen()/file()</td><td>✅</td><td>❌</td><td>❌</td></tr></table><br />	<table class="table"><tr><th>NodeJS</th><th> </th><th> </th><th> </th></tr><tr><td>fs.readFile()</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>fs.sendFile()</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>res.render()</td><td>✅</td><td>✅</td><td>❌</td></tr></table><br />	<table class="table"><tr><th>Java</th><th> </th><th> </th><th> </th></tr><tr><td>include</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>import</td><td>✅</td><td>✅</td><td>✅</td></tr></table><br />	<table class="table"><tr><th>.NET</th><th> </th><th> </th><th> </th></tr><tr><td>@Html.Partial()</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>@Html.RemotePartial()</td><td>✅</td><td>❌</td><td>✅</td></tr><tr><td>Response.WriteFile()</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>include</td><td>✅</td><td>✅</td><td>✅</td></tr></table><br /><br /><strong>Source code Disclosure through base64 encoding</strong><br />For disclosing the Source code of PHP files we can use the base64 PHP filter<br />To read the source code of a FILE use the base64 filter<br />   ◇ for read parameter → specify convert.base64-encode <br />   ◇ for the resource parameter → config<br /><span style="color:#865e3c;">example:</span><br />	<div class="codebox"><pre>php://filter/read=convert.base64-encode/resource=FILE(.php)</pre></div><code><br /></code>	<a href=""><img src="images/2341-2.png" alt="images/2341-2.png" /></a><br />	Note: in this example is been left the file without extension because the .php extension is appended by the WebApp<br /><br /><span style="text-decoration:underline;">Decode Base64 string</span><br />• Bash<br />   <div class="codebox"><pre>echo &#39;PD9waHAK...SNIP...KICB9Ciov&#39; | base64 -d</pre></div><br /></div>
</body>
</html>
