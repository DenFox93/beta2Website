<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Perform PAC Validation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Perform PAC Validation</h1><br/><br />To perform PAC validation with the KDC (not set by default in Windows).<br />However, we have to consider that PAC validation can have a performance impact, as an extra step of authentication is added.<br /><br />To enable PAC validation, we need to set to 1 the following registry key:<br />    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters\ValidateKdcPacSignature<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg query HKEY_LOCAL_MACHINE<span style="color:#ff9d00;font-weight:700">\</span>SYSTEM<span style="color:#ff9d00;font-weight:700">\</span>CurrentControlSet<span style="color:#ff9d00;font-weight:700">\</span>Control<span style="color:#ff9d00;font-weight:700">\</span>Lsa<span style="color:#ff9d00;font-weight:700">\</span>Kerberos<span style="color:#ff9d00;font-weight:700">\</span>Parameters <span style="color:#ff9d00;font-weight:700">/</span>v ValidateKdcPacSignature<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg add HKEY_LOCAL_MACHINE<span style="color:#ff9d00;font-weight:700">\</span>SYSTEM<span style="color:#ff9d00;font-weight:700">\</span>CurrentControlSet<span style="color:#ff9d00;font-weight:700">\</span>Control<span style="color:#ff9d00;font-weight:700">\</span>Lsa<span style="color:#ff9d00;font-weight:700">\</span>Kerberos<span style="color:#ff9d00;font-weight:700">\</span>Parameters <span style="color:#ff9d00;font-weight:700">/</span>v ValidateKdcPacSignature <span style="color:#ff9d00;font-weight:700">/</span>t REG_DWORD <span style="color:#ff9d00;font-weight:700">/</span>d <span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">/</span>f <br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg query HKEY_LOCAL_MACHINE<span style="color:#ff9d00;font-weight:700">\</span>SYSTEM<span style="color:#ff9d00;font-weight:700">\</span>CurrentControlSet<span style="color:#ff9d00;font-weight:700">\</span>Control<span style="color:#ff9d00;font-weight:700">\</span>Lsa<span style="color:#ff9d00;font-weight:700">\</span>Kerberos<span style="color:#ff9d00;font-weight:700">\</span>Parameters <span style="color:#ff9d00;font-weight:700">/</span>v ValidateKdcPacSignature</pre></div><br /><br /><strong>PAC validation problem: bottleneck</strong><br />Because PAC validation is managed by the Netlogon service, the performance bottlenecks can happen in the Netlogon service of an Application Server and the Domain Controller. <br /><span style="text-decoration:underline;">How avoid the bottleneck:</span><br />   â—‡  increase the MaxConcurrentApi setting which will devote additional threads on client and server. <br /><br /><br />For more informations about PAC validation bottleneck:<br /><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/why-won-t-pac-validation-turn-off/ba-p/243144">https://techcommunity.microsoft.com/t5/azure-active-directory-identity/why-won-t-pac-validation-turn-off/ba-p/243144</a><br /><br /></div>
</body>
</html>
