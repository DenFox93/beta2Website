<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Delegate Call vs “regular” Call (example 1)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Delegate Call vs “regular” Call (example 1)</h1><br/>In the following file we have 2 contract, but this is just for testing purpose. Usually we should have them in 2 separate files and bond with an interface<br /><span style="color:#ff8700;">CallingContract</span> address 0xddaAd340b0f1Ef65169Ae5E41A8b10776a75482d<br /><div class="codebox"><pre>pragma solidity 0.6.6;<br /><br />contract LogicContract {<br />  address returnedAddress;                                                  <span style="color:#0088ff;font-weight:400">//holds the value of the returned address from </span><br />                                                                            <span style="color:#0088ff;font-weight:400">//the print_address function()</span><br />  event contractAddress(address returnedAddress );<br />  <br />  function print_address() public  returns(address){<br />    returnedAddress = address(this);                                       <span style="color:#0088ff;font-weight:400">//get the current address of the contract with the this keyword</span><br />    emit contractAddress(returnedAddress);                                 <span style="color:#0088ff;font-weight:400">//to view the address, we issue an Event</span><br />                                                                           <span style="color:#0088ff;font-weight:400">//this print out the current value of the contract address.</span><br />  }<br />}<br /><br />contract CallingContract {<br />  address returnedAddress;                                                 <span style="color:#0088ff;font-weight:400">//Note the use of the exact same returnedAddress variable</span><br />                                                                           <span style="color:#0088ff;font-weight:400">// from the LogicContract. This is important when using delegate calls</span><br />                                                                           <span style="color:#0088ff;font-weight:400">// as the call will modify that variable locally on the Calling Contract</span><br />                                                                           <span style="color:#0088ff;font-weight:400">// from the Logic Contract remote functionality</span><br />                                                                           <span style="color:#0088ff;font-weight:400">//If this variable does not exist it cannot be set,</span><br />                                                                           <span style="color:#0088ff;font-weight:400">// you should always have the same variables in each contract </span><br />                                                                           <span style="color:#0088ff;font-weight:400">// and have them in the correct order when using delegate call</span><br />  address logic_pointer = address(new LogicContract());                    <span style="color:#0088ff;font-weight:400">//Address of the Logic Contract, for testing purpose otherwise we should</span><br />                                                                           <span style="color:#0088ff;font-weight:400">// use an interface with 2 separate files</span><br /><br />  function print_my_delgate_address() public returns(address){<br />    logic_pointer.delegatecall(abi.encodeWithSignature(<span style="color:#3ad900;font-weight:400">&quot;print_address()&quot;</span>));  <span style="color:#0088ff;font-weight:400">//Delegate Call</span><br />                                                                             <span style="color:#0088ff;font-weight:400">//abi.encodeWithSignature is simply</span><br />                                                                             <span style="color:#0088ff;font-weight:400">// an encoding mechanism before sending our data</span><br />  }<br />  function print_my_call_address() public returns(address){<br />    logic_pointer.call(abi.encodeWithSignature(<span style="color:#3ad900;font-weight:400">&quot;print_address()&quot;</span>));          <span style="color:#0088ff;font-weight:400">//&quot;regular&quot; Contract</span><br />  }<br />}</pre></div><br />    <a href=""><img src="images/1429-1.png" alt="images/1429-1.png" /></a><br /><br />• <strong>print_my_call_address()</strong> → “regular” call <br />    <a href=""><img src="images/1429-2.png" alt="images/1429-2.png" /></a><br />    The address in logs of the event(all events create a log) is <span style="text-decoration:underline;">NOT the same</span> of our <span style="color:#ff8700;">calling contract</span><br />    This is the address of <span style="color:#00ff00;">Logic Contract</span>(we do not know that address before): <span style="color:#00ff00;">0x3aD18EC437c396539C439CD1A4721B01F2800b1A</span><br />• <strong>print_my_delgate_address()</strong>  → delegate call<br />    <a href=""><img src="images/1429-3.png" alt="images/1429-3.png" /></a><br />    The address in the logs of the event(all events create a log) is the <span style="color:#ff8700;">CallingContract</span> address <span style="color:#ff8700;">0xddaAd340b0f1Ef65169Ae5E41A8b10776a75482d</span><br />    This, because with <strong>Delegate Call</strong> the code was run as if it was imported into the <span style="color:#ff8700;">CallingContract</span> using the context of the <span style="color:#ff8700;">CallingContract</span> for the returnedAddress variable posted to the event.<br />    This can become dangerous when variables name(example: address returnedAddress) does not match up</div>
</body>
</html>
