<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Directory/Filename Prefix</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Directory/Filename Prefix</h1><br/><br />In the chapter <a href="t_Methodology--WebApp_Pentest--Exploitation--Server-side--File_Inclusion--Local_File_Inclusion(LFI)_File_Disclosure--Absolute_path_bypass.html">Basic Local File Inclusion</a> we read a file by specifying its absolute path (e.g. /etc/passwd). <br />This work if the <span style="text-decoration:underline;">whole input was used within the include() function without any additions</span><br /><span style="color:#a52a2a;">example code php:</span><br />    <div class="codebox"><pre>include($_GET[&#39;language&#39;]);</pre></div><br />    <h3> </h3>read /etc/passwd, then the include() function would fetch that file directly<br /><br /><strong><h3>Directory Prefix</h3></strong><br /><h6>web developers may append or prepend a directory to a parameter</h6><br /><h6>example code php:</h6><h6>    </h6><br />the language parameter may be used for the filename, and may be added after a directory<br />    <div class="codebox"><pre>include(<span style="color:#3ad900;font-weight:400">&quot;./languages/&quot;</span> . $_GET[&#39;language&#39;]);</pre></div><br />In this example if we try to pass <code>?language=/etc/passwd</code> then the path passed to <code>include()</code> would be (<code>./languages//etc/passwd</code>), this should give an error because <code>./languages/etc/passwd</code> does not exist<br /><span style="text-decoration:underline;">Bypass</span>: traverse directories using relative paths( <code>../</code> ) before the file name<br />	 If the full path of the languages directory is <code>/</code><code><span style="color:#33d17a;">var</span></code><code>/</code><code><span style="color:#ff7800;">www</span></code><code>/</code><code><span style="color:#9141ac;">html</span></code><code>/</code><code><span style="color:#e01b24;">languages</span></code><code>/</code>, then using <code><span style="color:#e01b24;">..</span></code><code>/index.php</code> would refer to the index.php file on the parent directory (i.e. /var/www/html/index.php).<br />So, we can use this trick to go back several directories until we reach the root path (i.e. /), and then specify our absolute file path (e.g. <code><span style="color:#33d17a;">..</span></code><code>/</code><code><span style="color:#ff7800;">..</span></code><code>/</code><code><span style="color:#9141ac;">..</span></code><code>/</code><code><span style="color:#e01b24;">..</span></code><code>/etc/passwd</code>)<br />	<a href=""><img src="images/1727-1.png" alt="images/1727-1.png" /></a><br /><br /><strong>Comparision </strong><strong><span style="text-decoration:underline;">Directory Prefix</span></strong><strong> and </strong><strong><span style="text-decoration:underline;">Absolute Path Bypass</span></strong><br />The <span style="text-decoration:underline;">Directory Prefix: Path Traversal technique</span> work even if the entire parameter was used in the include() function(chapter <a href="t_Methodology--WebApp_Pentest--Exploitation--Server-side--File_Inclusion--Local_File_Inclusion(LFI)_File_Disclosure--Absolute_path_bypass.html">Absolute Path Bypass</a> ), this mean we can default to the Path Traversal technique. In fact if we were at the root path (/) and used <code>../</code> then we would still remain in the root path. So, if we were not sure of the directory the web application is in, we can add <code>../</code> many times, and it should not break the path (even if we do it a hundred times!).<br /><span style="text-decoration:underline;">Note:</span> Anyway is always better be efficient and not add unnecessary <code>../</code> several times, especially if we were writing a report or writing an exploit. So is always better find the minimum number of <code>../</code> that works and use it<h3>. </h3><br /><br /><br /><strong><h3>Filename Prefix</h3></strong><br />Very Similar to Directory Prefix, the only difference here is that include() function does not add <code><span style="color:#3584e4;">/</span></code> after the <span style="color:#ffa500;">prefix string</span> <br /><span style="color:#a52a2a;">example source code PHP:</span> <br />    <div class="codebox"><pre>include(<span style="color:#3ad900;font-weight:400">&quot;lang_&quot;</span> . $_GET[&#39;language&#39;]);</pre></div><br />   ◇ <span style="color:#ff0000;">wrong:</span><br />       In this case, if we try to traverse the directory with <code>../../../etc/passwd</code>, the final string in output of include() would be <code>lang_../../../etc/passwd</code>, which is invalid<br />   ◇ <span style="color:#1e90ff;">correct:</span><br />       instead of directly using path traversal (<code>../../../etc/passwd</code>), we can prefix a <code><span style="color:#3584e4;">/</span></code> before our payload(<code><span style="color:#1c71d8;">/</span></code><code>../../../etc/passwd</code>), and this should consider the prefix as a directory, and then we should bypass the filename and be able to traverse directories. <br />      The final string would be <code><span style="color:#ffa500;">lang_</span></code><code><span style="color:#3584e4;">/</span></code><code>../../../etc/passwd</code> <br />       <span style="text-decoration:underline;">Note:</span> this ONLY WORK if the <span style="color:#ffa500;">prefix string</span> is a directory in the Web Server<br />	<a href=""><img src="images/1727-2.png" alt="images/1727-2.png" /></a><br /><br /><br /><br /><br /><br /><br />Bibliography:<br /><a href="https://portswigger.net/web-security/file-path-traversal">https://portswigger.net/web-security/file-path-traversal</a><br /><a href="https://academy.hackthebox.com/">https://academy.hackthebox.com/</a></div>
</body>
</html>
