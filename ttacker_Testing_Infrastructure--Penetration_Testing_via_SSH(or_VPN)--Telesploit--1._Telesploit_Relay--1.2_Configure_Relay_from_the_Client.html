<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1.2 Configure Relay from the Client</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>1.2 Configure Relay from the Client</h1><br/><strong><h3>Configure</h3></strong><br />The configuration of the relay can be done also directly from the <span style="color:#00ff00;">console of lightsail.aws.amazon.com that is browser based</span> but from the experience of Dustin Dykes (aka @DHAhole) Chief Consultant of Telesploit it will disconnect constantly, so is better to configure by connecting via ssh from the Client(the machine of the Penetration Tester)<br />    <a href=""><img src="images/999-1.png" alt="images/999-1.png" /></a><br />1. To check if the Telesploit Relay works and is online we have to ping the subdomain that we have associated with the Ip address of the AWS instance(see <a href="https://www.godaddy.com/help/create-a-subdomain-4080">here</a>) <div class="codebox"><pre>daniele@TelesploitClient<span style="color:#ff9d00;font-weight:700">:/</span>$ <span style="color:#ff9d00;font-weight:700">ping</span> &lt;relaySubdomain&gt;</pre></div><br />2. Now we want to access via ssh:<br />    <div class="codebox"><pre>daniele@TelesploitClient<span style="color:#ff9d00;font-weight:700">:/</span>$ <span style="color:#ff9d00;font-weight:700">ssh</span> -i &lt;private-key.pem&gt; ubuntu@&lt;relayIpAddress&gt;</pre></div><br />    It will ask for a passphrase that we have inserted <a href="_Test_Methodology--Network_Pentest--Attacker_Testing_Infrastructure--Penetration_Testing_via_SSH(or_VPN)--Telesploit--1._Telesploit_Relay.html">during the creation of Telesploit Relay</a> on AWS.<br />    To know more about the private and public key on amazon AWS see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html</a><br />3. <span style="text-decoration:underline;">Now we are on the AWS instance(that will become our Telesploit Relay)</span>, we have to install from github the code of Telesploit  <br />    <div class="codebox"><pre>daniele@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">sudo</span> -i          <span style="color:#0088ff;font-weight:400">#we have to run relay_setup.sh as root</span><br />root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# <span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>root            <span style="color:#0088ff;font-weight:400">#in ubuntu the home directory is rappresented with ~</span></pre></div><br />    <a href=""><img src="images/999-2.png" alt="images/999-2.png" /></a><br />    <div class="codebox"><pre>root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# apt-get update -y<br />root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# apt-get upgrade -y<br />root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# git clone https<span style="color:#ff9d00;font-weight:700">://</span>github.com<span style="color:#ff9d00;font-weight:700">/</span>telesploit<span style="color:#ff9d00;font-weight:700">/</span>telesploit-relay.git<br />root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# <span style="color:#ff9d00;font-weight:700">cd</span> telesploit-relay<span style="color:#ff9d00;font-weight:700">/</span><br />root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# <span style="color:#ff9d00;font-weight:700">ls</span><br />root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# .<span style="color:#ff9d00;font-weight:700">/</span>relay_setup.sh</pre></div><br />    <br />4.  <a href="https://github.com/telesploit/telesploit-relay">relay_setup.sh</a> will ask the following questions:<br />   1) <span style="text-decoration:underline;">Enter the FQDN for relay server, e.g. relay-os.telesploit.com</span>:<br />        <a href=""><img src="images/999-3.png" alt="images/999-3.png" /></a><br />        If the relay does not resolve, then exit now. Verify a corresponding A record exists in the page of the the webpage provider(example Godaddy)<br />        To associate the Ip address of the AWS Instance with a subdomain of our own domain on godaddy see: <a href="https://www.godaddy.com/help/create-a-subdomain-4080">https://www.godaddy.com/help/create-a-subdomain-4080</a><br />   4) <span style="text-decoration:underline;">Enter your email address for registering the Lets Encrypt certificate:</span><br />        <a href=""><img src="images/999-4.png" alt="images/999-4.png" /></a><br />        Enter an email (also gmail is ok) for Let&#39;s Encrypt, that will warning us when 90 days are coming up, and we have to reopen port 80 to reapply the certificate<br />   <em>The following questions are to setup Mattermost</em><br />   mysql is going to be used for Mattermost<br />   mysql will holds the database of the conversations     <br />   3) <span style="text-decoration:underline;">Enter the password for the mysql server (no single quotes)</span>: <br />        <a href=""><img src="images/999-5.png" alt="images/999-5.png" /></a><br />   4) <span style="text-decoration:underline;">Enter the password for the Mattermost mmuser (alphanumeric only)</span>:<br />        <a href=""><img src="images/999-6.png" alt="images/999-6.png" /></a><br />        <a href=""><img src="images/999-7.png" alt="images/999-7.png" /></a><br />    In the script first we have written the commands to execute in a text file and then we have given this file with the commands to execute to mysql:<br />    the explanation of the following command is on the <a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-batch-commands.html">mysql manual</a><br />    <a href=""><img src="images/999-8.png" alt="images/999-8.png" /></a><br />   We can check explanation of the mysql commands in <a href="https://github.com/telesploit/telesploit-relay">relay_setup.sh</a>:<br />         - here: <a href="https://docs.mattermost.com/install/install-ubuntu-1604-mysql.html">https://docs.mattermost.com/install/install-ubuntu-1604-mysql.html</a><br />         - or here: <a href="https://docs.mattermost.com/install/install-ubuntu-1804.html#installing-mysql-database-server">https://docs.mattermost.com/install/install-ubuntu-1804.html#installing-mysql-database-server</a><br />    <br />    certbot will be installed to set up Let&#39;s Encrypt. Let’s Encrypt uses the ACME protocol to verify that you control a given domain name and to issue you a certificate. <br />    To get a Let’s Encrypt certificate we need an ACME client and certbot is very good :)<br />    <a href=""><img src="images/999-9.png" alt="images/999-9.png" /></a><br /><br />5. After that relay_setup.sh has finished we can renoot the AWS instance<br />    <div class="codebox"><pre>root@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~# reboot</pre></div><br />6. We have to reaccess via ssh to the AWS instance via shh as we are already done at the point 2<br />    <div class="codebox"><pre>daniele@TelesploitClient<span style="color:#ff9d00;font-weight:700">:/</span>$ <span style="color:#ff9d00;font-weight:700">ssh</span> -i &lt;private-key.pem&gt; ubuntu@&lt;relayIpAddress&gt;</pre></div><br />    It will ask for a passphrase that we have inserted <a href="_Test_Methodology--Network_Pentest--Attacker_Testing_Infrastructure--Penetration_Testing_via_SSH(or_VPN)--Telesploit--1._Telesploit_Relay.html">during the creation of Telesploit Relay</a> on AWS.<br />7. Check the listening connections on the AWS relay<br />    <div class="codebox"><pre>daniele@TelesploitRelay<span style="color:#ff9d00;font-weight:700">:</span>~$ netstat -clant</pre></div><br />    the only listening connections should be :<br />    port 22 → listening on all ipv4 network adapters (0.0.0.0) and ipv6 network adapters(::)<br />    port 443 → listening on on all ipv4 network adapters (0.0.0.0) and ipv6 network adapters(::)<br />    Mattermost server port 8065 → listening on all IPv6 network adapters(::) <br />    IRC (port 6667) → listening on all IPv6 network adapters(::)<br />    <a href=""><img src="images/999-10.png" alt="images/999-10.png" /></a><br />    <a href=""><img src="images/999-11.png" alt="images/999-11.png" /></a><br /><br /></div>
</body>
</html>
