<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Detection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Detection</h1><br/><br />If our input is not sanitized and escaped before it is used with an OS command, we may be able to inject another arbitrary command.<br /><br />Before trying a PAYLOAD Command Injection on the target, check if it is working on our host<br /><br /><strong><h3>Command Injection Methods</h3></strong><strong>: Ways of injecting OS commands</strong><br />One of the Method to exploit some command injection ﬂaws is to append commands with:<br />• <strong>Windows and Unix-based systems</strong>:<br />   ◇ &amp; → background: indicates the end of a command, but it causes Bash to execute the command asynchronously. That means Bash will run it in the background and run the next command immediately after, without waiting for the former to end. Only the command before the &amp; is executed asynchronously and you must not put a ; after the &amp;, the &amp; replaces the ;<br />   ◇ &amp;&amp; → Double ampersand means: run the second command if the ﬁrst command exits without error<br />   ◇ | → pipe: connects the output of one command to the input of the next. Any characters streamed by the first command on stdout will be readable by the second command on stdin.<br />   ◇ || → causes the second command to be executed only if the first command ends and exits with a failure exit co<h3>de</h3><br />• <strong>Unix Based Systems</strong>:<br />   ◇ ; → run the second command after the ﬁrst command (regardless of any errors) <br />   ◇ Newline → The <span style="text-decoration:underline;">new-line character is usually not blacklisted</span>, as it may be needed in the payload itself<br />      ▪ 0x0a <br />      ▪ \n <br />   ◇ Inline execution of an injected command within the original command:<br />      ▪ ` injected command ` → backticks <br />      ▪ $( injected command )  → dollar character<br /><span style="text-decoration:underline;">Not</span>e: Sometimes, the input that you control appears within quotation marks in the original command. In this situation, you need to terminate the quoted context (using &quot; or &#39;) before using suitable shell metacharacters to inject a new command.<br /><br /><table class="table"><tr><th>Injection Operator</th><th>Injection Character</th><th>URL-Encoded Character</th><th>Executed Command</th><th>OS</th></tr><tr><td>Semicolon</td><td>;</td><td>%3b</td><td>Both</td><td>Linux/MacOS
Windows (only Powershell, no CMD)</td></tr><tr><td>New Line</td><td>\n</td><td>%0a</td><td>Both</td><td>Linux/MacOS
Windows</td></tr><tr><td>Background</td><td>&amp;</td><td>%26</td><td>Both (second output generally shown first)</td><td>Linux/MacOS
Windows</td></tr><tr><td>Pipe</td><td>|</td><td>%7c</td><td>Both (only second output is shown)</td><td>Linux/MacOS
Windows</td></tr><tr><td>AND</td><td>&amp;&amp;</td><td>%26%26</td><td>Both (only if first succeeds)</td><td>Linux/MacOS
Windows</td></tr><tr><td>OR</td><td>||</td><td>%7c%7c</td><td>Second (only if first fails)</td><td>Linux/MacOS
Windows</td></tr><tr><td>Sub-Shell</td><td>``</td><td>%60%60</td><td>Both</td><td>Linux/MacOS</td></tr><tr><td>Sub-Shell</td><td>$()</td><td>%24%28%29</td><td>Both </td><td>Linux/MacOS</td></tr></table><br /><br /><br /><strong>An injection can cause two types of results</strong><br />   ◇ <span style="text-decoration:underline;">Visible Results</span>: results are returned to the browser<br />    <span style="color:#a5452a;">example</span>:<br />      ▪ <code>; ls /etc</code> → <code>;</code> ends previous command while <code>ls /etc</code> lists the files in the machine<br />      ▪ <a href="y--WebApp_Pentest--Exploitation--Server-side--Injection--OS_Command_Injection_(RCE)--Visible_OS_Command_Injection--HTB_example_DNS_Lookup.html">example: DNS Lookup (Visible Results)</a><br />   ◇ <span style="text-decoration:underline;">Blind Results</span>: results aren&#39;t displayed in the browser via a HTTP response<br />    <span style="color:#a5452a;">example</span>:<br />      ▪ <code>; ping &lt;attackerAddress&gt;</code> → <code>;</code> ends previous command and then ping our address. To intercept the request we need to run a sniffer on our machine and look for ICMP echo requests from the target.</div>
</body>
</html>
