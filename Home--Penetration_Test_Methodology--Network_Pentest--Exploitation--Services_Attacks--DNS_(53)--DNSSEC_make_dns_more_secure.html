<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DNSSEC: make dns more secure</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>DNSSEC: make dns more secure</h1><br/><strong>DNS Zone</strong><br />Each DNS zone has a DNS Resource Recourd (zone file) that contain resource records: SOA, NS, A, MX,...<br /><br /><strong><h3>How to make DNS more secure: DNSSEC </h3></strong><br /><a href="_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Cryptography--Public_Key_Infrastructure_(PKI)--Trust_Chain_(Hierarchical)--DNSSEC.html">In the chapter linked here there is a more in dept explanation of DNSSEC</a>. <br />DNSSEC creates a secure domain name system by adding signed records with private keys to existing DNS records. <br />    By checking these signed records with the correspondent public key, it is possible verify that a requested DNS record comes from its authoritative name server and wasn’t altered en-route, opposed to a fake record injected in a man-in-the-middle attack.<br />Similar to HTTPS, DNSSEC adds a layer of security by enabling authenticated answers on top of an otherwise insecure protocol. Whereas HTTPS encrypts traffic so nobody on the wire can snoop on your Internet activities, DNSSEC merely signs responses so that forgeries are detectable.<br />It make DNS little bit more secure but a chain is strong as its weak link. <br /><br /><strong>How to know if a Zone Support DNSSEC?<br /></strong>We have to ask to the domain for DNS public key<br /><div class="codebox"><pre>dig <span style="color:#ff9d00;font-weight:700">-</span>t DNSKEY @<span style="color:#333333;font-weight:400">1.1</span>.<span style="color:#333333;font-weight:400">1.1</span> &lt;domain&gt; <br />dig <span style="color:#ff9d00;font-weight:700">-</span>t DNSKEY @<span style="color:#333333;font-weight:400">1.1</span>.<span style="color:#333333;font-weight:400">1.1</span> &lt;domain&gt; <span style="color:#ff9d00;font-weight:700">+</span>trace           <span style="color:#0088ff;font-weight:400">#if we want to trace all the server queried</span></pre></div><br />In the following interesting article we can find which registrar support DNSSEC and why is still an unpopular protocol<br /><a href="https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/">https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/</a><br /><br /><br /><strong>Vulnerabilities and problems with DNSSEC</strong><br />• domains that use DNSSEC can be used for <a href="Home--Penetration_Test_Methodology--Network_Pentest--Exploitation--Services_Attacks--DNS_(53)--DNS_Amplification_Attack.html">DNS Amplification Attacks</a>, because they can transform a query into a response with an amplification factor of nearly 30 times. This happen when they respond to the ANY command<br />    <div class="codebox"><pre>dig -t ANY +multiline @8.8.8.8 accenture.com</pre></div><br />   ◇ query:<br />       <a href=""><img src="images/1037-1.png" alt="images/1037-1.png" /></a><br />   ◇ response:<br />       <a href=""><img src="images/1037-2.png" alt="images/1037-2.png" /></a><br />       <a href=""><img src="images/1037-3.png" alt="images/1037-3.png" /></a><br />   This is been an amplification of 3860/121=32x<br />    <span style="text-decoration:underline;">Solution</span>:<br />    Set the DNS to not respond to “ANY” queries or have a mechanism in place to identify and prevent misuse. As recommend by <a href="https://www.mspinsights.com/doc/research-shows-dnssec-vulnerabilities-prolific-0001">Neustar</a><br />• DNSSEC increase the query response time:<br />    DNSSEC significantly increases the size of DNS response packets, which drastically increases the computational load on the DNS servers and also increases the query response time<br />• Install Fake Root Keys in a PC would compromise the chain of trust. <a href="file://G:/Other computers/Yoga 520/CherryTree/Files/Cryptography/Installing Fake Root Keys in a PC.pdf">Here the paper</a><br />• DNSSEC requires time synchronization(like other protocols), if attacker can cause disruption in the synchronization then DNSSEC fails to work properly<br />• Zonewalking: By using the NSEC records is possible to enumerate the subdomains in a zone. It is better use NSEC3<br />    For more see here: <a href="https://appsecco.com/books/subdomain-enumeration/active_techniques/zone_walking.html">https://appsecco.com/books/subdomain-enumeration/active_techniques/zone_walking.html</a><br />    <div class="codebox"><pre>dig -t NSEC &lt;DNSSEC-domain&gt;     <span style="color:#0088ff;font-weight:400">#continue to search with the subdomain found</span></pre></div><br />    automate it with this script<br />    <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/bin/bash</span><br /><span style="color:#7f0044;font-weight:400">domain</span>=<span style="color:#7f0044;font-weight:400">$1</span><br /><span style="color:#ff9d00;font-weight:700">echo</span> &gt; domains.txt<br /><span style="color:#ff9d00;font-weight:700">while</span> <span style="color:#ff9d00;font-weight:700">true;</span> <span style="color:#ff9d00;font-weight:700">do</span><br />    <span style="color:#7f0044;font-weight:400">value</span>=$<span style="color:#ff9d00;font-weight:700">(</span>dig -t nsec <span style="color:#7f0044;font-weight:400">$domain</span> +short <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">awk</span> <span style="color:#3ad900;font-weight:400">&#39;{print $1;}&#39;</span> <span style="color:#ff9d00;font-weight:700">)</span><br />    <span style="color:#7f0044;font-weight:400">domain</span>=<span style="color:#7f0044;font-weight:400">$value</span><br />    <span style="color:#7f0044;font-weight:400">lines1</span>=$<span style="color:#ff9d00;font-weight:700">(grep</span> -c ^ domains.txt<span style="color:#ff9d00;font-weight:700">)</span><br />    <span style="color:#ff9d00;font-weight:700">grep</span> -qxF -- <span style="color:#3ad900;font-weight:400">&quot;$domain&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;domains.txt&quot;</span> <span style="color:#ff9d00;font-weight:700">||</span> <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;$domain&quot;</span> <span style="color:#ff9d00;font-weight:700">|&amp;</span> <span style="color:#ff9d00;font-weight:700">tee</span> -a <span style="color:#3ad900;font-weight:400">&quot;domains.txt&quot;</span><br />    <span style="color:#7f0044;font-weight:400">lines2</span>=$<span style="color:#ff9d00;font-weight:700">(grep</span> -c ^ domains.txt<span style="color:#ff9d00;font-weight:700">)</span><br />    <span style="color:#ff9d00;font-weight:700">if</span> [[ <span style="color:#7f0044;font-weight:400">$lines2</span> -eq 1 ]]<span style="color:#ff9d00;font-weight:700">;</span> <span style="color:#ff9d00;font-weight:700">then</span><br />        <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;Sorry i have not found NSEC records :(&quot;</span><br />    <span style="color:#ff9d00;font-weight:700">fi</span><br />    <span style="color:#ff9d00;font-weight:700">if</span> [[ <span style="color:#7f0044;font-weight:400">$lines2</span> -eq <span style="color:#7f0044;font-weight:400">$lines1</span> ]]<span style="color:#ff9d00;font-weight:700">;</span> <span style="color:#ff9d00;font-weight:700">then</span><br />        <span style="color:#ff9d00;font-weight:700">break</span><br />    <span style="color:#ff9d00;font-weight:700">fi</span><br /><span style="color:#ff9d00;font-weight:700">done</span></pre></div><br /><br /><br /><br /><br /><br /><br /><br /><br />Bibliography:<br />• “Hands on Hacking: Become an Expert at Next Gen Penetration Testing and Purple Teaming” Matthew Hickey, Jennifer Arcuri<br />• <a href="https://docstore.mik.ua/orelly/networking_2ndEd/dns/ch11_04.htm">https://docstore.mik.ua/orelly/networking_2ndEd/dns/ch11_04.htm</a><br />• <a href="https://www.cloudflare.com/dns/dnssec/how-dnssec-works/">https://www.cloudflare.com/dns/dnssec/how-dnssec-works/</a><br />• <a href="https://metebalci.com/blog/a-minimum-complete-tutorial-of-dnssec/">https://metebalci.com/blog/a-minimum-complete-tutorial-of-dnssec/</a><br />• <a href="https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/">https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/</a><br />• <a href="https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/">https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/</a></div>
</body>
</html>
