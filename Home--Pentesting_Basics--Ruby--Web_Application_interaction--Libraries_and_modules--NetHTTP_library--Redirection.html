<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Redirection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Redirection</h1><br/><br /><br /><br />We have to follow the redirection chain until we receive an HTTPOK response (code 200)<br /><div class="codebox"><pre>require <span style="color:#3ad900;font-weight:400">&#39;net/http&#39;</span><br /><br />Target = ARGV[0]<br /><br /><span style="color:#0088ff;font-weight:400">#Recursive function (follow_chain) that is able to follow the redirection chain. </span><br /><span style="color:#0088ff;font-weight:400"># It is able to identify both HTTP or HTPPS connection type </span><br />def follow_chain<span style="color:#ff9d00;font-weight:700">(</span>url,<span style="color:#ff9d00;font-weight:700">&amp;</span>block<span style="color:#ff9d00;font-weight:700">)</span><br />	resp = Net<span style="color:#ff9d00;font-weight:700">::</span>HTTP.start<span style="color:#ff9d00;font-weight:700">(</span>url.host,url.port,<span style="color:#ff9d00;font-weight:700">:</span>use_ssl=&gt;url.scheme==<span style="color:#3ad900;font-weight:400">&#39;https&#39;</span><span style="color:#ff9d00;font-weight:700">)</span> <span style="color:#ff9d00;font-weight:700">do</span> <span style="color:#ff9d00;font-weight:700">|</span>https<span style="color:#ff9d00;font-weight:700">|</span><br />		https.get<span style="color:#ff9d00;font-weight:700">(</span>url.path<span style="color:#ff9d00;font-weight:700">)</span><br />	end<br />	<span style="color:#0088ff;font-weight:400">#block will call follow_chain, to print on stdout the redirections</span><br />	block.call<span style="color:#ff9d00;font-weight:700">(</span>url,resp<span style="color:#ff9d00;font-weight:700">)</span><br />	<span style="color:#0088ff;font-weight:400">#if the response is an HTTPRedirection object, there is a recursion</span><br />	follow_chain<span style="color:#ff9d00;font-weight:700">(</span>URI<span style="color:#ff9d00;font-weight:700">(</span>resp[<span style="color:#3ad900;font-weight:400">&#39;location&#39;</span>]<span style="color:#ff9d00;font-weight:700">)</span>,<span style="color:#ff9d00;font-weight:700">&amp;</span>block<span style="color:#ff9d00;font-weight:700">)</span> <span style="color:#ff9d00;font-weight:700">if</span> resp.is_a? Net<span style="color:#ff9d00;font-weight:700">::</span>HTTPRedirection<br />end<br /><br />puts <span style="color:#3ad900;font-weight:400">&quot;Starting from: #{Target}\n\n&quot;</span><br />follow_chain<span style="color:#ff9d00;font-weight:700">(</span>URI<span style="color:#ff9d00;font-weight:700">(</span>Target<span style="color:#ff9d00;font-weight:700">))</span> <span style="color:#ff9d00;font-weight:700">{</span> <span style="color:#ff9d00;font-weight:700">|</span>url,resp<span style="color:#ff9d00;font-weight:700">|</span> <br />	<span style="color:#ff9d00;font-weight:700">case</span> resp<br />		when Net<span style="color:#ff9d00;font-weight:700">::</span>HTTPRedirection <span style="color:#ff9d00;font-weight:700">then</span><br />			puts <span style="color:#3ad900;font-weight:400">&quot;Redirection to: #{resp[&#39;location&#39;]}&quot;</span> <br />		when Net<span style="color:#ff9d00;font-weight:700">::</span>HTTPSuccess <span style="color:#ff9d00;font-weight:700">then</span> <br />			puts <span style="color:#3ad900;font-weight:400">&quot;\nHTTPOK: #{url.to_s}&quot;</span><br />	end<br /><span style="color:#ff9d00;font-weight:700">}</span><br /></pre></div></div>
</body>
</html>
