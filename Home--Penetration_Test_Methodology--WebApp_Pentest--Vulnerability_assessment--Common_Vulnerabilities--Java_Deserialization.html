<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Java Deserialization</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Java Deserialization</h1><br/><strong><span style="color:#ff0000;">WARNING: NOT TESTED TO BE COMPLETED WITH MORE RESOURCES</span></strong><strong><br /></strong><br /><strong><h3>Java Deserialization (aka Deserialization of untrusted data)</h3></strong><br />OWASP: <a href="https://www.owasp.org/index.php/Deserialization_of_untrusted_data">https://www.owasp.org/index.php/Deserialization_of_untrusted_data</a><br /><br />To make a Java object serializable we implement the <em>java.io.Serializable</em> interface.<br />• <span style="text-decoration:underline;">Serialization</span> is a mechanism of converting the state of an object into a byte stream. <br />    The <em>ObjectOutputStream</em> class contains <em>writeObject()</em> method for serializing an Object.<br />• <span style="text-decoration:underline;">Deserialization</span> is the reverse process where the byte stream is used to recreate the actual Java object in memory<br />    The <em>ObjectInputStream</em> class contains <em>readObject()</em> method for deserializing an object.<br />The byte stream created is platform independent. So, the object serialized on one platform can be deserialized on a different platform<br /><br /><span style="color:#a5452a;">example</span><br />this example simply writes the String “bob” to disk using Java’s serializable interface, then reads it back in and prints the result. <br /><div class="codebox"><pre>import java.io.ObjectInputStream<span style="color:#ff9d00;font-weight:700">;</span>    <span style="color:#ff9d00;font-weight:700">//</span>&lt;---<br />import java.io.FileInputStream<span style="color:#ff9d00;font-weight:700">;</span><br />import java.io.ObjectOutputStream<span style="color:#ff9d00;font-weight:700">;</span>  <span style="color:#ff9d00;font-weight:700">//</span>&lt;---<br />import java.io.FileOutputStream<span style="color:#ff9d00;font-weight:700">;</span><br /> <br />public class SerializeTest<span style="color:#ff9d00;font-weight:700">{</span><br />    public static void main<span style="color:#ff9d00;font-weight:700">(</span>String args[]<span style="color:#ff9d00;font-weight:700">)</span> throws Exception<span style="color:#ff9d00;font-weight:700">{</span><br />        <span style="color:#ff9d00;font-weight:700">//</span>This is the object we<span style="color:#3ad900;font-weight:400">&#39;re going to serialize.<br />        String name = &quot;bob&quot;;<br /> <br />        //We&#39;</span>ll <span style="color:#ff9d00;font-weight:700">write</span> the serialized data to a <span style="color:#ff9d00;font-weight:700">file</span> <span style="color:#3ad900;font-weight:400">&quot;name.ser&quot;</span><br />        FileOutputStream fos = new FileOutputStream<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;name.ser&quot;</span><span style="color:#ff9d00;font-weight:700">);</span><br />        ObjectOutputStream os = new ObjectOutputStream<span style="color:#ff9d00;font-weight:700">(</span>fos<span style="color:#ff9d00;font-weight:700">);</span><br />        os.writeObject<span style="color:#ff9d00;font-weight:700">(</span>name<span style="color:#ff9d00;font-weight:700">);</span>                                                    <span style="color:#ff9d00;font-weight:700">//</span>&lt;---<br />        os.<span style="color:#ffdd00;font-weight:400">close()</span><span style="color:#ff9d00;font-weight:700">;</span><br /> <br />        <span style="color:#ff9d00;font-weight:700">//</span>Read the serialized data back <span style="color:#ff9d00;font-weight:700">in</span> from the <span style="color:#ff9d00;font-weight:700">file</span> <span style="color:#3ad900;font-weight:400">&quot;name.ser&quot;</span><br />        FileInputStream fis = new FileInputStream<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;name.ser&quot;</span><span style="color:#ff9d00;font-weight:700">);</span><br />        ObjectInputStream ois = new ObjectInputStream<span style="color:#ff9d00;font-weight:700">(</span>fis<span style="color:#ff9d00;font-weight:700">);</span><br /> <br />        <span style="color:#ff9d00;font-weight:700">//</span>Read the object from the data stream, and convert it back to a String<br />        String nameFromDisk = <span style="color:#ff9d00;font-weight:700">(</span>String<span style="color:#ff9d00;font-weight:700">)</span>ois.<span style="color:#ffdd00;font-weight:400">readObject()</span><span style="color:#ff9d00;font-weight:700">;</span>                          <span style="color:#ff9d00;font-weight:700">//</span>&lt;---<br /> <br />        <span style="color:#ff9d00;font-weight:700">//</span>Print the result.<br />        System.out.println<span style="color:#ff9d00;font-weight:700">(</span>nameFromDisk<span style="color:#ff9d00;font-weight:700">);</span><br />        ois.<span style="color:#ffdd00;font-weight:400">close()</span><span style="color:#ff9d00;font-weight:700">;</span><br />    <span style="color:#ff9d00;font-weight:700">}</span><br /><span style="color:#ff9d00;font-weight:700">}</span></pre></div><br /><a href=""><img src="images/1450-1.png" alt="images/1450-1.png" /></a><br /><br /><strong>Vulnerability</strong><br />Vulnerabilities arise when developers write code that accepts serialized data from untrusted users and attempt to unserialize it for use in the program. Depending on the language, this can lead to all sorts of consequences, but most interesting, and the one we will talk about here is remote code execution.<br /><br /><br />Bibliography:<br />• <a href="https://www.geeksforgeeks.org/serialization-in-java">https://www.geeksforgeeks.org/serialization-in-java</a><br />• <a href="https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/">https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/</a><br />• hands on replicate vulnerability: <a href="https://zonksec.com/blog/hands-on-with-weblogic-serialization-vulnerability/">https://zonksec.com/blog/hands-on-with-weblogic-serialization-vulnerability/</a></div>
</body>
</html>
