<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Login Outlook Web Access (OWA)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Login Outlook Web Access (OWA)</h1><br/>When we found on our target a page related to Outlook Web Page (OWA) we can identify valid emails by doing a password spraying attack. <br />Outlook Web App do not tell us if an email is valid or not like <a href="ork_Pentest--Recoinnaissance_(OSINT_Open_Source_Information_Gathering)--Credential_Stuffing--Enumerating_valid_accounts--Login_Office_365.html">Office 365</a> BUT when an username is valid it suffer of a time delay enumeration that a <a href="Home--Penetration_Test_Methodology--WebApp_Pentest--Reconnaissance_(Information_Gathering)--Username_Harvesting--Side-Channel_Attacks.html">tool can detect</a>.<br />For more information see also <a href="Home--Penetration_Test_Methodology--WebApp_Pentest--Reconnaissance_(Information_Gathering)--Username_Harvesting--Side-Channel_Attacks.html">Side Channel Attack</a>.<br /><span style="color:#ff0000;text-decoration:underline;">Note</span><span style="color:#ff0000;">: sometimes we not have have clear results, mostly when the attack is been done externally (&quot;from the internet&quot;) and not inside the same network. <br />    Because of that there are delays that we cannot control and the result are more random</span><br /><br /><br /><strong>Shodan Queries</strong><br />• Exchange 2007<br />    <div class="codebox"><pre><span style="color:#3ad900;font-weight:400">&quot;x-owa-version&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;IE=EmulateIE7&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;Server: Microsoft-IIS/7.0&quot;</span></pre></div><br />• Exchange 2010<br />    <div class="codebox"><pre><span style="color:#3ad900;font-weight:400">&quot;x-owa-version&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;IE=EmulateIE7&quot;</span> http.favicon.hash<span style="color:#ff9d00;font-weight:700">:</span>442749392</pre></div><br />• Exchange 2013 / 2016<br />    <div class="codebox"><pre><span style="color:#3ad900;font-weight:400">&quot;X-AspNet-Version&quot;</span> http.title<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#3ad900;font-weight:400">&quot;Outlook&quot;</span> -<span style="color:#3ad900;font-weight:400">&quot;x-owa-version&quot;</span></pre></div><br />    <a href=""><img src="images/1876-1.png" alt="images/1876-1.png" /></a><br />•  Lync / Skype for Business<br />    <div class="codebox"><pre><span style="color:#3ad900;font-weight:400">&quot;X-MS-Server-Fqdn&quot;</span></pre></div><br /><br /><strong>metasploit Password Spraying</strong><br />This module (auxiliary/scanner/http/owa_login) tests credentials on OWA 2003, 2007, 2010, 2013, and 2016 servers.<br /><div class="codebox"><pre>attacker@kali# msfconsole<br />msf&gt; search owa<br />msf&gt; use auxiliary<span style="color:#ff9d00;font-weight:700">/</span>scanner<span style="color:#ff9d00;font-weight:700">/</span>http<span style="color:#ff9d00;font-weight:700">/</span>owa_login<br />msf&gt; options<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> rhost [IpAddress]<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> password [password]<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> user_file [emails.txt]</pre></div><br />    <a href=""><img src="images/1876-2.png" alt="images/1876-2.png" /></a><br />    Because this extension measure also the delay between request and response, we can determine when an username is valid and when not.  <br /><br /><strong>Burpsuite Intruder (Sniper):</strong><br />1. Positions tab: select the value of the username that we want to change and click to add<br />3. Payloads tab:  Payload Options → select the usernames that you want to tests<br />    <a href=""><img src="images/1876-3.png" alt="images/1876-3.png" /></a><br />   ◇ <strong><span style="color:#ffa500;">Response received</span></strong> → The time taken to begin receiving a response (in milliseconds). <span style="text-decoration:underline;">This is the one to which we are interested in this scenario</span>.<br />      ▪ useful when we use a time-based attacks that cause a delay before a response starts (if the whole server-side logic is executed first)<br />   ◇ Response completed → The time taken for the response to complete (in milliseconds)<br />      ▪ useful when we use a time-based attacks that cause a delay while the response is already being streamed (e.g. if the headers are sent first, and then some further server-side processing happens on your input).<br /><br /><br /> <br />Bibliography:<br />• <a href="https://github.com/jakejarvis/awesome-shodan-queries">https://github.com/jakejarvis/awesome-shodan-queries</a><br />• External Pentest Playbook | TCM Security, Inc. (<a href="https://academy.tcm-sec.com/p/external-pentest-playbook">https://academy.tcm-sec.com/p/external-pentest-playbook</a>)</div>
</body>
</html>
