<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Local Port Forwarding (meterpreter)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Local Port Forwarding (meterpreter)</h1><br/><strong>Requirements:</strong><br />• Meterpreter session between attacker and pivot host<br /><strong>CONS:</strong><br />• We can targets only a single port<br /><br />portfwd command is implemented in meterpreter. <br />It allows us to forward connections to specific addresses and ports on the remote network<br />OPTIONS:<br />    -L &lt;address&gt; → local IP address to listen on (optional, loopback 0.0.0.0 is default)<br />    -l → local port to listen on (lowercase L)<br />    -p → remote port to connect to<br />    -r → remote host to connect to<br />ARGUMENTS:<br />    Add →  This argument is used to create the forwarding.<br />    Delete →  This will delete a previous entry from our list of forwarded ports.<br />    List →  This will list all ports currently forwarded.<br />    Flush →  This will delete all ports from our forwarding list.<br /><br /><div class="codebox"><pre>meterpreter &gt; portfwd add -L &lt;IPattackerInterface&gt; -l &lt;AttackerPort&gt; -p &lt;TargetPort&gt; -r &lt;TargetIP&gt;<br />meterpreter &gt; portfwd             <span style="color:#0088ff;font-weight:400">#to see the local forwards</span></pre></div><br />    <a href=""><img src="images/780-1.png" alt="images/780-1.png" /></a><br />    the IPattackerInterface is optional, by default is 127.0.0.1<br />    <br />Open a new tab:<br /><div class="codebox"><pre>netstat -tulpn <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> &lt;AttackerPort&gt;   <span style="color:#0088ff;font-weight:400">#listening connction</span></pre></div><br />    -l → list only the listening ports<br />    -t → list all tcp ports<br />    -u → list all udp ports<br />    -p → Show the PID and name of the program to which each socket belongs<br />    -n or --numeric → show numerical addresses instead of trying to determine symbolic host<br />    <a href=""><img src="images/780-2.png" alt="images/780-2.png" /></a><br /><br />Now every service that try to connect to our local ip address on port &lt;AttackerPort&gt; they will be redirected to the &lt;TargetPort&gt; on the host &lt;TargetIP&gt;<br /><span style="color:#a5452a;">example: rdesktop</span><br />    <div class="codebox"><pre>rdesktop 127.0.0.1<span style="color:#ff9d00;font-weight:700">:</span>&lt;AttackerPort&gt;</pre></div><br />    <a href=""><img src="images/780-3.png" alt="images/780-3.png" /></a><br /><br /><span style="color:#a5452a;">example: access to a website hosted in the internal network</span><br />    every request from our local port 8080 will be forwarded to the &lt;TargetIp&gt; of the site with port 80<br />    <code>portfwd add -l 8080 -p 80 -r &lt;TargetIP&gt;</code><br />    now we have only to open the browser and connect to the internal hosted website(TargetIp) through the exploited machine<br />    <a href=""><img src="images/780-4.png" alt="images/780-4.png" /></a><br />    <a href=""><img src="images/780-5.png" alt="images/780-5.png" /></a><br /><span style="color:#a52a2a;"><br />• connect to Telnet<br />    </span><a href=""><img src="images/780-6.png" alt="images/780-6.png" /></a><br />•  cracking telnet service with hydra<br />    WARNING: NOT work to to do that check proxychains!!!<br />    <a href=""><img src="images/780-7.png" alt="images/780-7.png" /></a><br />    <br /><br /><br />    <br />Bibliography:<br />• <a href="https://www.offensive-security.com/metasploit-unleashed/portfwd/">https://www.offensive-security.com/metasploit-unleashed/portfwd/</a></div>
</body>
</html>
