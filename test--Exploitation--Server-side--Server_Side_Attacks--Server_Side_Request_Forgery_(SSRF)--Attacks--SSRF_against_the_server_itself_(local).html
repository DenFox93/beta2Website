<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SSRF against the server itself (local)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SSRF against the server itself (local)</h1><br/><br /><br />Attacker induces the application to make an HTTP request back to the server that is hosting the application, via its loopback network interface.<br />This can be done by supply an URL with:<br />   ◇ 127.0.0.1 ( hostname reserved IP address that points to the loopback adapter) <br />   ◇ localhost (a commonly used name for the same adapter)<br /><br /><strong><span style="color:#a52a2a;">Theoretical Example</span></strong><br />To retrieve stock information abut an item an application need query various back-end REST APIs. <br />Vulnerability:<br />This is implemented by passing an URL to the back-end API endpoint via a front-end HTTP request. <br />    <div class="codebox"><pre>POST <span style="color:#ff9d00;font-weight:700">/</span>product<span style="color:#ff9d00;font-weight:700">/</span>stock HTTP<span style="color:#ff9d00;font-weight:700">/</span>1.0<br />Content-Type<span style="color:#ff9d00;font-weight:700">:</span> application<span style="color:#ff9d00;font-weight:700">/</span>x-www-form-urlencoded<br />Content-Length<span style="color:#ff9d00;font-weight:700">:</span> 118<br /><br /><span style="color:#7f0044;font-weight:400">stockApi</span>=http<span style="color:#ff9d00;font-weight:700">://</span>stock.weliketoshop.net<span style="color:#ff9d00;font-weight:700">:</span>8080<span style="color:#ff9d00;font-weight:700">/</span>product<span style="color:#ff9d00;font-weight:700">/</span>stock<span style="color:#ff9d00;font-weight:700">/</span>check%3FproductId%3D6%26storeId%3D1</pre></div><br /><span style="color:#ff0000;">An attacker</span> can modify the request to specify a URL local to the server itself. For example:<br /><div class="codebox"><pre>POST <span style="color:#ff9d00;font-weight:700">/</span>product<span style="color:#ff9d00;font-weight:700">/</span>stock HTTP<span style="color:#ff9d00;font-weight:700">/</span>1.0<br />Content-Type<span style="color:#ff9d00;font-weight:700">:</span> application<span style="color:#ff9d00;font-weight:700">/</span>x-www-form-urlencoded<br />Content-Length<span style="color:#ff9d00;font-weight:700">:</span> 118<br /><br /><span style="color:#7f0044;font-weight:400">stockApi</span>=http<span style="color:#ff9d00;font-weight:700">://</span>localhost<span style="color:#ff9d00;font-weight:700">/</span>admin</pre></div><br />    When the request to the /admin URL <span style="text-decoration:underline;">comes from the local machine itself, the access controls are bypassed</span>.<br />    The application grants full access to the administrative functionality, because the request appears to originate from a trusted location<br />    <br /><strong><span style="color:#a52a2a;">Practical Example</span></strong><br />1. Browse to /admin and observe that you can&#39;t directly access the admin page.<br />    <a href=""><img src="images/2231-1.png" alt="images/2231-1.png" /></a><br />2. Visit a product, click &quot;Check stock&quot;, intercept the request in Burp Suite, and send it to Burp Repeater.<br />    <a href=""><img src="images/2231-2.png" alt="images/2231-2.png" /></a><br />3. Change the URL in the stockApi parameter to http://localhost/admin.<br />    <a href=""><img src="images/2231-3.png" alt="images/2231-3.png" /></a><br />    <a href=""><img src="images/2231-4.png" alt="images/2231-4.png" /></a><br />4. Read the HTML to identify the URL to delete the target user (via GUI is not possible do that):<br />    <a href=""><img src="images/2231-5.png" alt="images/2231-5.png" /></a><br />5. Submit this URL in the stockApi parameter, to deliver the SSRF attack.<br />    <a href=""><img src="images/2231-6.png" alt="images/2231-6.png" /></a><br />6. By Requesting another time http://localhost/admin via stockApi we can check that effectively the user is been deleted<br />    <a href=""><img src="images/2231-7.png" alt="images/2231-7.png" /></a><br />    <a href=""><img src="images/2231-8.png" alt="images/2231-8.png" /></a><br /><br /><br /><br /><br /><br /><br /><br /><strong>Bibliography:</strong><br /><a href="https://portswigger.net/web-security/ssrf/lab-basic-ssrf-against-localhost">https://portswigger.net/web-security/ssrf/lab-basic-ssrf-against-localhost</a></div>
</body>
</html>
