<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Parameterized Queries</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Parameterized Queries</h1><br/><strong><h3>Parameterized Queries</h3></strong><br />Another way to ensure that the input is safely sanitized is by using parameterized queries. <br />Parameterized queries contain placeholders for the input data, which is then escaped and passed on by the drivers. Instead of directly passing the data into the SQL query, we use placeholders and then fill them with PHP functions.<br /><span style="color:#a52a2a;">PHP: vulnerable authentication code</span><br /><div class="codebox"><pre>&lt;SNIP&gt;<br />  $username = $_POST[&#39;username&#39;];<br />  $password = $_POST[&#39;password&#39;];<br /><br />  $query = &quot;SELECT * FROM logins WHERE username=&#39;&quot;. $username. &quot;&#39; AND password = &#39;&quot; . $password . &quot;&#39;;&quot; ;<br />  echo &quot;Executing query: &quot; . $query . &quot;&lt;br /&gt;&lt;br /&gt;&quot;;<br /><br />  if (!mysqli_query($conn ,$query))<br />  {<br />          die(&#39;Error: &#39; . mysqli_error($conn));<br />  }<br /><br />  $result = mysqli_query($conn, $query);<br />  $row = mysqli_fetch_array($result);<br />&lt;SNIP&gt;</pre></div><br /><br /><strong><span style="text-decoration:underline;">How to Prevent:</span></strong><br />   <div class="codebox"><pre>&lt;SNIP&gt;<br />  $username = $_POST[&#39;username&#39;];<br />  $password = $_POST[&#39;password&#39;];<br /><br />  $query = &quot;SELECT * FROM logins WHERE username=? AND password = ?&quot; ;<br />  $stmt = mysqli_prepare($conn, $query);<br />  mysqli_stmt_bind_param($stmt, &#39;ss&#39;, $username, $password);<br />  mysqli_stmt_execute($stmt);<br />  $result = mysqli_stmt_get_result($stmt);<br /><br />  $row = mysqli_fetch_array($result);<br />  mysqli_stmt_close($stmt);<br />&lt;SNIP&gt;</pre></div><br />   ◇ PHP <a href="https://www.php.net/manual/en/mysqli-stmt.bind-param.php">mysqli_stmt_bind_param()</a> → This function will safely escape any quotes  in the parameters and binds Binds them to a prepared statement as parameters.<br />      ▪ The original <span style="color:#a52a2a;">example</span> vulnerable query is been modified to contain two placeholders, marked with <code>?</code> where the username and password will be placed.<br />      ▪ The second input of the function specify the types of the corresponding bind variables<br />         <a href=""><img src="images/2524-1.png" alt="images/2524-1.png" /></a><br />         <br /></div>
</body>
</html>
