<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>- Structure to Identify an Attack for different Services using a pattern</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>- Structure to Identify an Attack for different Services using a pattern</h1><br/><br /><strong>Structure  to Identify an Attack for different Services using a pattern</strong><br /><a href=""><img src="images/2640-1.png" alt="images/2640-1.png" /></a><br /><br /><br /><strong><h3>Source</h3></strong><br />Source as a source of information used for the specific task of a <span style="color:#e01b24;">process</span>.<br />There are many different ways to pass information to a process. <br /><br />These are the most common Information Sources passed to the <span style="color:#e01b24;">processes</span>:<br />   ◇ <strong>Code</strong> → This means that the already executed program code results are used as a source of information. These can come from different functions of a program<br />   ◇ <strong>Libraries</strong> → A library is a collection of program resources, including configuration data, documentation, help data, message templates, prebuilt code and subroutines, classes, values, or type specifications.<br />   ◇ <strong>Config</strong> → Configurations are usually static or prescribed values that determine how the process processes information.<br />   ◇ <strong>APIs</strong> → The application programming interface (API) is mainly used as the interface of programs for retrieving or providing information.<br />   ◇ <strong>User Input</strong> → If a program has a function that allows the user to enter specific values used to process the information accordingly, this is the manual entry of information by a person.<br />   ◇ ...<br /><br /><span style="color:#986a44;">Log4j vulnerability (</span><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228">CVE-2021-4428</a><span style="color:#986a44;">):</span> an attacker can manipulate the HTTP User-Agent header and insert a JNDI lookup as a command intended for the Log4j library. <br /><br /><br /><strong><h3>Processes</h3></strong><br />The <span style="color:#e01b24;">Process</span> is about processing the information forwarded from the <span style="color:#3584e4;">source</span>.<br />The informations forwarded from the <span style="color:#3584e4;">source</span> are processed according to the intended task determined by the program code. <br />For each task, the developer specifies how the information is processed.<br /><br /><span style="color:#e01b24;">Process</span> Components:<br />   ◇ <strong>PID</strong> → The Process-ID (PID) identifies the process being started or is already running. Running processes have already assigned privileges, and new ones are started accordingly.<br />   ◇ <strong>Input</strong> → This refers to the input of information that could be assigned by a user or as a result of a programmed function<br />   ◇ <strong>Data Processing</strong> → The hard-coded functions of a program dictate how the information received is processed<br />   ◇ <strong>Variables</strong> → The variables are used as placeholders for information that different functions can further process during the task.<br />   ◇ <strong>Logging</strong> → During logging, certain events are documented and, in most cases, stored in a register or a file. This means that certain information remains in the system.<br /><br /><span style="color:#986a44;">Log4j vulnerability (</span><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228">CVE-2021-4428</a><span style="color:#986a44;">):</span>  the process of Log4j is to log the User-Agent as a string using a function and store it in the designated location. <br />	The vulnerability in this process is the misinterpretation of the string, which leads to the execution of a request instead of logging the events<br /><br /><br /><strong><h3>Privileges</h3></strong><br /><span style="color:#33d17a;">Privileges</span> are present in any system that controls processes.<br />The <span style="color:#33d17a;">Privileges</span> serve as a type of permission that determines what tasks and actions can be performed on the system. <br /><br />We can divide these <span style="color:#33d17a;">privileges</span> into the following areas:<br />   ◇ <strong>System</strong> → These privileges are the highest privileges that can be obtained, which allow any system modification. In Windows, this type of privilege is called SYSTEM, and in Linux, it is called root.<br />   ◇ <strong>User</strong> → User privileges are permissions that have been assigned to a specific user. For security reasons, separate users are often set up for particular services during the installation of Linux distributions.<br />   ◇ <strong>Groups</strong> → Groups are a categorization of at least one user who has certain permissions to perform specific actions.<br />   ◇ <strong>Policies</strong> → Policies determine the execution of application-specific commands, which can also apply to individual or grouped users and their actions.<br />   ◇ <strong>Rules</strong> → Rules are the permissions to perform actions handled from within the applications themselves<br /><br /><span style="color:#986a44;">Log4j vulnerability (</span><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228">CVE-2021-4428</a><span style="color:#986a44;">):</span>  The vulnerability in the privileges was that most applications with the Log4j implementation were run with the privileges of an administrator.<br /><br /><br /><strong><h3>Destination</h3></strong><br />Every task has at least one purpose and goal that must be fulfilled.<br />The result of such a task is either stored somewhere or forwarded to another processing point. <br />Such processing points can point either to:<br />• <strong>Local Destination</strong> → The local area is the system&#39;s environment in which the process occurred. Therefore, the results and outcomes of a task are either processed further by a process that includes changes to data sets or storage of the data.<br />• <strong>Network Destination</strong> → The network area is mainly a matter of forwarding the results of a process to a remote interface. This can be an IP address and its services or even entire networks. The results of such processes can also influence the route under certain circumstances<br /><br /><span style="color:#986a44;">Log4j vulnerability (</span><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228">CVE-2021-4428</a><span style="color:#986a44;">)</span>: The misinterpretation of the User-Agent leads to a JNDI lookup which is executed as a command from the system with administrator privileges and queries a r<span style="text-decoration:underline;">emote server controlled by the attacker, which in our case is the </span><span style="color:#9141ac;text-decoration:underline;">Destination</span> in our concept of attacks<br /><br /><br /><strong><h3>Log4j Vulnerability explained with the above pattern template</h3></strong><br />1. Initiation of the Attack<br />	<table class="table"><tr><th>Step</th><th>Log4j</th><th>Concept of Attacks - Category</th></tr><tr><td>1.</td><td>The attacker manipulates the user agent with a JNDI lookup command.</td><td>Source</td></tr><tr><td>2.</td><td>The process misinterprets the assigned user agent, leading to the execution of the command.</td><td>Process</td></tr><tr><td>3.</td><td>The JNDI lookup command is executed with administrator privileges due to logging permissions.</td><td>Privileges</td></tr><tr><td>4.</td><td>This JNDI lookup command points to the server created and prepared by the attacker, which contains a malicious Java class containing commands designed by the attacker.</td><td>Destination</td></tr></table><br />	This is when the cycle starts all over again, but this time to gain remote access to the target system<span style="color:#a4b1cd;">.</span><br /><br />2. Trigger Remote Code Execution<br />	<table class="table"><tr><th>Step</th><th>Log4j</th><th>Concept of Attacks - Category</th></tr><tr><td>5.</td><td>After the malicious Java class is retrieved from the attacker&#39;s server, it is used as a source for further actions in the following process.</td><td>Source</td></tr><tr><td>6.</td><td>Next, the malicious code of the Java class is read in, which in many cases has led to remote access to the system.</td><td>Process</td></tr><tr><td>7.</td><td>The malicious code is executed with administrator privileges due to logging permissions.</td><td>Privileges</td></tr><tr><td>8.</td><td>The code leads back over the network to the attacker with the functions that allow the attacker to control the system remotely.</td><td>Destination</td></tr></table><br /><br /><br /><br /><br /><strong>Bibliography:</strong><br />• <a href="https://academy.hackthebox.com/">https://academy.hackthebox.com/</a></div>
</body>
</html>
