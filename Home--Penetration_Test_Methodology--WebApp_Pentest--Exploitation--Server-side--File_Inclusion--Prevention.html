<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Prevention</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Prevention</h1><br/><br /><strong><h3>File Inclusion Prevention</h3></strong><br />• Most effective thing to reduce file inclusion vulnerabilities is to <span style="color:#ffa500;">avoid passing any user-controlled inputs into any file inclusion functions or APIs</span><br />   ◇ Partial list of functions seen in chapter <a href="ation_Test_Methodology--WebApp_Pentest--Exploitation--Server-side--File_Inclusion--Vulnerable_code--functions_Table_(Read-Execute-Remote).html">Vulnerable Code→Functions Table</a><br />      ▪ Because the above list is not comprehensive, we should generally consider any function that can read files.<br />   ◇ The page should be able to dynamically load assets on the back-end, with no user interaction whatsoever. <br />      ▪ CONS: more code to be changed<br />      ▪ PROS: more secure<br /><br /><strong><h6>Whitelist</h6></strong><strong><span style="color:#1e90ff;">ing</span></strong><strong> &amp; </strong><strong><span style="color:#ff0000;">Blacklisting</span></strong><br />• When change to the code to <span style="color:#ffa500;">disallow user input into vulnerable functions</span> is NOT POSSIBLE <br />   ◇ utilize a <span style="color:#1e90ff;">whitelist</span> of allowed user inputs, and match each input to the file to be loaded, while having a default value for all other inputs. <br />      ▪ If we are dealing with an existing web application, we can create a whitelist that contains all existing paths used in the front-end, and then utilize this list to match the user input.<br />         <span style="color:#a52a2a;">example:</span> Java code to validate the canonical path of a file based on user input<br />         <div class="codebox"><pre>File file = new File(BASE_DIRECTORY, userInput);<br />if (file.getCanonicalPath().startsWith(BASE_DIRECTORY)) {<br />    // process file<br />} </pre></div><br />      ▪ a <span style="color:#1e90ff;">whitelist</span> could be:<br />         - a database table that matches IDs to files<br />         - a case-match script that matches names to files<br />         - a static json map with names and files that can be matched.<br />      ▪ Once the <span style="color:#1e90ff;">whitelist</span> is implemented, the user input is not going into the function, but the matched files are used in the function, which avoids file inclusion vulnerabilities.<br />      ▪ CONS: less secure<br />      ▪ PROS: less code to be changed<br />   ◇ utilize a <span style="color:#ff0000;">blacklist</span>, validation should verify that the input contains only permitted content, such as purely alphanumeric characters.<br />   <br />Bibliography:<br />• <a href="https://portswigger.net/web-security/file-path-traversal">https://portswigger.net/web-security/file-path-traversal</a></div>
</body>
</html>
