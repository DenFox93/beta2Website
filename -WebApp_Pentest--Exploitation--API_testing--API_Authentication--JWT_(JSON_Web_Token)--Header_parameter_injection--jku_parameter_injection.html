<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>jku parameter injection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>jku parameter injection</h1><br/><strong>jku parameter injection</strong><br />In the JWT header, developers can also use the jku parameter to specify the JSON Web Key Set URL. This parameter indicates where the application can find the JSON Web Key (JWK) used to verify the signature – basically the public key in JSON format.<br />To illustrate, let’s take the following JWT that uses the jku parameter to specify the public key:<br /><div class="codebox"><pre>{<br />  &quot;alg&quot;: &quot;RS256&quot;,<br />  &quot;typ&quot;: &quot;JWT&quot;,<br />  &quot;jku&quot;:&quot;https://example.com/key.json&quot;<br />}.<br />{<br />  &quot;name&quot;: &quot;John Doe&quot;,<br />  &quot;user_name&quot;: &quot;john.doe&quot;,<br />  &quot;is_admin&quot;: false<br />}</pre></div><br /><br />	<a href=""><img src="images/2269-1.png" alt="images/2269-1.png" /></a><br />	<span style="text-decoration:underline;">Base64URL encode and decode</span><br />      ▪ <a href="https://base64.guru/standards/base64url/encode">https://base64.guru/standards/base64url/encode</a><br />      ▪ <a href="https://base64.guru/standards/base64url/decode">https://base64.guru/standards/base64url/decode</a><br /><br /><br />The parameter <span style="text-decoration:underline;">is NOT vulnerable</span> if the crafted response give us something like this<br />	<a href=""><img src="images/2269-2.png" alt="images/2269-2.png" /></a><br /><br /><br />The specified key.json file might look something like:<br /><div class="codebox"><pre>{<br />  &quot;kty&quot;: &quot;RSA&quot;,<br />  &quot;n&quot;: &quot;-4KIwb83vQMH0YrzE44HppWvyNYmyuznuZPKWFt3e0xmdi-WcgiQZ1TC...RMxYC9lr4ZDp-M0&quot;,<br />  &quot;e&quot;: &quot;AQAB&quot;<br />}</pre></div><br /><br /><br />The application verifies the signature using the JSON Web Key retrieved based on the jku header value:<br /><br />Now for the attack. An attacker can change the jku parameter value to point to their own JWK instead of the valid one. If accepted, this allows the attacker to sign malicious tokens using their own private key. After the malicious token is sent, the application will fetch the attacker’s JWK and use it to verify the signature:<br /><br />To prevent such attacks, applications typically use URL filtering. Unfortunately, there are ways for attackers to bypass such filtering, including:<br />• Using https://trusted (for example https://trusted@attacker.com/key.json), if the application checks for URLs starting with trusted<br />• Using URL fragments with the # character<br />• Using the DNS naming hierarchy<br />• Chaining with an open redirect<br />• Chaining with a header Injection<br />• Chaining with SSRF<br /><br />For this reason, it is very important for the application to whitelist permitted hosts and have correct URL filtering in place. Beyond that, the application must not have other vulnerabilities that an attacker might chain to bypass URL filtering.<br /><br /><br />Bibliography:<br /><a href="https://www.invicti.com/blog/web-security/json-web-token-jwt-attacks-vulnerabilities/">https://www.invicti.com/blog/web-security/json-web-token-jwt-attacks-vulnerabilities/</a></div>
</body>
</html>
