<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DNS Scans</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>DNS Scans</h1><br/><br /><strong><h3>Use DNS of the internal Network</h3></strong><br />We can use Nmap to enumerate all the DNS servers that exist within the remote/target network.<br />Sometimes DNS only accepts communication from port 53. This means that all communications with a port different than 53 are blocked by the service or the firewall<br />A DNS server runs on:<br />• TCP port 53<br />    <div class="codebox"><pre>nmap -sS --source-port 53 -p53 -n &lt;netblock&gt;  <span style="color:#0088ff;font-weight:400">#TCP scan</span></pre></div><br />• UDP port 53<br />    <div class="codebox"><pre>nmap -sU --source-port 53 -p53 -n &lt;netblock&gt;  <span style="color:#0088ff;font-weight:400">#UDP scan</span></pre></div><br />• <span style="text-decoration:underline;">both TCP and UDP port 53</span><br />    <div class="codebox"><pre>nmap -sS -sU --source-port 53 -p53 -n &lt;netblock&gt;  </pre></div><br />    <span style="color:#a5452a;">example</span><br />    <a href=""><img src="images/1474-1.png" alt="images/1474-1.png" /></a><br />Once we have found on which <span style="color:#ff8700;">IP addresses that run a DNS server</span> we can focus on these address(es) in order to discover more informations about the network.<br />Now we can use the DNS enumeration techniques seen in the <a href="Home--Penetration_Test_Methodology--Network_Pentest--Scanning_and_Enumeration--DNS.html">DNS enumeration chapter</a><br /><br /><strong>--dns-servers</strong><br />By default, Nmap determines your DNS servers (for rDNS resolution) from your resolv.conf file (Unix) or the Registry (Win32). Alternatively, you may use this option to specify alternate servers.<br />If we find DNS name server into the network we could use them to try reverse DNS (determine the domain name associated with an IP address). <br /><div class="codebox"><pre>nmap -sS -sV --dns-servers [IpDNS] [addressRange]</pre></div><br /><br /><br /><br />While WHOIS can be used to identify public netblocks owned by a target organization.<br />• <strong>DNS Reverse Scan:</strong><br />    Once a public netblock is identified, we can use <span style="text-decoration:underline;">reverse DNS scans</span> to resolve the PTR records for each IP address.<br />    How<br />   1) Perform a WHOIS lookup for IP addresses owned by the target organization<br />   2) perform a reverse DNS lookup for every IP<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># dnsrecon.py --domain &lt;domain&gt; --range &lt;netblock&gt;</pre></div><br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nmap -sL &lt;netblock&gt; <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> <span style="color:#333333;font-weight:400">\)</span>     <span style="color:#0088ff;font-weight:400"># the grep command searches for a literal &quot;)&quot; character</span></pre></div><br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># msfconsole<br />msf&gt; use auxiliary<span style="color:#ff9d00;font-weight:700">/</span>gather<span style="color:#ff9d00;font-weight:700">/</span>enum_dns<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> DOMAIN &lt;domain&gt;<br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> ENUM_RVL <span style="color:#ff9d00;font-weight:700">true</span><br />msf&gt; <span style="color:#ff9d00;font-weight:700">set</span> IPRANGE &lt;netblock&gt;<br />msf&gt; run</pre></div><br />• <strong>“Brute Force” scans</strong><br />    While each PTR record points to one name (only), multiple CNAMEs (canonical names, aka DNS aliases) can point to one IP address.<br />    With “Brute Force” scan we can discover these multiple CNAMEs<br />    Although commonly called “brute force” scans, these DNS scans are actually <span style="text-decoration:underline;">dictionary attacks</span>:<br />      1- Supply a dictionary of potential DNS names<br />      2- Read each entry<br />      3- Attempt to resolve $entry.example.com<br />   ◇ <span style="text-decoration:underline;">Nmap</span><br />      ▪ default list  is at /usr/share/nmap/nselib/data/vhosts-default.lst with 127 entries<br />           <a href=""><img src="images/1474-2.png" alt="images/1474-2.png" /></a><br />          <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nmap --script=dns-brute &lt;domain&gt;</pre></div><br />           <a href=""><img src="images/1474-3.png" alt="images/1474-3.png" /></a><br />      ▪ custom list<br />          <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nmap --script=dns-brute example.net --script-args=dns-brute.hostlist=<span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>dnsrecon<span style="color:#ff9d00;font-weight:700">/</span>namelist.txt</pre></div><br />   ◇ <span style="text-decoration:underline;">Dnsrecon</span><br />       dnsrecon has some useful dictionaries, on Kali:<br />      ▪ /usr/share/dnsrecon/namelist.txt →  1,907 entries<br />      ▪ /usr/share/dnsrecon/subdomains-top1mil-20000.txt →  5,000 entries<br />      ▪ /usr/share/dnsrecon/subdomains-top1mil-5000.txt →  20,000 entries<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># dnsrecon -t brt -d &lt;domain&gt; --name_server &lt;nameServer&gt; -D <span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>dnsrecon<span style="color:#ff9d00;font-weight:700">/</span>namelist.txt</pre></div><br />        <a href=""><img src="images/1474-4.png" alt="images/1474-4.png" /></a></div>
</body>
</html>
