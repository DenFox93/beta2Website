<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Insecure Coding</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Insecure Coding</h1><br/><br /><br /><strong><h3>Insecure Coding</h3></strong><br />To identify this vulnerability in the code, we need to find inconsistencies in the use of HTTP parameters across functions, as in some instances, this may lead to unprotected functionalities and filters.<br /><br />Code: php<br /><div class="codebox"><pre>if (isset($_REQUEST[&#39;filename&#39;])) {<br />    if (!preg_match(&#39;/[^A-Za-z0-9. _-]/&#39;, $_POST[&#39;filename&#39;])) {<br />        system(&quot;touch &quot; . $_REQUEST[&#39;filename&#39;]);<br />    } else {<br />        echo &quot;Malicious Request Denied!&quot;;<br />    }<br />}</pre></div><br /><span style="text-decoration:underline;">Analysis of the above code:</span><br />• If we were only considering Command Injection vulnerabilities, we would say that this is securely coded. The <code>preg_match</code> function properly looks for unwanted special characters and does not allow the input to go into the command if any special characters are found. However, the fatal error made in this case is not due to Command Injections but due to the inconsistent use of HTTP methods.<br />• We see that the <code>preg_match</code> filter only checks for special characters in POST parameters with <code>$_POST[&#39;filename&#39;]</code>. However, the final system command uses the <code>$_REQUEST[&#39;filename&#39;]</code> variable, which covers both GET and POST parameters. <br />	So, if an attacker were send malicious input through a GET request, it did not get stopped by the <code>preg_match</code> function, as the POST parameters were empty and hence did not contain and special characters. Once we reach the system function, however, it used any parameters found in the request, and our GET parameters were used in the command, eventually leading to Command Injection.<br /><br /><br /><br />When in the source code we find request parameters, it is always advised to test if they are vulnerable to HTTP tampering.<br /><table class="table"><tr><th>Language</th><th>Function</th></tr><tr><td>PHP</td><td>$_REQUEST[&#39;param&#39;]</td></tr><tr><td>Java</td><td>request.getParameter(&#39;param&#39;)</td></tr><tr><td>C#</td><td>Request[&#39;param&#39;]</td></tr></table><br /></div>
</body>
</html>
