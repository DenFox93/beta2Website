<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SecureString</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SecureString</h1><br/><br /><strong>SecureString</strong><br /><a href="Home--Pentesting_Basics--PowerShell.html">PowerShell</a>  introduced SecureString, in an attempt to make working with passwords slightly less risky.<br />Attackers instead use <a href="Home--Penetration_Test_Methodology--Network_Pentest--Exploitation--AV_Evasion--Powershell--Powershell_encrypters--SecureString.html">SecureString</a> not to hide their credentials in, but to hide their malicious code/data in.<br />The limitation with this approach is a <span style="text-decoration:underline;">65,536 character limit on the original text to encode</span>.<br />AES keys need to be exactly 128, 192 or 256 bits long<br />AES key can be represented as an array of decimal number, with each of them less than 256 to fit within a single unsigned byte(8bits).<br />   ◇ 256 bits → 256/8=32 numbers<br />   ◇ 192 bits → 192/8=24 numbers<br />   ◇ 128 bits → 128/8=16 numbers<br /><br /><span style="color:#a5452a;">encrypt</span><br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#0088ff;font-weight:400">$Key</span> <span style="color:#ff9d00;font-weight:700">=</span> (<span style="color:#333333;font-weight:400">3</span>,<span style="color:#333333;font-weight:400">4</span>,<span style="color:#333333;font-weight:400">2</span>,<span style="color:#333333;font-weight:400">3</span>,<span style="color:#333333;font-weight:400">56</span>,<span style="color:#333333;font-weight:400">34</span>,<span style="color:#333333;font-weight:400">254</span>,<span style="color:#333333;font-weight:400">222</span>,<span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">2</span>,<span style="color:#333333;font-weight:400">23</span>,<span style="color:#333333;font-weight:400">42</span>,<span style="color:#333333;font-weight:400">54</span>,<span style="color:#333333;font-weight:400">33</span>,<span style="color:#333333;font-weight:400">233</span>,<span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">34</span>,<span style="color:#333333;font-weight:400">2</span>,<span style="color:#333333;font-weight:400">7</span>,<span style="color:#333333;font-weight:400">6</span>,<span style="color:#333333;font-weight:400">5</span>,<span style="color:#333333;font-weight:400">35</span>,<span style="color:#333333;font-weight:400">43</span>)                          <span style="color:#0088ff;font-weight:400">#192bits AES key,24 numbers</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#0088ff;font-weight:400">$encoded</span><span style="color:#ff9d00;font-weight:700">=ConvertFrom-SecureString</span> <span style="color:#ff9d00;font-weight:700">-</span>k <span style="color:#0088ff;font-weight:400">$key</span> (<span style="color:#ff9d00;font-weight:700">ConvertTo-SecureString</span> <span style="color:#3ad900;font-weight:400">&quot;daniele&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>AsPlainText <span style="color:#ff9d00;font-weight:700">-</span>Force)<br /></pre></div><br />    <a href=""><img src="images/1180-1.png" alt="images/1180-1.png" /></a><br /><span style="color:#a5452a;">decrypt</span><br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Net.NetworkCredential(<span style="color:#3ad900;font-weight:400">&quot;&quot;</span>, (<span style="color:#ff9d00;font-weight:700">ConvertTo-SecureString</span> <span style="color:#ff9d00;font-weight:700">-</span>k <span style="color:#0088ff;font-weight:400">$key</span> <span style="color:#0088ff;font-weight:400">$encoded</span>))).Password<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; [Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>PtrToStringAuto([Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>SecureStringToBSTR((<span style="color:#ff9d00;font-weight:700">ConvertTo-SecureString</span> <span style="color:#ff9d00;font-weight:700">-</span>k <span style="color:#0088ff;font-weight:400">$key</span> <span style="color:#0088ff;font-weight:400">$encoded</span>)))   <span style="color:#0088ff;font-weight:400">#alternative</span></pre></div><br />    <a href=""><img src="images/1180-2.png" alt="images/1180-2.png" /></a><br />    <a href=""><img src="images/1180-3.png" alt="images/1180-3.png" /></a><br /><br />Bibliography: <br />• <a href="https://www.wietzebeukema.nl/blog/powershell-obfuscation-using-securestring">https://www.wietzebeukema.nl/blog/powershell-obfuscation-using-securestring</a><br /></div>
</body>
</html>
