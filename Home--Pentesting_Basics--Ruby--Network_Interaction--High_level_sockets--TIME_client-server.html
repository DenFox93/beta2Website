<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TIME client-server</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>TIME client-server</h1><br/><br /><strong>TIME Server</strong><br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/ruby</span><br /><br /><span style="color:#7f0044;font-weight:400">require</span> <span style="color:#3ad900;font-weight:400">&#39;socket&#39;</span><br /><br /><span style="color:#ff9d00;font-weight:700">def</span> main(ip,port)<br />	<span style="color:#0088ff;font-weight:400"># new TCP server bound to ip and port provided as argument</span><br />	server = <span style="color:#7f0044;font-weight:400">TCPServer</span>.new ip,port<br />	<span style="color:#0088ff;font-weight:400"># loop indefinitely to accept clients requests</span><br />	loop <span style="color:#ff9d00;font-weight:700">do</span><br />		<span style="color:#0088ff;font-weight:400"># new request accepted (client is a socket)</span><br />		client = server.accept<br />		<span style="color:#0088ff;font-weight:400"># prints the client information (IP and port)</span><br />		print <span style="color:#7f0044;font-weight:400">Time</span>.new.to_s + <span style="color:#3ad900;font-weight:400">&quot; - IP: &quot;</span>+client.peeraddr[<span style="color:#ff0044;font-weight:400">3</span>]<br />		print <span style="color:#3ad900;font-weight:400">&quot; Port: &quot;</span>+client.peeraddr[<span style="color:#ff0044;font-weight:400">1</span>].to_s+<span style="color:#3ad900;font-weight:400">&quot;\n&quot;</span><br />		<span style="color:#0088ff;font-weight:400"># client socket receives a message from the client</span><br />		<span style="color:#0088ff;font-weight:400"># chop is used to delete the last character (&quot;\n&quot;)</span><br />		<span style="color:#ff9d00;font-weight:700">case</span> client.gets.chop<br />			<span style="color:#0088ff;font-weight:400"># the server sends the correct answer according to the</span><br />			<span style="color:#0088ff;font-weight:400"># type of operation received (timestamp|utc|local)</span><br />			<span style="color:#ff9d00;font-weight:700">when</span> <span style="color:#3ad900;font-weight:400">&quot;timestamp&quot;</span> <span style="color:#ff9d00;font-weight:700">then</span> client.puts(<span style="color:#7f0044;font-weight:400">Time</span>.now.to_i)<br />			<span style="color:#ff9d00;font-weight:700">when</span> <span style="color:#3ad900;font-weight:400">&quot;utc&quot;</span> <span style="color:#ff9d00;font-weight:700">then</span> client.puts(<span style="color:#7f0044;font-weight:400">Time</span>.now.utc)<br />			<span style="color:#ff9d00;font-weight:700">when</span> <span style="color:#3ad900;font-weight:400">&quot;local&quot;</span> <span style="color:#ff9d00;font-weight:700">then</span> client.puts(<span style="color:#7f0044;font-weight:400">Time</span>.now)<br />			<span style="color:#ff9d00;font-weight:700">else</span> client.puts(<span style="color:#3ad900;font-weight:400">&quot;Invalid operation&quot;</span>)<br />		<span style="color:#ff9d00;font-weight:700">end</span><br />		<span style="color:#0088ff;font-weight:400"># server is done =&gt; close the socket</span><br />		client.close<br />	<span style="color:#ff9d00;font-weight:700">end</span><br /><span style="color:#ff9d00;font-weight:700">end</span><br /><br /><span style="color:#ff9d00;font-weight:700">begin</span><br />	ip = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">0</span>]<br />	port = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">1</span>]<br />	main(ip,port)<br /><span style="color:#ff9d00;font-weight:700">rescue</span> <span style="color:#7f0044;font-weight:400">Exception</span> =&gt; e<br />	puts e<br /><span style="color:#ff9d00;font-weight:700">end</span><br /></pre></div><br /><br /><strong>TIME Client</strong><br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/usr/bin/ruby</span><br /><br /><span style="color:#7f0044;font-weight:400">require</span> <span style="color:#3ad900;font-weight:400">&#39;socket&#39;</span><br /><br /><span style="color:#ff9d00;font-weight:700">def</span> main(host,port,type)<br />	<span style="color:#0088ff;font-weight:400"># open the connection with the time server</span><br />	<span style="color:#0088ff;font-weight:400"># available on host and port arguments</span><br />	<span style="color:#7f0044;font-weight:400">TCPSocket</span>.open(host,port) <span style="color:#ff9d00;font-weight:700">do</span> |s|<br />		<span style="color:#0088ff;font-weight:400"># sends to the server the type of time  we want</span><br />		s.puts(type)					<span style="color:#0088ff;font-weight:400"># (timestamp|utc|local)</span><br />		<span style="color:#0088ff;font-weight:400"># receives and puts to stdout the formatted time</span><br />		puts s.gets<br />	<span style="color:#ff9d00;font-weight:700">end</span><br /><span style="color:#ff9d00;font-weight:700">end</span><br /><br /><span style="color:#ff9d00;font-weight:700">begin</span><br />	host = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">0</span>]<br />	port = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">1</span>]<br />	type = <span style="color:#7f0044;font-weight:400">ARGV</span>[<span style="color:#ff0044;font-weight:400">2</span>]<br />	main(host,port,type)<br /><span style="color:#ff9d00;font-weight:700">rescue</span> <span style="color:#7f0044;font-weight:400">Exception</span> =&gt; e<br />	puts s<br /><span style="color:#ff9d00;font-weight:700">end</span><br /></pre></div><br /><br />SERVER<br /><div class="codebox"><pre>./time_server.rb 192.168.3.136 <span style="color:#ff0044;font-weight:400">7000</span></pre></div><br /><br />CLIENT<br /><div class="codebox"><pre>./time_client.rb 192.168.3.136 <span style="color:#ff0044;font-weight:400">7000</span> timestamp</pre></div><br /><br /><br /><a href=""><img src="images/1952-1.png" alt="images/1952-1.png" /></a><br /><a href=""><img src="images/1952-2.png" alt="images/1952-2.png" /></a></div>
</body>
</html>
