<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>how block.number and blockhash works (example)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>how block.number and blockhash works (example)</h1><br/>Type this code on Remix<br />    <div class="codebox"><pre>pragma solidity ^0.6.6;<br /><br />contract simpleVulnerableBlockHash {<br />  uint32 public block_number;<br />  bytes32 public checkHash;<br /> <br />  function get_block_number() public  {   <br />    block_number = uint32(block.number);             <span style="color:#0088ff;font-weight:400">//Querying for the current block number</span><br />                                                     <span style="color:#0088ff;font-weight:400">//This is the current block number running on the blockchain</span><br />  }<br /> <br />  function check_hash() public{<br />     checkHash = bytes32(blockhash(block_number));   <span style="color:#0088ff;font-weight:400">//takes the block number and uses it with the blockhash</span><br />     <br />  }<br /> <br />  function wasteTime() public{<br />     uint test = uint(block.number);<br />  }<br /> <br />}</pre></div><br />    In Remix the functions are in orange while the variables are in blue<br />    <a href=""><img src="images/1436-1.png" alt="images/1436-1.png" /></a><br />    <br /><br />Action Steps:<br />0. When we deploy the contract, a transaction is been made<br />    <a href=""><img src="images/1436-2.png" alt="images/1436-2.png" /></a><br />    first operation(block_number=1) is the creation of the contract<br />1. Execute the <strong><span style="color:#ff8700;">get_block_number</span></strong>  and <strong><span style="color:#ff8700;">check_hash</span></strong> functions.<br />    <a href=""><img src="images/1436-3.png" alt="images/1436-3.png" /></a>   <br />    <a href=""><img src="images/1436-4.png" alt="images/1436-4.png" /></a><br />    <a href=""><img src="images/1436-5.png" alt="images/1436-5.png" /></a><br />    <a href=""><img src="images/1436-6.png" alt="images/1436-6.png" /></a><br />3. Check the <strong><span style="color:#1e90ff;">block_number</span></strong> and the <strong><span style="color:#1e90ff;">CheckHash</span></strong> values<br />    <a href=""><img src="images/1436-7.png" alt="images/1436-7.png" /></a> <a href=""><img src="images/1436-8.png" alt="images/1436-8.png" /></a><br />    <a href=""><img src="images/1436-9.png" alt="images/1436-9.png" /></a><br />    Note that the <strong><span style="color:#1e90ff;">checkHash</span></strong> number is relative to the block 2 transaction of <strong><span style="color:#ff8700;">get_block_number</span></strong>, while on the blockchain a block 3 transaction is been created by the same function <strong><span style="color:#ff8700;">check_hash</span></strong>. Every time we call a function a new block is created<br /><br />5. Execute the <strong><span style="color:#ff8700;">wasteTime</span></strong> function 256 times(in this case we need to be to arrive at 256+3=259) or more<br />    <br />7. Execute the <strong><span style="color:#ff8700;">check_hash</span></strong> function. This will be executed on the old <strong><span style="color:#1e90ff;">block_number</span></strong>(because we did not get a new one)<br />    <a href=""><img src="images/1436-10.png" alt="images/1436-10.png" /></a><br />9. Check <strong><span style="color:#1e90ff;">checkHash</span></strong> variable value.<br />    <a href=""><img src="images/1436-11.png" alt="images/1436-11.png" /></a><br />   We can see that we ended up with a value of zero, because the block_numbers are discarded after 256 and return a result of zero<br /><br /><span style="color:#393939;"> </span><br />The problem with block.number(and so whit blockhash) is: if a block is older than 256 blocks when it is hashed it will return a result of zero. This because Ethereum has short term memory when we talk about blocks.<br /><br /></div>
</body>
</html>
