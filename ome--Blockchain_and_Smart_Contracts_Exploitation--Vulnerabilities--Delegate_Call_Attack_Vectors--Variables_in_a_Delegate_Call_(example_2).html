<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Variables in a Delegate Call (example 2)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Variables in a Delegate Call (example 2)</h1><br/><br /><br /><div class="codebox"><pre>pragma solidity 0.6.6;<br /><br /> <br />contract LogicContract {<br />  uint public a;<br /> <br />  function set(uint256 val) public {<br />    a = val;                                              <span style="color:#0088ff;font-weight:400">//&lt;--</span><br />  }<br />}<br /><br /><br />contract CallingContract {<br />  uint256 public b = <span style="color:#ff0044;font-weight:400">5</span>; <br />  uint256 public a = <span style="color:#ff0044;font-weight:400">5</span>;                                   <br />  address logic_pointer = address(new LogicContract());   <span style="color:#0088ff;font-weight:400">//Address of the Logic Contract, for testing purpose otherwise we should</span><br />                                                          <span style="color:#0088ff;font-weight:400">// use an interface with 2 separate files</span><br /> <br /> <br />  function setA(uint val) public {<br />    <span style="color:#0088ff;font-weight:400">// Note: the return value of delegatecall should be checked</span><br />    logic_pointer.delegatecall(abi.encodeWithSignature(<span style="color:#3ad900;font-weight:400">&quot;set(uint256)&quot;</span>, val));<br />  }<br />}</pre></div><br /><br /><strong>Before setA function</strong> <br />b → <a href=""><img src="images/1430-1.png" alt="images/1430-1.png" /></a><br />a → <a href=""><img src="images/1430-2.png" alt="images/1430-2.png" /></a><br /><br />setA(8) → <a href=""><img src="images/1430-3.png" alt="images/1430-3.png" /></a><br /><br /><strong>After setA function</strong><br />b → <a href=""><img src="images/1430-4.png" alt="images/1430-4.png" /></a><br />a → <a href=""><img src="images/1430-5.png" alt="images/1430-5.png" /></a><br /><br /><strong>When we have set the value of &quot;a”, </strong><strong><span style="text-decoration:underline;">the value of “b” was the value that changed</span></strong><strong>. Why?</strong><br />When using a delegatecall we are executing the set function in the <span style="color:#00ff00;">logic contract</span> under the context of the <span style="color:#ff8700;">calling contract</span> which has those 3 variables with “b” being the first variable<br />Essentially the <span style="color:#00ff00;">logic contract</span> only knows about the “a” variable and sets the first element in the memory to that value. However, we are in the context of the <span style="color:#ff8700;">calling contract</span>, and the calling contracts first memory slot is the variable “b”.<br />The “b” value is overwritten because it is the first slot defined in the memory of the <span style="color:#ff8700;">calling contract</span> and the <span style="color:#00ff00;">logic contract</span> only knows about a single variable “a” in its own contract thus overwriting the value in the first slot of memory.<br /><a href=""><img src="images/1430-6.png" alt="images/1430-6.png" /></a></div>
</body>
</html>
