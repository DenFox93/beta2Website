<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Input Validation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Input Validation</h1><br/><strong><h3>Input Validation</h3></strong><br />User input can be validated based on the data used to query to ensure that it matches the expected input.<span style="color:#a4b1cd;"> </span><br /><span style="color:#a52a2a;">PHP: vulnerable code to UNION injections</span><br /><div class="codebox"><pre>&lt;?php<br />if (isset($_GET[&quot;port_code&quot;])) {<br />	$q = &quot;Select * from ports where port_code ilike &#39;%&quot; . $_GET[&quot;port_code&quot;] . &quot;%&#39;&quot;;<br />	$result = pg_query($conn,$q);<br />    <br />	if (!$result)<br />	{<br />   		die(&quot;&lt;/table&gt;&lt;/div&gt;&lt;p style=&#39;font-size: 15px;&#39;&gt;&quot; . pg_last_error($conn). &quot;&lt;/p&gt;&quot;);<br />	}<br />&lt;SNIP&gt;<br />?&gt;<br /></pre></div><br /><br />    The GET parameter port_code being used in the query directly. <br /><strong><span style="text-decoration:underline;">How to Prevent</span></strong><br />Because it&#39;s already known that a port code consists only of letters or spaces. We can restrict the user input to only these characters, which will prevent the injection of queries. <br />• PHP<span style="color:#a4b1cd;"> </span><a href="https://www.php.net/manual/en/function.preg-match.php">preg_match()</a>  → This function perform a regular expression match<br />    <div class="codebox"><pre>&lt;SNIP&gt;<br />$pattern = &quot;/^[A-Za-z\s]+$/&quot;;<br />$code = $_GET[&quot;port_code&quot;];<br /><br />if(!preg_match($pattern, $code)) {<br />  die(&quot;&lt;/table&gt;&lt;/div&gt;&lt;p style=&#39;font-size: 15px;&#39;&gt;Invalid input! Please try again.&lt;/p&gt;&quot;);<br />}<br /><br />$q = &quot;Select * from ports where port_code ilike &#39;%&quot; . $code . &quot;%&#39;&quot;;<br />&lt;SNIP&gt;</pre></div><code><br /></code>    The pattern used is [A-Za-z\s]+, which will only match strings containing letters and spaces. Any other character will result in the termination of the script.<br />    Injection <code>&#39;</code><code><span style="color:#a4b1cd;">;</span></code><code> </code><code><span style="color:#ff8484;">SELECT</span></code><code> </code><code><span style="color:#ffaf00;">1</span></code><code><span style="color:#a4b1cd;">,</span></code><code><span style="color:#ffaf00;">2</span></code><code><span style="color:#a4b1cd;">,</span></code><code><span style="color:#ffaf00;">3</span></code><code><span style="color:#a4b1cd;">,</span></code><code><span style="color:#ffaf00;">4</span></code><code><span style="color:#3a2e14;">-- -</span></code> so will be rejected<br />    <a href=""><img src="images/2521-1.png" alt="images/2521-1.png" /></a><br /><br /></div>
</body>
</html>
