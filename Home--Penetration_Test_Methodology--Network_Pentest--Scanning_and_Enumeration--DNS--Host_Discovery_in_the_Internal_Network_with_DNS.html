<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Host Discovery in the Internal Network with DNS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Host Discovery in the Internal Network with DNS</h1><br/><br /><br /><strong><h3>1. Forward DNS Lookup of possible Subdomains</h3></strong><br />Usually useful if we are in an internal network <br />If we have a Domain(with its ip address) and we <span style="text-decoration:underline;">want to find the ip address of its possible subdomains</span><br />We can use a commands like this<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">wget</span> https<span style="color:#ff9d00;font-weight:700">://</span>raw.githubusercontent.com<span style="color:#ff9d00;font-weight:700">/</span>mschwager<span style="color:#ff9d00;font-weight:700">/</span>fierce<span style="color:#ff9d00;font-weight:700">/</span>master<span style="color:#ff9d00;font-weight:700">/</span>fierce<span style="color:#ff9d00;font-weight:700">/</span>lists<span style="color:#ff9d00;font-weight:700">/</span>default.txt<br /><span style="color:#ff9d00;font-weight:700">for</span> <span style="color:#7f0044;font-weight:400">subdomain</span> <span style="color:#ff9d00;font-weight:700">in</span> $<span style="color:#ff9d00;font-weight:700">(cat</span> default.txt<span style="color:#ff9d00;font-weight:700">);</span> <span style="color:#ff9d00;font-weight:700">do</span> host <span style="color:#7f0044;font-weight:400">$subdomain</span>.[DOMAIN_FQDN] [DNS_IP_ADDRESS] -W 2<span style="color:#ff9d00;font-weight:700">;</span> <span style="color:#ff9d00;font-weight:700">done</span> <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> <span style="color:#3ad900;font-weight:400">&#39;has address&#39;</span></pre></div><br />    <a href=""><img src="images/2109-1.png" alt="images/2109-1.png" /></a><br /><br />   ◇ <strong>nmap</strong><br />    <div class="codebox"><pre>nmap --dns-servers 172.16.5.10 --script dns-brute --script-args dns-brute.domain=sportsfoo.com</pre></div><br /><br /><br /><strong>Wordlists:</strong><br />• <a href="https://github.com/mschwager/fierce/tree/master/fierce/lists">https://github.com/mschwager/fierce/tree/master/fierce/lists</a><br />   ◇ Default(1598 words): <a href="https://raw.githubusercontent.com/mschwager/fierce/master/fierce/lists/default.txt">https://raw.githubusercontent.com/mschwager/fierce/master/fierce/lists/default.txt</a><br /><br /><br /><strong><h3>2. Reverse DNS Lookup of possible Ip address</h3></strong><br />From the the point 1 in this scenario we have discovered that there a lot of ip address in the range 172.16.5.0/24<br />Create a list of this possible ip address<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">seq</span> -f <span style="color:#3ad900;font-weight:400">&quot;172.16.5.%g&quot;</span> 1 255 &gt; iplist.txt</pre></div><br />script to do a reverse dns lookup of these addresses:<br /><div class="codebox"><pre>nano reverse_dns.sh</pre></div><br />File:<br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/bin/bash</span><br /><span style="color:#ff9d00;font-weight:700">for</span> <span style="color:#7f0044;font-weight:400">ip</span> <span style="color:#ff9d00;font-weight:700">in</span> $<span style="color:#ff9d00;font-weight:700">(cat</span> iplist.txt<span style="color:#ff9d00;font-weight:700">);</span> <span style="color:#ff9d00;font-weight:700">do</span> dig @172.16.5.10 -x <span style="color:#7f0044;font-weight:400">$ip</span> +nocookie<span style="color:#ff9d00;font-weight:700">;</span> <span style="color:#ff9d00;font-weight:700">done</span></pre></div><br />enable execution:<br /><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">chmod</span> +x reverse_dns.sh</pre></div><br />execute it:<br /><div class="codebox"><pre>.<span style="color:#ff9d00;font-weight:700">/</span>reverse_dns.sh <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> sportsfoo.com <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> PTR</pre></div><br />    <a href=""><img src="images/2109-2.png" alt="images/2109-2.png" /></a><br /><br />   ◇ <strong>nmap</strong><br />    <div class="codebox"><pre>dnsrecon -n 172.16.5.10 -r 172.16.5.1-172.16.5.99</pre></div><br /><br /><strong><h3>3. Check which Hosts are alive</h3></strong><br />   ◇ nmap<br />    This step with nmap is not related with the previous one<br />   <div class="codebox"><pre>nmap -sn 172.16.5.* -oG - <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">awk</span> <span style="color:#3ad900;font-weight:400">&#39;/Up/{print $2}&#39;</span> &gt; alive.txt <span style="color:#ff9d00;font-weight:700">&amp;&amp;</span> <span style="color:#ff9d00;font-weight:700">cat</span> alive.txt</pre></div><br />    <a href=""><img src="images/2109-3.png" alt="images/2109-3.png" /></a><br /></div>
</body>
</html>
